{"ast":null,"code":"import { Dialog, Tooltip } from '@syncfusion/ej2-popups';\nimport { Droppable, createElement, extend, remove, addClass, closest, getInstance, isBlazor, select } from '@syncfusion/ej2-base';\nimport { prepend, append, KeyboardEvents, removeClass, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { Button, RadioButton, CheckBox } from '@syncfusion/ej2-buttons';\nimport { MaskedTextBox } from '@syncfusion/ej2-inputs';\nimport * as cls from '../../common/base/css-constant';\nimport { TreeView } from '@syncfusion/ej2-navigations';\nimport { ContextMenu as Menu } from '@syncfusion/ej2-navigations';\nimport * as events from '../../common/base/constant';\nimport { Accordion } from '@syncfusion/ej2-navigations';\nimport { DropDownList } from '@syncfusion/ej2-dropdowns';\nimport { PivotUtil } from '../../base/util';\n/**\n * Module to render Calculated Field Dialog\n */\n\nvar COUNT = 'Count';\nvar AVG = 'Avg';\nvar MEDIAN = 'Median';\nvar MIN = 'Min';\nvar MAX = 'Max';\nvar SUM = 'Sum';\nvar DISTINCTCOUNT = 'DistinctCount';\nvar PRODUCT = 'Product';\nvar STDEV = 'SampleStDev';\nvar STDEVP = 'PopulationStDev';\nvar VAR = 'SampleVar';\nvar VARP = 'PopulationVar';\nvar CALC = 'CalculatedField';\nvar AGRTYPE = 'AggregateType';\n/** @hidden */\n\nvar CalculatedField = function () {\n  /**\n   * Constructor for calculatedfield module.\n   * @param {PivotView | PivotFieldList} parent - Component instance.\n   */\n  function CalculatedField(parent) {\n    /** @hidden */\n    this.isFormula = false;\n    /** @hidden */\n\n    this.isRequireUpdate = false;\n    this.parent = parent;\n    this.existingReport = null;\n    this.parent.calculatedFieldModule = this;\n    this.removeEventListener();\n    this.addEventListener();\n    this.parentID = this.parent.element.id;\n    this.dialog = null;\n    this.inputObj = null;\n    this.treeObj = null;\n    this.droppable = null;\n    this.menuObj = null;\n    this.newFields = null;\n    this.isFieldExist = true;\n    this.formulaText = null;\n    this.fieldText = null;\n    this.formatText = null;\n    this.formatType = null;\n    this.fieldType = null;\n    this.parentHierarchy = null;\n    this.isEdit = false;\n    this.currentFieldName = null;\n    this.confirmPopUp = null;\n  }\n  /**\n   * To get module name.\n   * @returns {string} - Module name.\n   */\n\n\n  CalculatedField.prototype.getModuleName = function () {\n    return 'calculatedField';\n  };\n\n  CalculatedField.prototype.keyActionHandler = function (e) {\n    var node = e.currentTarget.querySelector('.e-hover.e-node-focus');\n\n    if (node) {\n      switch (e.action) {\n        case 'moveRight':\n        case 'shiftE':\n          if (this.parent.dataType === 'pivot') {\n            this.displayMenu(node);\n          }\n\n          break;\n\n        case 'delete':\n          if (node.tagName === 'LI' && !node.querySelector('.e-list-icon.e-format') && !node.querySelector('.e-list-icon').classList.contains('.e-icons') && node.querySelector('.' + cls.GRID_REMOVE) && node.querySelector('.' + cls.GRID_REMOVE).classList.contains('e-list-icon')) {\n            this.createConfirmDialog(this.parent.localeObj.getConstant('alert'), this.parent.localeObj.getConstant('removeCalculatedField'), {}, true, node);\n          }\n\n          break;\n\n        case 'enter':\n          var field = node.getAttribute('data-field');\n          var type = node.getAttribute('data-type');\n          var dropField = select('#' + this.parentID + 'droppable', this.dialog.element);\n\n          if (this.parent.dataType === 'pivot') {\n            if (dropField.value === '') {\n              if (type === CALC) {\n                dropField.value = node.getAttribute('data-uid');\n              } else {\n                dropField.value = '\"' + type + '(' + field + ')' + '\"';\n              }\n            } else if (dropField.value !== '') {\n              if (type === CALC) {\n                dropField.value = dropField.value + node.getAttribute('data-uid');\n              } else {\n                dropField.value = dropField.value + '\"' + type + '(' + field + ')' + '\"';\n              }\n            }\n          } else {\n            if (this.parent.olapEngineModule && this.parent.olapEngineModule.fieldList[field] && this.parent.olapEngineModule.fieldList[field].isCalculatedField) {\n              field = this.parent.olapEngineModule.fieldList[field].tag;\n            }\n\n            if (dropField.value === '') {\n              dropField.value = field;\n            } else if (dropField.value !== '') {\n              dropField.value = dropField.value + field;\n            }\n          }\n\n          break;\n      }\n    }\n  };\n  /**\n   * Trigger while click treeview icon.\n   * @param  {NodeClickEventArgs} e - Click event argument.\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.fieldClickHandler = function (e) {\n    var node = closest(e.event.target, 'li');\n\n    if (e.event.target.classList.contains(cls.FORMAT) || e.event.target.classList.contains(cls.CALC_EDIT) || e.event.target.classList.contains(cls.CALC_EDITED) || e.event.target.classList.contains(cls.GRID_REMOVE)) {\n      if (!this.parent.isAdaptive) {\n        this.displayMenu(node, e.node, e.event.target);\n      } else if (this.parent.dataType === 'olap' && this.parent.isAdaptive) {\n        if (node.tagName === 'LI' && node.querySelector('.e-list-edit-icon').classList.contains(cls.CALC_EDIT) && e.event.target.classList.contains(cls.CALC_EDIT)) {\n          this.isEdit = true;\n          this.currentFieldName = node.getAttribute('data-field');\n          this.fieldText = node.getAttribute('data-caption');\n          this.formulaText = node.getAttribute('data-formula');\n          this.formatType = node.getAttribute('data-formatString');\n          this.formatText = this.formatType === 'Custom' ? node.getAttribute('data-customString') : null;\n          this.fieldType = node.getAttribute('data-membertype');\n          this.parentHierarchy = this.fieldType === 'Dimension' ? node.getAttribute('data-hierarchy') : null;\n          addClass([node.querySelector('.e-list-edit-icon')], cls.CALC_EDITED);\n          removeClass([node.querySelector('.e-list-edit-icon')], cls.CALC_EDIT);\n          this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement);\n        } else if (node.tagName === 'LI' && node.querySelector('.e-list-edit-icon').classList.contains(cls.CALC_EDITED) && e.event.target.classList.contains(cls.CALC_EDITED)) {\n          this.isEdit = false;\n          this.fieldText = this.formatText = this.formulaText = this.currentFieldName = null;\n          this.parentHierarchy = this.fieldType = this.formatType = null;\n          addClass([node.querySelector('.e-list-edit-icon')], cls.CALC_EDIT);\n          removeClass([node.querySelector('.e-list-edit-icon')], cls.CALC_EDITED);\n        } else if (node.tagName === 'LI' && node.querySelector('.' + cls.GRID_REMOVE).classList.contains('e-icons') && e.event.target.classList.contains(cls.GRID_REMOVE)) {\n          this.createConfirmDialog(this.parent.localeObj.getConstant('alert'), this.parent.localeObj.getConstant('removeCalculatedField'), {}, true, e.node);\n        }\n      }\n    }\n  };\n  /**\n   * Trigger while click treeview icon.\n   * @param  {AccordionClickArgs} e - Click event argument.\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.accordionClickHandler = function (e) {\n    if (e.item && e.item.iconCss.indexOf('e-list-icon') !== -1 && closest(e.originalEvent.target, '.e-acrdn-header-icon')) {\n      var node = closest(e.originalEvent.target, '.e-acrdn-header').querySelector('.' + cls.CALCCHECK);\n      var fieldName = node.getAttribute('data-field');\n      var formatObj = PivotUtil.getFieldByName(fieldName, this.parent.dataSourceSettings.formatSettings);\n      var optionElement = closest(e.originalEvent.target, '.e-acrdn-header-icon');\n\n      if (optionElement.querySelector('.' + cls.CALC_EDIT) && e.originalEvent.target.classList.contains(cls.CALC_EDIT)) {\n        this.isEdit = true;\n        this.currentFieldName = this.fieldText = fieldName;\n        this.formulaText = this.parent.engineModule.fieldList[fieldName].formula;\n        this.formatText = formatObj ? formatObj.format : '';\n        addClass([optionElement.querySelector('.e-list-icon')], cls.CALC_EDITED);\n        removeClass([optionElement.querySelector('.e-list-icon')], cls.CALC_EDIT);\n        this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement);\n      } else if (optionElement.querySelector('.' + cls.CALC_EDITED) && e.originalEvent.target.classList.contains(cls.CALC_EDITED)) {\n        this.isEdit = false;\n        this.fieldText = this.formatText = this.formulaText = this.currentFieldName = null;\n        addClass([optionElement.querySelector('.e-list-icon')], cls.CALC_EDIT);\n        removeClass([optionElement.querySelector('.e-list-icon')], cls.CALC_EDITED);\n      } else if (optionElement.querySelector('.' + cls.GRID_REMOVE) && e.originalEvent.target.classList.contains(cls.GRID_REMOVE)) {\n        this.createConfirmDialog(this.parent.localeObj.getConstant('alert'), this.parent.localeObj.getConstant('removeCalculatedField'), {}, true, node);\n      }\n    }\n  };\n\n  CalculatedField.prototype.accordionCreated = function () {\n    var allElement = this.accordion.element.querySelectorAll('.e-acrdn-item');\n\n    for (var i = 0; i < allElement.length; i++) {\n      if (allElement[i].querySelector('.' + cls.CALC_EDIT) || allElement[i].querySelector('.' + cls.CALC_EDITED)) {\n        var element = createElement('span', {\n          className: 'e-list-icon ' + cls.GRID_REMOVE + ' e-icons'\n        });\n        append([element], allElement[i].querySelector('.e-acrdn-header-icon'));\n      }\n    }\n  };\n\n  CalculatedField.prototype.clearFormula = function () {\n    if (this.treeObj && this.treeObj.element.querySelector('li')) {\n      removeClass(this.treeObj.element.querySelectorAll('li'), 'e-active');\n      this.displayMenu(this.treeObj.element.querySelector('li'));\n    }\n  };\n  /**\n   * To display context menu.\n   * @param  {HTMLElement} node\n   * @returns {void}\n   */\n\n  /* eslint-disable  */\n\n\n  CalculatedField.prototype.displayMenu = function (node, treeNode, target) {\n    var edit = target ? target.classList.contains(cls.CALC_EDIT) : true;\n    var edited = target ? target.classList.contains(cls.CALC_EDITED) : true;\n\n    if (this.parent.dataType === 'pivot' && node.querySelector('.e-list-icon.e-format') && node.querySelector('.e-list-icon.e-format').classList.contains(cls.ICON) && !node.querySelector('.e-list-icon').classList.contains(cls.CALC_EDITED) && !node.querySelector('.e-list-icon').classList.contains(cls.GRID_REMOVE) && !node.querySelector('.e-list-icon').classList.contains(cls.CALC_EDIT) && node.tagName === 'LI') {\n      if (this.menuObj && !this.menuObj.isDestroyed) {\n        this.menuObj.destroy();\n      }\n\n      this.curMenu = node.querySelector('.' + cls.LIST_TEXT_CLASS);\n      this.openContextMenu(node);\n    } else if (node.tagName === 'LI' && (node.querySelector('.' + cls.CALC_EDIT) && node.querySelector('.' + cls.CALC_EDIT).classList.contains('e-list-icon') && edit || this.parent.dataType === 'olap' && node.getAttribute('data-type') === CALC && node.classList.contains('e-active') && (target && !target.classList.contains(cls.GRID_REMOVE) || !target))) {\n      this.isEdit = true;\n      var fieldName = node.getAttribute('data-field');\n      var caption = node.getAttribute('data-caption');\n      this.currentFieldName = fieldName;\n      this.inputObj.value = caption;\n      this.inputObj.dataBind();\n      var formatString = node.getAttribute('data-formatString');\n      var dialogElement = this.dialog.element;\n      var customFormat = getInstance(select('#' + this.parentID + 'Custom_Format_Element', dialogElement), MaskedTextBox);\n\n      if (this.parent.dataType === 'olap') {\n        var memberType = node.getAttribute('data-membertype');\n        var parentHierarchy = node.getAttribute('data-hierarchy');\n        var expression = node.getAttribute('data-formula');\n        var customString = node.getAttribute('data-customString');\n        var fieldTitle = select('#' + this.parentID + '_' + 'FieldNameTitle', dialogElement);\n        var memberTypeDrop = getInstance(select('#' + this.parentID + 'Member_Type_Div', dialogElement), DropDownList);\n        var hierarchyDrop = getInstance(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement), DropDownList);\n        var formatDrop = getInstance(select('#' + this.parentID + 'Format_Div', dialogElement), DropDownList);\n        /* eslint-enable max-len */\n\n        fieldTitle.innerHTML = this.parent.localeObj.getConstant('caption');\n        select('#' + this.parentID + 'droppable', document).value = expression;\n        memberTypeDrop.readonly = true;\n        memberTypeDrop.value = memberType;\n        memberTypeDrop.dataBind();\n\n        if (memberType === 'Dimension') {\n          hierarchyDrop.value = parentHierarchy;\n        }\n\n        if (formatString !== '') {\n          formatDrop.value = formatString;\n          formatDrop.dataBind();\n        }\n\n        customFormat.value = customString;\n      } else {\n        customFormat.value = formatString;\n        addClass(this.treeObj.element.querySelectorAll('.' + cls.CALC_EDITED), cls.CALC_EDIT);\n        removeClass(this.treeObj.element.querySelectorAll('.' + cls.CALC_EDITED), cls.CALC_EDITED);\n        addClass([node.querySelector('.e-list-icon')], cls.CALC_EDITED);\n        removeClass([node.querySelector('.e-list-icon')], cls.CALC_EDIT);\n        node.querySelector('.' + cls.CALC_EDITED).setAttribute('title', this.parent.localeObj.getConstant('clearCalculatedField'));\n        select('#' + this.parentID + 'droppable', document).value = node.getAttribute('data-uid');\n      }\n\n      customFormat.dataBind();\n    } else if (node.tagName === 'LI' && (node.querySelector('.' + cls.CALC_EDITED) && node.querySelector('.' + cls.CALC_EDITED).classList.contains('e-list-icon') && edited || this.parent.dataType === 'olap' && !node.classList.contains('e-active'))) {\n      this.isEdit = false;\n      this.inputObj.value = '';\n      this.inputObj.dataBind();\n      var dialogElement = this.dialog.element;\n      var customFormat = getInstance(select('#' + this.parentID + 'Custom_Format_Element', dialogElement), MaskedTextBox);\n      customFormat.value = '';\n      customFormat.dataBind();\n\n      if (this.parent.dataType === 'olap') {\n        var hierarchyDrop = getInstance(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement), DropDownList);\n        var formatDrop = getInstance(select('#' + this.parentID + 'Format_Div', dialogElement), DropDownList);\n        var memberTypeDrop = getInstance(select('#' + this.parentID + 'Member_Type_Div', dialogElement), DropDownList);\n        var fieldTitle = select('#' + this.parentID + '_' + 'FieldNameTitle', dialogElement);\n        /* eslint-enable max-len */\n\n        fieldTitle.innerHTML = this.parent.localeObj.getConstant('fieldTitle');\n        hierarchyDrop.index = 0;\n        hierarchyDrop.dataBind();\n        formatDrop.index = 0;\n        formatDrop.dataBind();\n        memberTypeDrop.index = 0;\n        memberTypeDrop.readonly = false;\n        memberTypeDrop.dataBind();\n      } else {\n        addClass(this.treeObj.element.querySelectorAll('.' + cls.CALC_EDITED), cls.CALC_EDIT);\n        removeClass(this.treeObj.element.querySelectorAll('.' + cls.CALC_EDITED), cls.CALC_EDITED);\n        node.querySelector('.' + cls.CALC_EDIT).setAttribute('title', this.parent.localeObj.getConstant('edit'));\n      }\n\n      select('#' + this.parentID + 'droppable', document).value = '';\n    } else if (node.tagName === 'LI' && node.querySelector('.' + cls.GRID_REMOVE) && node.querySelector('.' + cls.GRID_REMOVE).classList.contains('e-list-icon') && !edit && !edited) {\n      var dropField = select('#' + this.parentID + 'droppable', document);\n      var field = {\n        name: this.isEdit ? this.currentFieldName : this.inputObj.value,\n        caption: this.inputObj.value,\n        formula: dropField.value\n      };\n      this.createConfirmDialog(this.parent.localeObj.getConstant('alert'), this.parent.localeObj.getConstant('removeCalculatedField'), field, true, treeNode);\n    }\n  };\n\n  CalculatedField.prototype.removeCalcField = function (node) {\n    var dataSourceSettings = this.parent.dataSourceSettings;\n    var fieldName = node.getAttribute('data-field');\n    var calcfields = dataSourceSettings.calculatedFieldSettings;\n    var engineModule;\n\n    if (this.parent.dataType === 'pivot') {\n      if (!this.parent.isAdaptive) {\n        this.treeObj.removeNodes([node]);\n      } else {\n        var index = parseInt(node.getAttribute('id').split(this.parentID + '_')[1], 10);\n\n        if (typeof index === 'number') {\n          this.accordion.removeItem(index);\n        }\n      }\n    }\n\n    for (var i = 0; i < calcfields.length; i++) {\n      if (calcfields[i] && calcfields[i].name === fieldName) {\n        calcfields.splice(i, 1);\n        break;\n      }\n    }\n\n    if (this.parent.dataType === 'olap') {\n      engineModule = this.parent.olapEngineModule;\n      var fields_1 = engineModule.fieldListData ? engineModule.fieldListData : [];\n      /* eslint-disable @typescript-eslint/no-explicit-any */\n\n      for (var _i = 0, _a = Object.keys(fields_1); _i < _a.length; _i++) {\n        var item = _a[_i];\n\n        if (fields_1[item].name === fieldName) {\n          var index = parseInt(item, 10);\n\n          if (typeof index === 'number') {\n            fields_1.splice(index, 1);\n            break;\n          }\n        }\n      }\n      /* eslint-enable @typescript-eslint/no-explicit-any */\n\n\n      var parentID = this.treeObj.getNode(node).parentID;\n      this.treeObj.removeNodes([node]);\n\n      if (calcfields.length <= 0) {\n        this.treeObj.removeNodes([parentID]);\n      }\n    } else {\n      engineModule = this.parent.engineModule;\n    }\n\n    if (engineModule.fields) {\n      for (var i = 0; i < engineModule.fields.length; i++) {\n        if (engineModule.fields[i] === fieldName) {\n          engineModule.fields.splice(i, 1);\n          break;\n        }\n      }\n    }\n\n    if (engineModule.savedFieldList && engineModule.savedFieldList[fieldName]) {\n      delete engineModule.savedFieldList[fieldName];\n    }\n\n    if (engineModule.fieldList && engineModule.fieldList[fieldName]) {\n      delete engineModule.fieldList[fieldName];\n    }\n\n    var formatFields = dataSourceSettings.formatSettings;\n\n    for (var i = 0; i < formatFields.length; i++) {\n      if (formatFields[i] && formatFields[i].name === fieldName) {\n        formatFields.splice(i, 1);\n        break;\n      }\n    }\n\n    var fields = [dataSourceSettings.values, dataSourceSettings.rows, dataSourceSettings.columns, dataSourceSettings.filters];\n\n    for (var i = 0, n = fields.length; i < n; i++) {\n      for (var j = 0, length_1 = fields[i].length; j < length_1; j++) {\n        if (fields[i][j].name === fieldName) {\n          fields[i].splice(j, 1);\n          break;\n        }\n      }\n    }\n    /* eslint-enable max-len */\n\n\n    if (this.isEdit && this.currentFieldName === fieldName) {\n      this.isEdit = false;\n      this.inputObj.value = '';\n      this.currentFieldName = this.formatText = this.fieldText = this.formatType = null;\n      this.formulaText = this.fieldType = this.parentHierarchy = null;\n    }\n\n    if (!this.parent.allowDeferLayoutUpdate || this.parent.getModuleName() !== 'pivotfieldlist') {\n      this.parent.updateDataSource();\n    }\n\n    this.removeErrorDialog();\n  };\n  /**\n   * To set position for context menu.\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.openContextMenu = function (node) {\n    var _this = this;\n\n    var fieldName = node.getAttribute('data-field');\n    var type = this.parent.engineModule.fieldList[fieldName].type !== 'number' ? 'string' : 'number';\n    var validSummaryTypes = type === 'string' ? this.getValidSummaryType().slice(0, 2) : this.getValidSummaryType();\n    var eventArgs = {\n      cancel: false,\n      fieldName: fieldName,\n      aggregateTypes: this.getMenuItems(type).slice()\n    };\n    var control = this.parent.getModuleName() === 'pivotfieldlist' && this.parent.isPopupView ? this.parent.pivotGridModule : this.parent;\n    control.trigger(events.aggregateMenuOpen, eventArgs, function (observedArgs) {\n      if (!observedArgs.cancel) {\n        var duplicateTypes = [];\n        var items = [];\n\n        for (var _i = 0, _a = observedArgs.aggregateTypes; _i < _a.length; _i++) {\n          var option = _a[_i];\n\n          if (validSummaryTypes.indexOf(option) > -1 && duplicateTypes.indexOf(option) === -1) {\n            duplicateTypes.push(option);\n            items.push({\n              id: _this.parent.element.id + 'Calc_' + option,\n              text: _this.parent.localeObj.getConstant(option)\n            });\n          }\n        }\n\n        _this.createMenu(items, node);\n\n        var pos = node.getBoundingClientRect();\n        var offset = window.scrollY || document.documentElement.scrollTop;\n\n        if (_this.parent.enableRtl) {\n          _this.menuObj.open(pos.top + offset, pos.left - 100);\n        } else {\n          _this.menuObj.open(pos.top + offset, pos.left + 150);\n        }\n      }\n    });\n  };\n  /**\n   * Triggers while select menu.\n   * @param  {MenuEventArgs} menu\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.selectContextMenu = function (menu) {\n    if (menu.element.textContent !== null) {\n      var field = closest(this.curMenu, '.e-list-item').getAttribute('data-caption');\n      closest(this.curMenu, '.e-list-item').setAttribute('data-type', menu.element.id.split('_').pop());\n      this.curMenu.textContent = field + ' (' + menu.element.textContent + ')';\n      addClass([this.curMenu.parentElement.parentElement], ['e-node-focus', 'e-hover']);\n      this.curMenu.parentElement.parentElement.setAttribute('tabindex', '-1');\n      this.curMenu.parentElement.parentElement.focus();\n    }\n  };\n  /**\n   * To create context menu.\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.createMenu = function (menuItems, node) {\n    var _this = this;\n\n    var menuOptions = {\n      cssClass: this.parentID + 'calculatedmenu',\n      items: menuItems,\n      enableRtl: this.parent.enableRtl,\n      locale: this.parent.locale,\n      // beforeOpen: this.beforeMenuOpen.bind(this),\n      select: this.selectContextMenu.bind(this),\n      onClose: function () {\n        _this.treeObj.element.focus();\n\n        addClass([node], ['e-hover', 'e-node-focus']);\n      }\n    };\n    var contextMenu;\n\n    if (select('#' + this.parentID + 'CalcContextmenu', document)) {\n      contextMenu = select('#' + this.parentID + 'CalcContextmenu', document);\n    } else {\n      contextMenu = createElement('ul', {\n        id: this.parentID + 'CalcContextmenu'\n      });\n    }\n\n    this.dialog.element.appendChild(contextMenu);\n    this.menuObj = new Menu(menuOptions);\n    this.menuObj.isStringTemplate = true;\n    this.menuObj.appendTo(contextMenu);\n  };\n  /**\n   * Triggers while click OK button.\n   * @returns {void}\n   */\n\n  /* eslint-disable  */\n\n\n  CalculatedField.prototype.applyFormula = function () {\n    var _this = this;\n\n    var currentObj = this;\n    var isExist = false;\n    removeClass([document.getElementById(this.parentID + 'ddlelement')], cls.EMPTY_FIELD);\n    this.newFields = extend([], this.parent.dataSourceSettings.calculatedFieldSettings, null, true);\n    var eventArgs = {\n      fieldName: this.isEdit ? this.currentFieldName : this.inputObj.value,\n      calculatedField: this.getCalculatedFieldInfo(),\n      calculatedFieldSettings: PivotUtil.cloneCalculatedFieldSettings(this.parent.dataSourceSettings.calculatedFieldSettings),\n      cancel: false\n    };\n    var control = this.parent.getModuleName() === 'pivotfieldlist' && this.parent.isPopupView ? this.parent.pivotGridModule : this.parent;\n    control.trigger(events.calculatedFieldCreate, eventArgs, function (observedArgs) {\n      if (!observedArgs.cancel) {\n        var calcInfo = observedArgs.calculatedField;\n\n        if (!_this.isEdit) {\n          if (currentObj.parent.dataType === 'olap') {\n            var field = calcInfo.name;\n\n            if (currentObj.parent.olapEngineModule.fieldList[field] && currentObj.parent.olapEngineModule.fieldList[field].type !== 'CalculatedField') {\n              isExist = true;\n            }\n          } else {\n            for (var _i = 0, _a = Object.keys(currentObj.parent.engineModule.fieldList); _i < _a.length; _i++) {\n              var key = _a[_i];\n\n              if (calcInfo.name && calcInfo.name === key && currentObj.parent.engineModule.fieldList[key].aggregateType !== 'CalculatedField') {\n                isExist = true;\n              }\n            }\n          }\n        }\n\n        if (isExist) {\n          currentObj.parent.pivotCommon.errorDialog.createErrorDialog(currentObj.parent.localeObj.getConstant('error'), currentObj.parent.localeObj.getConstant('fieldExist'));\n          return;\n        }\n\n        _this.existingReport = extend({}, _this.parent.dataSourceSettings, null, true);\n        var report = _this.parent.dataSourceSettings;\n\n        if (!isNullOrUndefined(calcInfo.name) && calcInfo.name !== '' && !isNullOrUndefined(calcInfo.caption) && calcInfo.caption !== '' && calcInfo.formula && calcInfo.formula !== '') {\n          var field = void 0;\n\n          if (_this.parent.dataType === 'olap') {\n            field = {\n              name: calcInfo.name,\n              formula: calcInfo.formula,\n              formatString: calcInfo.formatString\n            };\n\n            if (!isNullOrUndefined(calcInfo.hierarchyUniqueName)) {\n              field.hierarchyUniqueName = calcInfo.hierarchyUniqueName;\n            }\n\n            _this.isFieldExist = false;\n\n            if (!_this.isEdit) {\n              for (var i = 0; i < report.calculatedFieldSettings.length; i++) {\n                if (report.calculatedFieldSettings[i].name === field.name) {\n                  _this.createConfirmDialog(currentObj.parent.localeObj.getConstant('alert'), currentObj.parent.localeObj.getConstant('confirmText'), calcInfo);\n\n                  return;\n                }\n              }\n            } else {\n              for (var i = 0; i < report.calculatedFieldSettings.length; i++) {\n                if (report.calculatedFieldSettings[i].name === field.name && _this.isEdit) {\n                  report.calculatedFieldSettings[i].hierarchyUniqueName = calcInfo.hierarchyUniqueName;\n                  _this.parent.olapEngineModule.fieldList[field.name].caption = calcInfo.caption;\n                  report.calculatedFieldSettings[i].formatString = field.formatString;\n                  report.calculatedFieldSettings[i].formula = field.formula;\n                  field = report.calculatedFieldSettings[i];\n                  _this.isFieldExist = true;\n                  break;\n                }\n              }\n\n              var axisFields = [report.rows, report.columns, report.values, report.filters];\n              var isFieldExist = false;\n\n              for (var _b = 0, axisFields_1 = axisFields; _b < axisFields_1.length; _b++) {\n                var fields = axisFields_1[_b];\n\n                for (var _c = 0, fields_2 = fields; _c < fields_2.length; _c++) {\n                  var item = fields_2[_c];\n\n                  if (item.isCalculatedField && field.name !== null && item.name === field.name && _this.isEdit) {\n                    item.caption = calcInfo.caption;\n                    _this.isFieldExist = true;\n                    isFieldExist = true;\n                    break;\n                  }\n                }\n\n                if (isFieldExist) {\n                  break;\n                }\n              }\n            }\n\n            if (!_this.isFieldExist) {\n              report.calculatedFieldSettings.push(field);\n            }\n\n            _this.parent.lastCalcFieldInfo = field;\n          } else {\n            field = {\n              name: calcInfo.name,\n              caption: calcInfo.caption,\n              type: 'CalculatedField'\n            };\n            var cField = {\n              name: calcInfo.name,\n              formula: calcInfo.formula\n            };\n\n            if (!isNullOrUndefined(calcInfo.formatString)) {\n              cField.formatString = calcInfo.formatString;\n            }\n\n            _this.isFieldExist = true;\n\n            if (!_this.isEdit) {\n              for (var i = 0; i < report.values.length; i++) {\n                if (report.values[i].type === CALC && report.values[i].name === field.name) {\n                  for (var j = 0; j < report.calculatedFieldSettings.length; j++) {\n                    if (report.calculatedFieldSettings[j].name === field.name) {\n                      _this.createConfirmDialog(currentObj.parent.localeObj.getConstant('alert'), currentObj.parent.localeObj.getConstant('confirmText'), calcInfo);\n\n                      return;\n                    }\n                  }\n\n                  _this.isFieldExist = false;\n                }\n              }\n            } else {\n              for (var i = 0; i < report.values.length; i++) {\n                if (report.values[i].type === CALC && field.name !== null && report.values[i].name === field.name && _this.isEdit) {\n                  for (var j = 0; j < report.calculatedFieldSettings.length; j++) {\n                    if (report.calculatedFieldSettings[j].name === field.name) {\n                      report.values[i].caption = calcInfo.caption;\n                      _this.currentFormula = report.calculatedFieldSettings[j].formula;\n                      report.calculatedFieldSettings[j].formula = calcInfo.formula;\n                      _this.parent.engineModule.fieldList[field.name].caption = calcInfo.caption;\n\n                      _this.updateFormatSettings(report, field.name, calcInfo.formatString);\n\n                      _this.isFieldExist = false;\n                    }\n                  }\n                }\n              }\n            }\n\n            if (_this.isFieldExist) {\n              report.values.push(field);\n              report.calculatedFieldSettings.push(cField);\n\n              _this.updateFormatSettings(report, field.name, calcInfo.formatString);\n            }\n\n            _this.parent.lastCalcFieldInfo = cField;\n          }\n\n          _this.addFormula(report, field.name);\n        } else {\n          if (isNullOrUndefined(calcInfo.name) || calcInfo.name === '' || isNullOrUndefined(calcInfo.caption) || calcInfo.caption === '') {\n            _this.inputObj.value = '';\n            addClass([document.getElementById(_this.parentID + 'ddlelement')], cls.EMPTY_FIELD);\n            document.getElementById(_this.parentID + 'ddlelement').focus();\n          } else {\n            _this.parent.pivotCommon.errorDialog.createErrorDialog(_this.parent.localeObj.getConstant('error'), _this.parent.localeObj.getConstant('invalidFormula'));\n          }\n        }\n      } else {\n        _this.endDialog();\n\n        _this.parent.lastCalcFieldInfo = {};\n        _this.isFormula = false;\n      }\n    });\n  };\n\n  CalculatedField.prototype.getCalculatedFieldInfo = function () {\n    var field;\n    var dropField = select('#' + this.parentID + 'droppable', document);\n    var dialogElement = this.parent.isAdaptive ? this.parent.dialogRenderer.adaptiveElement.element : this.dialog.element;\n    var customFormat = getInstance(select('#' + this.parentID + 'Custom_Format_Element', dialogElement), MaskedTextBox);\n    field = {\n      name: this.isEdit ? this.currentFieldName : this.inputObj.value,\n      caption: this.inputObj.value,\n      formula: dropField.value\n    };\n\n    if (this.parent.dataType === 'olap') {\n      var formatDrop = getInstance(select('#' + this.parentID + 'Format_Div', dialogElement), DropDownList);\n      var memberTypeDrop = getInstance(select('#' + this.parentID + 'Member_Type_Div', dialogElement), DropDownList);\n      var hierarchyDrop = getInstance(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement), DropDownList);\n      field.formatString = formatDrop.value === 'Custom' ? customFormat.value : formatDrop.value;\n\n      if (memberTypeDrop.value === 'Dimension') {\n        field.hierarchyUniqueName = hierarchyDrop.value;\n      }\n    } else {\n      field.formatString = customFormat.value;\n    }\n\n    return field;\n  };\n  /* eslint-enable max-len */\n\n\n  CalculatedField.prototype.updateFormatSettings = function (report, fieldName, formatString) {\n    var newFormat = {\n      name: fieldName,\n      format: formatString,\n      useGrouping: true\n    };\n    var isFormatExist = false;\n\n    for (var i = 0; i < report.formatSettings.length; i++) {\n      if (report.formatSettings[i].name === fieldName) {\n        if (formatString === 'undefined' || formatString === undefined || formatString === '') {\n          report.formatSettings.splice(i, 1);\n          isFormatExist = true;\n          break;\n        } else {\n          var formatObj = report.formatSettings[i].properties ? report.formatSettings[i].properties : report.formatSettings[i];\n          formatObj.format = formatString;\n          report.formatSettings.splice(i, 1, formatObj);\n          isFormatExist = true;\n          break;\n        }\n      }\n    }\n\n    if (!isFormatExist && formatString !== '') {\n      report.formatSettings.push(newFormat);\n    }\n  };\n\n  CalculatedField.prototype.addFormula = function (report, field) {\n    this.isFormula = true;\n    this.field = field;\n\n    if (isBlazor() || this.parent.dataSourceSettings.mode === 'Server') {\n      PivotUtil.updateDataSourceSettings(this.parent, PivotUtil.getClonedDataSourceSettings(report));\n    } else {\n      this.parent.setProperties({\n        dataSourceSettings: report\n      }, true);\n    }\n\n    if (this.parent.getModuleName() === 'pivotfieldlist' && this.parent.allowDeferLayoutUpdate) {\n      this.parent.isRequiredUpdate = false;\n    }\n\n    try {\n      this.parent.updateDataSource(false);\n      var pivot = this.parent.getModuleName() === 'pivotfieldlist' && this.parent.pivotGridModule ? this.parent.pivotGridModule : this.parent;\n\n      if (!(isBlazor() && pivot && pivot.enableVirtualization) && pivot && pivot.dataSourceSettings.mode !== 'Server') {\n        this.endDialog();\n      } else {\n        this.isRequireUpdate = true;\n      }\n\n      if (this.parent.getModuleName() === 'pivotfieldlist' && this.parent.renderMode === 'Fixed' && this.parent.allowDeferLayoutUpdate) {\n        this.parent.pivotChange = true;\n      }\n    } catch (exception) {\n      this.showError();\n    }\n  };\n  /** @hidden */\n\n\n  CalculatedField.prototype.endDialog = function () {\n    this.isEdit = false;\n\n    if (this.dialog) {\n      this.dialog.close();\n    } else {\n      this.inputObj.value = '';\n      this.currentFieldName = this.formatText = this.fieldText = this.formatType = null;\n      this.formulaText = this.fieldType = this.parentHierarchy = null;\n      var dialogElement = this.parent.isAdaptive ? this.parent.dialogRenderer.parentElement : this.dialog.element;\n      this.parent.dialogRenderer.parentElement.querySelector('.' + cls.CALCINPUT).value = '';\n      select('#' + this.parentID + 'droppable', this.parent.dialogRenderer.parentElement).value = '';\n      select('#' + this.parentID + 'Custom_Format_Element', this.parent.dialogRenderer.parentElement).value = '';\n\n      if (this.parent.dataType === 'olap') {\n        var customFormat = getInstance(select('#' + this.parentID + 'Custom_Format_Element', dialogElement), MaskedTextBox);\n        var formatDrop = getInstance(select('#' + this.parentID + 'Format_Div', dialogElement), DropDownList);\n        var memberTypeDrop = getInstance(select('#' + this.parentID + 'Member_Type_Div', dialogElement), DropDownList);\n        var hierarchyDrop = getInstance(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement), DropDownList);\n        formatDrop.index = 0;\n        formatDrop.dataBind();\n        memberTypeDrop.index = 0;\n        memberTypeDrop.readonly = false;\n        memberTypeDrop.dataBind();\n        hierarchyDrop.index = 0;\n        hierarchyDrop.enabled = false;\n        hierarchyDrop.dataBind();\n        customFormat.enabled = false;\n        customFormat.dataBind();\n      }\n      /* eslint-enable max-len */\n\n    }\n  };\n  /** @hidden */\n\n\n  CalculatedField.prototype.showError = function () {\n    if (this.parent.engineModule.fieldList[this.field]) {\n      delete this.parent.engineModule.fieldList[this.field];\n    }\n\n    this.parent.pivotCommon.errorDialog.createErrorDialog(this.parent.localeObj.getConstant('error'), this.parent.localeObj.getConstant('invalidFormula'));\n\n    if (isBlazor()) {\n      PivotUtil.updateDataSourceSettings(this.parent, PivotUtil.getClonedDataSourceSettings(this.existingReport));\n    } else {\n      this.parent.setProperties({\n        dataSourceSettings: this.existingReport\n      }, true);\n    }\n\n    if (this.isEdit) {\n      var calcFields = this.parent.dataSourceSettings.calculatedFieldSettings;\n\n      for (var i = 0; calcFields && i < calcFields.length; i++) {\n        if (calcFields[i].name === this.field) {\n          calcFields[i].formula = this.currentFormula;\n          break;\n        }\n      }\n    } else if (this.parent.engineModule.fields) {\n      for (var i = 0; i < this.parent.engineModule.fields.length; i++) {\n        if (this.parent.engineModule.fields[i] === this.field) {\n          this.parent.engineModule.fields.splice(i, 1);\n          break;\n        }\n      }\n    }\n\n    this.parent.lastCalcFieldInfo = {};\n    this.parent.updateDataSource(false);\n    this.isFormula = false;\n  };\n  /**\n   * To get treeview data\n   * @param  {PivotGrid|PivotFieldList} parent\n   * @returns Object\n   */\n\n\n  CalculatedField.prototype.getFieldListData = function (parent) {\n    var fields = [];\n\n    if (this.parent.dataType === 'olap') {\n      fields = PivotUtil.getClonedData(parent.olapEngineModule.fieldListData ? parent.olapEngineModule.fieldListData : []);\n\n      for (var _i = 0, _a = fields; _i < _a.length; _i++) {\n        var item = _a[_i];\n\n        if (item.spriteCssClass && (item.spriteCssClass.indexOf('e-attributeCDB-icon') > -1 || item.spriteCssClass.indexOf('e-level-members') > -1)) {\n          item.hasChildren = true;\n        } else if (item.spriteCssClass && item.spriteCssClass.indexOf('e-namedSetCDB-icon') > -1) {\n          item.hasChildren = false;\n        } else if (item.spriteCssClass && item.spriteCssClass.indexOf('e-calcMemberGroupCDB') > -1) {\n          item.expanded = this.isEdit;\n        }\n      }\n    } else {\n      for (var _b = 0, _c = parent.engineModule.fieldList ? Object.keys(parent.engineModule.fieldList) : []; _b < _c.length; _b++) {\n        var key = _c[_b];\n        var type = null;\n        var typeVal = null;\n\n        if ((parent.engineModule.fieldList[key].type !== 'number' || parent.engineModule.fieldList[key].type === 'include' || parent.engineModule.fieldList[key].type === 'exclude') && parent.engineModule.fieldList[key].aggregateType !== 'DistinctCount') {\n          typeVal = COUNT;\n        } else {\n          typeVal = parent.engineModule.fieldList[key].aggregateType !== undefined ? parent.engineModule.fieldList[key].aggregateType : SUM;\n        }\n\n        type = this.parent.localeObj.getConstant(typeVal);\n        fields.push({\n          index: parent.engineModule.fieldList[key].index,\n          name: parent.engineModule.fieldList[key].caption + ' (' + type + ')',\n          type: typeVal,\n          icon: cls.FORMAT + ' ' + cls.ICON,\n          formula: parent.engineModule.fieldList[key].formula,\n          field: key,\n          caption: parent.engineModule.fieldList[key].caption ? parent.engineModule.fieldList[key].caption : key\n        });\n      }\n    }\n\n    return fields;\n  };\n  /**\n   * Triggers before menu opens.\n   * @param  {BeforeOpenCloseMenuEventArgs} args\n   * @returns {void}\n   */\n\n  /**\n   * Trigger while drop node in formula field.\n   * @param  {DragAndDropEventArgs} args\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.fieldDropped = function (args) {\n    args.cancel = true;\n    var dropField = select('#' + this.parentID + 'droppable', this.dialog.element);\n    removeClass([dropField], 'e-copy-drop');\n    removeClass([args.draggedNode.querySelector('.' + cls.LIST_TEXT_CLASS)], cls.SELECTED_NODE_CLASS);\n    var field = args.draggedNode.getAttribute('data-field');\n\n    if (this.parent.dataType === 'olap') {\n      if (this.parent.olapEngineModule.fieldList[field] && this.parent.olapEngineModule.fieldList[field].isCalculatedField) {\n        field = this.parent.olapEngineModule.fieldList[field].tag;\n      }\n\n      if (args.target.id === this.parentID + 'droppable' && dropField.value === '') {\n        dropField.value = field;\n        dropField.focus();\n      } else if (args.target.id === this.parentID + 'droppable' && dropField.value !== '') {\n        var textCovered = void 0;\n        var currentValue = dropField.value;\n        var cursorPos = dropField.selectionStart;\n        var textAfterText = currentValue.substring(cursorPos, currentValue.length);\n        var textBeforeText = currentValue.substring(0, cursorPos);\n        textCovered = textBeforeText + field;\n        dropField.value = textBeforeText + field + textAfterText;\n        dropField.focus();\n        dropField.setSelectionRange(textCovered.length, textCovered.length);\n      } else {\n        args.cancel = true;\n      }\n    } else {\n      var type = args.draggedNode.getAttribute('data-type');\n\n      if (args.target.id === this.parentID + 'droppable' && dropField.value === '') {\n        if (type === CALC) {\n          dropField.value = args.draggedNodeData.id.toString();\n        } else {\n          dropField.value = '\"' + type + '(' + field + ')' + '\"';\n        }\n\n        dropField.focus();\n      } else if (args.target.id === this.parentID + 'droppable' && dropField.value !== '') {\n        var textCovered = void 0;\n        var cursorPos = dropField.selectionStart;\n        var currentValue = dropField.value;\n        var textBeforeText = currentValue.substring(0, cursorPos);\n        var textAfterText = currentValue.substring(cursorPos, currentValue.length);\n\n        if (type === CALC) {\n          textCovered = textBeforeText + args.draggedNodeData.id.toString();\n          dropField.value = textBeforeText + args.draggedNodeData.id.toString() + textAfterText;\n        } else {\n          textCovered = textBeforeText + '\"' + type + '(' + field + ')' + '\"';\n          dropField.value = textBeforeText + '\"' + type + '(' + field + ')' + '\"' + textAfterText;\n        }\n\n        dropField.focus();\n        dropField.setSelectionRange(textCovered.length, textCovered.length);\n      } else {\n        args.cancel = true;\n      }\n    }\n  };\n  /**\n   * To create dialog.\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.createDialog = function () {\n    var _this = this;\n\n    if (select('#' + this.parentID + 'calculateddialog', document) !== null) {\n      remove(select('#' + this.parentID + 'calculateddialog', document));\n\n      while (!isNullOrUndefined(document.querySelector('.' + this.parentID + 'calculatedmenu'))) {\n        remove(document.querySelector('.' + this.parentID + 'calculatedmenu'));\n      }\n    }\n\n    this.parent.element.appendChild(createElement('div', {\n      id: this.parentID + 'calculateddialog',\n      className: cls.CALCDIALOG + ' ' + (this.parent.dataType === 'olap' ? cls.OLAP_CALCDIALOG : '')\n    }));\n    var calcButtons = [{\n      click: this.applyFormula.bind(this),\n      buttonModel: {\n        content: this.parent.localeObj.getConstant('ok'),\n        isPrimary: true\n      }\n    }, {\n      click: this.cancelClick.bind(this),\n      buttonModel: {\n        content: this.parent.localeObj.getConstant('cancel')\n      }\n    }];\n\n    if (this.parent.dataType === 'olap') {\n      var clearButton = {\n        click: this.clearFormula.bind(this),\n        buttonModel: {\n          cssClass: 'e-calc-clear-btn',\n          content: this.parent.localeObj.getConstant('clear')\n        }\n      };\n      calcButtons.splice(0, 0, clearButton);\n    }\n\n    this.dialog = new Dialog({\n      allowDragging: true,\n      position: {\n        X: 'center',\n        Y: 'center'\n      },\n      buttons: calcButtons,\n      close: this.closeDialog.bind(this),\n      beforeOpen: this.beforeOpen.bind(this),\n      open: function () {\n        if (select('#' + _this.parentID + 'ddlelement', _this.dialog.element)) {\n          select('#' + _this.parentID + 'ddlelement', _this.dialog.element).focus();\n        }\n      },\n      animationSettings: {\n        effect: 'Zoom'\n      },\n      width: '25%',\n      isModal: false,\n      closeOnEscape: true,\n      enableRtl: this.parent.enableRtl,\n      locale: this.parent.locale,\n      showCloseIcon: true,\n      header: this.parent.localeObj.getConstant('createCalculatedField'),\n      target: document.body\n    });\n    this.dialog.isStringTemplate = true;\n    this.dialog.appendTo('#' + this.parentID + 'calculateddialog');\n  };\n\n  CalculatedField.prototype.cancelClick = function () {\n    this.dialog.close();\n    this.isEdit = false;\n  };\n\n  CalculatedField.prototype.beforeOpen = function (args) {\n    // this.dialog.element.querySelector('.e-dlg-header').innerHTML = this.parent.localeObj.getConstant('createCalculatedField');\n    this.dialog.element.querySelector('.e-dlg-header').setAttribute('title', this.parent.localeObj.getConstant('createCalculatedField'));\n  };\n\n  CalculatedField.prototype.closeDialog = function (args) {\n    if (this.parent.getModuleName() === 'pivotfieldlist') {\n      this.parent.axisFieldModule.render();\n\n      if (this.parent.renderMode !== 'Fixed') {\n        addClass([this.parent.element.querySelector('.' + cls.TOGGLE_FIELD_LIST_CLASS)], cls.ICON_HIDDEN);\n        this.parent.dialogRenderer.fieldListDialog.show();\n      }\n    }\n\n    this.treeObj.destroy();\n    this.dialog.destroy();\n    this.newFields = null;\n\n    if (this.menuObj && !this.menuObj.isDestroyed) {\n      this.menuObj.destroy();\n    }\n\n    remove(document.getElementById(this.parentID + 'calculateddialog'));\n\n    if (!isNullOrUndefined(document.querySelector('.' + this.parentID + 'calculatedmenu'))) {\n      remove(document.querySelector('.' + this.parentID + 'calculatedmenu'));\n    }\n\n    var timeOut = this.parent.getModuleName() === 'pivotview' || this.parent.getModuleName() === 'pivotfieldlist' && this.parent.renderMode === 'Fixed' ? 0 : 500;\n\n    if (this.buttonCall) {\n      this.buttonCall = false;\n      setTimeout(this.setFocus.bind(this), timeOut);\n    }\n  };\n\n  CalculatedField.prototype.setFocus = function () {\n    var parentElement;\n\n    if (this.parent.getModuleName() === 'pivotview' && this.parent.element) {\n      parentElement = this.parent.element;\n    } else if (document.getElementById(this.parent.element.id + '_Wrapper')) {\n      parentElement = document.getElementById(this.parent.element.id + '_Wrapper');\n    }\n\n    if (parentElement) {\n      var pivotButtons = [].slice.call(parentElement.querySelectorAll('.e-pivot-button'));\n\n      for (var _i = 0, pivotButtons_1 = pivotButtons; _i < pivotButtons_1.length; _i++) {\n        var item = pivotButtons_1[_i];\n\n        if (item.getAttribute('data-uid') === this.currentFieldName) {\n          item.focus();\n          break;\n        }\n      }\n    }\n  };\n  /**\n   * To render dialog elements.\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.renderDialogElements = function () {\n    var outerDiv = createElement('div', {\n      id: this.parentID + 'outerDiv',\n      className: (this.parent.dataType === 'olap' ? cls.OLAP_CALCOUTERDIV + ' ' : '') + cls.CALCOUTERDIV\n    });\n    var olapFieldTreeDiv = createElement('div', {\n      id: this.parentID + 'Olap_Tree_Div',\n      className: 'e-olap-field-tree-div'\n    });\n    var olapCalcDiv = createElement('div', {\n      id: this.parentID + 'Olap_Calc_Div',\n      className: 'e-olap-calculated-div'\n    });\n\n    if (this.parent.getModuleName() === 'pivotfieldlist' && this.parent.dialogRenderer.parentElement.querySelector('.' + cls.FORMULA) !== null && this.parent.isAdaptive) {\n      var accordDiv = createElement('div', {\n        id: this.parentID + 'accordDiv',\n        className: cls.CALCACCORD\n      });\n      outerDiv.appendChild(accordDiv);\n      var buttonDiv = createElement('div', {\n        id: this.parentID + 'buttonDiv',\n        className: cls.CALCBUTTONDIV\n      });\n      var addBtn = createElement('button', {\n        id: this.parentID + 'addBtn',\n        innerHTML: this.parent.localeObj.getConstant('add'),\n        className: cls.CALCADDBTN,\n        attrs: {\n          'type': 'button'\n        }\n      });\n      var cancelBtn = createElement('button', {\n        id: this.parentID + 'cancelBtn',\n        innerHTML: this.parent.localeObj.getConstant('cancel'),\n        className: cls.CALCCANCELBTN,\n        attrs: {\n          'type': 'button'\n        }\n      });\n      buttonDiv.appendChild(cancelBtn);\n      buttonDiv.appendChild(addBtn);\n      outerDiv.appendChild(buttonDiv);\n    } else {\n      if (!this.parent.isAdaptive && this.parent.dataType === 'olap') {\n        var formulaTitle = createElement('div', {\n          className: cls.PIVOT_FIELD_TITLE_CLASS,\n          id: this.parentID + '_' + 'FieldNameTitle',\n          innerHTML: this.parent.localeObj.getConstant('fieldTitle')\n        });\n        olapCalcDiv.appendChild(formulaTitle);\n      }\n\n      var inputDiv = createElement('div', {\n        id: this.parentID + 'outerDiv',\n        className: cls.CALCINPUTDIV\n      });\n      var inputObj = createElement('input', {\n        id: this.parentID + 'ddlelement',\n        attrs: {\n          'type': 'text'\n        },\n        className: cls.CALCINPUT\n      });\n      inputDiv.appendChild(inputObj);\n      this.parent.dataType === 'olap' && !this.parent.isAdaptive ? olapCalcDiv.appendChild(inputDiv) : outerDiv.appendChild(inputDiv);\n      var wrapDiv = createElement('div', {\n        id: this.parentID + 'control_wrapper',\n        className: cls.TREEVIEWOUTER\n      });\n\n      if (!this.parent.isAdaptive) {\n        var fieldTitle = createElement('div', {\n          className: cls.PIVOT_ALL_FIELD_TITLE_CLASS,\n          innerHTML: this.parent.dataType === 'olap' ? this.parent.localeObj.getConstant('allFields') : this.parent.localeObj.getConstant('formulaField')\n        });\n\n        if (this.parent.dataType === 'olap') {\n          var headerWrapperDiv = createElement('div', {\n            className: cls.PIVOT_ALL_FIELD_TITLE_CLASS + '-wrapper'\n          });\n          headerWrapperDiv.appendChild(fieldTitle);\n          var spanElement = createElement('span', {\n            attrs: {\n              'tabindex': '0',\n              'aria-disabled': 'false',\n              'aria-label': this.parent.localeObj.getConstant('fieldTooltip')\n            },\n            className: cls.ICON + ' ' + cls.CALC_INFO\n          });\n          headerWrapperDiv.appendChild(spanElement);\n          var tooltip = new Tooltip({\n            content: this.parent.localeObj.getConstant('fieldTooltip'),\n            position: this.parent.enableRtl ? 'RightCenter' : 'LeftCenter',\n            target: '.' + cls.CALC_INFO,\n            offsetY: this.parent.enableRtl ? -10 : -10,\n            locale: this.parent.locale,\n            enableRtl: this.parent.enableRtl,\n            width: 220\n          });\n          tooltip.appendTo(headerWrapperDiv);\n          wrapDiv.appendChild(headerWrapperDiv);\n        } else {\n          outerDiv.appendChild(fieldTitle);\n        }\n      }\n\n      var treeOuterDiv = createElement('div', {\n        className: cls.TREEVIEW + '-outer-div'\n      });\n      wrapDiv.appendChild(treeOuterDiv);\n      treeOuterDiv.appendChild(createElement('div', {\n        id: this.parentID + 'tree',\n        className: cls.TREEVIEW\n      }));\n      this.parent.dataType === 'olap' && !this.parent.isAdaptive ? olapFieldTreeDiv.appendChild(wrapDiv) : outerDiv.appendChild(wrapDiv);\n\n      if (!this.parent.isAdaptive) {\n        var formulaTitle = createElement('div', {\n          className: cls.PIVOT_FORMULA_TITLE_CLASS,\n          innerHTML: this.parent.dataType === 'olap' ? this.parent.localeObj.getConstant('expressionField') : this.parent.localeObj.getConstant('formula')\n        });\n        this.parent.dataType === 'olap' ? olapCalcDiv.appendChild(formulaTitle) : outerDiv.appendChild(formulaTitle);\n      }\n\n      var dropDiv = createElement('textarea', {\n        id: this.parentID + 'droppable',\n        className: cls.FORMULA + ' e-control e-textbox e-input',\n        attrs: {\n          'placeholder': this.parent.isAdaptive ? this.parent.localeObj.getConstant('dropTextMobile') : this.parent.dataType === 'olap' ? this.parent.localeObj.getConstant('olapDropText') : this.parent.localeObj.getConstant('dropText')\n        }\n      });\n      this.parent.dataType === 'olap' && !this.parent.isAdaptive ? olapCalcDiv.appendChild(dropDiv) : outerDiv.appendChild(dropDiv);\n\n      if (this.parent.isAdaptive) {\n        var buttonDiv = createElement('div', {\n          id: this.parentID + 'buttonDiv',\n          className: cls.CALCBUTTONDIV\n        });\n        var okBtn = createElement('button', {\n          id: this.parentID + 'okBtn',\n          innerHTML: this.parent.localeObj.getConstant('apply'),\n          className: cls.CALCOKBTN,\n          attrs: {\n            'type': 'button'\n          }\n        });\n        buttonDiv.appendChild(okBtn);\n        outerDiv.appendChild(buttonDiv);\n      }\n\n      if (this.parent.dataType === 'olap') {\n        if (!this.parent.isAdaptive) {\n          var memberTypeTitle = createElement('div', {\n            className: cls.OLAP_MEMBER_TITLE_CLASS,\n            innerHTML: this.parent.localeObj.getConstant('memberType')\n          });\n          olapCalcDiv.appendChild(memberTypeTitle);\n        }\n\n        var memberTypeDrop = createElement('div', {\n          id: this.parentID + 'Member_Type_Div',\n          className: cls.CALC_MEMBER_TYPE_DIV\n        });\n        this.parent.isAdaptive ? outerDiv.appendChild(memberTypeDrop) : olapCalcDiv.appendChild(memberTypeDrop);\n\n        if (!this.parent.isAdaptive) {\n          var hierarchyTitle = createElement('div', {\n            className: cls.OLAP_HIERARCHY_TITLE_CLASS,\n            innerHTML: this.parent.localeObj.getConstant('selectedHierarchy')\n          });\n          olapCalcDiv.appendChild(hierarchyTitle);\n        }\n\n        var hierarchyDrop = createElement('div', {\n          id: this.parentID + 'Hierarchy_List_Div',\n          className: cls.CALC_HIERARCHY_LIST_DIV\n        });\n        this.parent.isAdaptive ? outerDiv.appendChild(hierarchyDrop) : olapCalcDiv.appendChild(hierarchyDrop);\n\n        if (!this.parent.isAdaptive) {\n          var formatTitle = createElement('div', {\n            className: cls.OLAP_FORMAT_TITLE_CLASS,\n            innerHTML: this.parent.localeObj.getConstant('formatString')\n          });\n          olapCalcDiv.appendChild(formatTitle);\n        }\n\n        var formatDrop = createElement('div', {\n          id: this.parentID + 'Format_Div',\n          className: cls.CALC_FORMAT_TYPE_DIV\n        });\n        this.parent.isAdaptive ? outerDiv.appendChild(formatDrop) : olapCalcDiv.appendChild(formatDrop);\n        var customFormatDiv = createElement('div', {\n          id: this.parentID + 'custom_Format_Div',\n          className: cls.OLAP_CALC_CUSTOM_FORMAT_INPUTDIV\n        });\n        var customFormatObj = createElement('input', {\n          id: this.parentID + 'Custom_Format_Element',\n          attrs: {\n            'type': 'text'\n          },\n          className: cls.CALC_FORMAT_INPUT\n        });\n        customFormatDiv.appendChild(customFormatObj);\n        olapCalcDiv.appendChild(customFormatDiv);\n        this.parent.isAdaptive ? outerDiv.appendChild(customFormatDiv) : olapCalcDiv.appendChild(customFormatDiv);\n\n        if (this.parent.getModuleName() === 'pivotfieldlist' && this.parent.dialogRenderer.parentElement.querySelector('.' + cls.FORMULA) === null && this.parent.isAdaptive) {\n          var okBtn = outerDiv.querySelector('.' + cls.CALCOKBTN);\n          outerDiv.appendChild(okBtn);\n        } else {\n          outerDiv.appendChild(olapFieldTreeDiv);\n          outerDiv.appendChild(olapCalcDiv);\n        }\n      } else {\n        var customFormatDiv = createElement('div', {\n          id: this.parentID + 'custom_Format_Div',\n          className: cls.CALC_CUSTOM_FORMAT_INPUTDIV\n        });\n\n        if (!this.parent.isAdaptive) {\n          var formatTitle = createElement('div', {\n            className: cls.OLAP_FORMAT_TITLE_CLASS,\n            innerHTML: this.parent.localeObj.getConstant('formatString')\n          });\n          customFormatDiv.appendChild(formatTitle);\n        }\n\n        var customFormatObj = createElement('input', {\n          id: this.parentID + 'Custom_Format_Element',\n          attrs: {\n            'type': 'text'\n          },\n          className: cls.CALC_FORMAT_INPUT\n        });\n        customFormatDiv.appendChild(customFormatObj);\n        this.parent.isAdaptive ? outerDiv.insertBefore(customFormatDiv, select('#' + this.parentID + 'buttonDiv', outerDiv)) : outerDiv.appendChild(customFormatDiv);\n      }\n    }\n\n    return outerDiv;\n  };\n  /**\n   * To create calculated field adaptive layout.\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.renderAdaptiveLayout = function (isEdit) {\n    var dialogElement = this.parent.dialogRenderer.adaptiveElement;\n\n    if (isEdit) {\n      if (select('#' + this.parentID + 'droppable', dialogElement.element)) {\n        this.formulaText = select('#' + this.parentID + 'droppable', document).value;\n        this.fieldText = this.inputObj.value;\n      }\n\n      if (dialogElement.element.querySelector('.' + cls.CALC_MEMBER_TYPE_DIV)) {\n        var memberTypeDrop = getInstance(select('#' + this.parentID + 'Member_Type_Div', dialogElement.element), DropDownList);\n        this.fieldType = memberTypeDrop.value;\n      }\n\n      if (dialogElement.element.querySelector('.' + cls.CALC_HIERARCHY_LIST_DIV)) {\n        var hierarchyDrop = getInstance(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement.element), DropDownList);\n        this.parentHierarchy = this.fieldType === 'Dimension' ? hierarchyDrop.value : null;\n      }\n\n      if (dialogElement.element.querySelector('.' + cls.CALC_FORMAT_TYPE_DIV)) {\n        var formatDrop = getInstance(select('#' + this.parentID + 'Format_Div', dialogElement.element), DropDownList);\n        this.formatType = formatDrop.value;\n      }\n\n      if (dialogElement.element.querySelector('.' + cls.CALC_FORMAT_INPUT)) {\n        var customFormat = getInstance(select('#' + this.parentID + 'Custom_Format_Element', dialogElement.element), MaskedTextBox);\n        this.formatText = this.parent.dataType === 'olap' ? this.formatType === 'Custom' ? customFormat.value : null : customFormat.value;\n      }\n    } else {\n      this.currentFieldName = this.formulaText = this.fieldText = this.formatText = null;\n      this.fieldType = this.formatType = this.parentHierarchy = null;\n    }\n\n    this.renderMobileLayout(dialogElement);\n  };\n  /**\n   * To update calculated field info in adaptive layout.\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.updateAdaptiveCalculatedField = function (isEdit, fieldName) {\n    var dialogElement = this.parent.dialogRenderer.adaptiveElement.element;\n    this.isEdit = isEdit;\n    var calcInfo = isEdit ? this.parent.dataType === 'pivot' ? this.parent.engineModule.fieldList[fieldName] : this.parent.olapEngineModule.fieldList[fieldName] : {\n      id: null,\n      caption: null,\n      formula: null,\n      fieldType: 'Measure',\n      formatString: this.parent.dataType === 'pivot' ? null : 'Standard',\n      parentHierarchy: null\n    };\n    this.currentFieldName = calcInfo.id;\n\n    if (select('#' + this.parentID + 'droppable', document)) {\n      this.formulaText = select('#' + this.parentID + 'droppable', document).value = calcInfo.formula;\n      this.fieldText = this.inputObj.value = calcInfo.caption;\n      this.inputObj.dataBind();\n    }\n\n    if (dialogElement.querySelector('.' + cls.CALC_MEMBER_TYPE_DIV)) {\n      var memberTypeDrop = getInstance(select('#' + this.parentID + 'Member_Type_Div', dialogElement), DropDownList);\n      this.fieldType = memberTypeDrop.value = calcInfo.fieldType;\n      memberTypeDrop.readonly = isEdit ? true : false;\n      memberTypeDrop.dataBind();\n    }\n\n    if (dialogElement.querySelector('.' + cls.CALC_HIERARCHY_LIST_DIV)) {\n      var hierarchyDrop = getInstance(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement), DropDownList);\n\n      if (this.fieldType === 'Dimension') {\n        this.parentHierarchy = hierarchyDrop.value = calcInfo.parentHierarchy;\n      } else {\n        this.parentHierarchy = null;\n        hierarchyDrop.index = 0;\n      }\n\n      hierarchyDrop.dataBind();\n    }\n\n    if (dialogElement.querySelector('.' + cls.CALC_FORMAT_TYPE_DIV)) {\n      var formatStringData = ['Standard', 'Currency', 'Percent'];\n      var formatDrop = getInstance(select('#' + this.parentID + 'Format_Div', dialogElement), DropDownList);\n      this.formatType = formatDrop.value = formatStringData.indexOf(calcInfo.formatString) > -1 ? calcInfo.formatString : 'Custom';\n    }\n\n    if (dialogElement.querySelector('.' + cls.CALC_FORMAT_INPUT)) {\n      var customFormat = getInstance(select('#' + this.parentID + 'Custom_Format_Element', dialogElement), MaskedTextBox);\n      var formatObj = PivotUtil.getFieldByName(fieldName, this.parent.dataSourceSettings.formatSettings);\n\n      if (this.parent.dataType === 'pivot') {\n        this.formatText = customFormat.value = formatObj ? formatObj.format : null;\n      } else {\n        this.formatText = customFormat.value = this.formatType === 'Custom' ? calcInfo.formatString : null;\n      }\n\n      customFormat.dataBind();\n    }\n  };\n  /* eslint-enable max-len */\n\n  /**\n   * To create treeview.\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.createOlapDropElements = function () {\n    var _this = this;\n\n    var dialogElement = this.parent.isAdaptive ? this.parent.dialogRenderer.parentElement : this.dialog.element;\n    var mData = [];\n    var fData = [];\n    var fieldData = [];\n    var memberTypeData = ['Measure', 'Dimension'];\n    var formatStringData = ['Standard', 'Currency', 'Percent', 'Custom'];\n\n    for (var _i = 0, memberTypeData_1 = memberTypeData; _i < memberTypeData_1.length; _i++) {\n      var type = memberTypeData_1[_i];\n      mData.push({\n        value: type,\n        text: this.parent.localeObj.getConstant(type)\n      });\n    }\n\n    for (var _a = 0, formatStringData_1 = formatStringData; _a < formatStringData_1.length; _a++) {\n      var format = formatStringData_1[_a];\n      fData.push({\n        value: format,\n        text: this.parent.localeObj.getConstant(format)\n      });\n    }\n\n    var fields = PivotUtil.getClonedData(this.parent.olapEngineModule.fieldListData);\n\n    for (var _b = 0, _c = fields; _b < _c.length; _b++) {\n      var item = _c[_b];\n\n      if (item.spriteCssClass && (item.spriteCssClass.indexOf('e-attributeCDB-icon') > -1 || item.spriteCssClass.indexOf('e-hierarchyCDB-icon') > -1)) {\n        fieldData.push({\n          value: item.id,\n          text: item.caption\n        });\n      }\n    }\n\n    var memberTypeObj = new DropDownList({\n      dataSource: mData,\n      enableRtl: this.parent.enableRtl,\n      locale: this.parent.locale,\n      fields: {\n        value: 'value',\n        text: 'text'\n      },\n      value: this.fieldType !== null ? this.fieldType : mData[0].value,\n      readonly: this.isEdit,\n      cssClass: cls.MEMBER_OPTIONS_CLASS,\n      width: '100%',\n      change: function (args) {\n        hierarchyListObj.enabled = args.value === 'Dimension' ? true : false;\n        _this.fieldType = args.value;\n        _this.formulaText = select('#' + _this.parentID + 'droppable', document).value;\n        hierarchyListObj.dataBind();\n      }\n    });\n    memberTypeObj.isStringTemplate = true;\n    memberTypeObj.appendTo(select('#' + this.parentID + 'Member_Type_Div', dialogElement));\n    var hierarchyListObj = new DropDownList({\n      dataSource: fieldData,\n      enableRtl: this.parent.enableRtl,\n      locale: this.parent.locale,\n      allowFiltering: true,\n      enabled: memberTypeObj.value === 'Dimension' ? true : false,\n      filterBarPlaceholder: this.parent.localeObj.getConstant('example') + ' ' + fieldData[0].text.toString(),\n      fields: {\n        value: 'value',\n        text: 'text'\n      },\n      value: this.parentHierarchy !== null && memberTypeObj.value === 'Dimension' ? this.parentHierarchy : fieldData[0].value,\n      cssClass: cls.MEMBER_OPTIONS_CLASS,\n      width: '100%',\n      change: function (args) {\n        _this.parentHierarchy = args.value;\n        _this.formulaText = select('#' + _this.parentID + 'droppable', document).value;\n      }\n    });\n    hierarchyListObj.isStringTemplate = true;\n    hierarchyListObj.appendTo(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement));\n    var formatStringObj = new DropDownList({\n      dataSource: fData,\n      enableRtl: this.parent.enableRtl,\n      locale: this.parent.locale,\n      fields: {\n        value: 'value',\n        text: 'text'\n      },\n      value: this.formatType !== null ? this.formatType : fData[0].value,\n      cssClass: cls.MEMBER_OPTIONS_CLASS,\n      width: '100%',\n      change: function (args) {\n        customerFormatObj.enabled = args.value === 'Custom' ? true : false;\n        _this.formatType = args.value;\n        _this.formulaText = select('#' + _this.parentID + 'droppable', document).value;\n        customerFormatObj.dataBind();\n      }\n    });\n    formatStringObj.isStringTemplate = true;\n    formatStringObj.appendTo(select('#' + this.parentID + 'Format_Div', dialogElement));\n    var customerFormatObj = new MaskedTextBox({\n      placeholder: this.parent.localeObj.getConstant('customFormat'),\n      locale: this.parent.locale,\n      enableRtl: this.parent.enableRtl,\n      value: this.formatText !== null && formatStringObj.value === 'Custom' ? this.formatText : null,\n      enabled: formatStringObj.value === 'Custom' ? true : false,\n      change: function (args) {\n        _this.formatText = args.value;\n        _this.formulaText = select('#' + _this.parentID + 'droppable', document).value;\n      }\n    });\n    customerFormatObj.isStringTemplate = true;\n    customerFormatObj.appendTo('#' + this.parentID + 'Custom_Format_Element');\n  };\n  /**\n   * To create treeview.\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.createTreeView = function () {\n    var _this = this;\n\n    if (this.parent.dataType === 'olap') {\n      this.treeObj = new TreeView({\n        fields: {\n          dataSource: this.getFieldListData(this.parent),\n          id: 'id',\n          text: 'caption',\n          parentID: 'pid',\n          iconCss: 'spriteCssClass'\n        },\n        allowDragAndDrop: true,\n        enableRtl: this.parent.enableRtl,\n        locale: this.parent.locale,\n        nodeDragStart: this.dragStart.bind(this),\n        nodeDragging: function (e) {\n          if (e.event.target && e.event.target.classList.contains(cls.FORMULA)) {\n            removeClass([e.clonedNode], cls.NO_DRAG_CLASS);\n            addClass([e.event.target], 'e-copy-drop');\n          } else {\n            addClass([e.clonedNode], cls.NO_DRAG_CLASS);\n            removeClass([e.event.target], 'e-copy-drop');\n            e.dropIndicator = 'e-no-drop';\n            addClass([e.clonedNode.querySelector('.' + cls.ICON)], 'e-icon-expandable');\n            removeClass([e.clonedNode.querySelector('.' + cls.ICON)], 'e-list-icon');\n          }\n        },\n        nodeClicked: this.fieldClickHandler.bind(this),\n        nodeSelected: function (args) {\n          if (args.node.getAttribute('data-type') === CALC) {\n            _this.displayMenu(args.node);\n          } else {\n            removeClass([args.node], 'e-active');\n            args.cancel = true;\n          }\n        },\n        nodeDragStop: this.fieldDropped.bind(this),\n        drawNode: this.drawTreeNode.bind(this),\n        nodeExpanding: this.updateNodeIcon.bind(this),\n        nodeCollapsed: this.updateNodeIcon.bind(this),\n        sortOrder: 'None'\n      });\n    } else {\n      this.treeObj = new TreeView({\n        fields: {\n          dataSource: this.getFieldListData(this.parent),\n          id: 'formula',\n          text: 'name',\n          iconCss: 'icon'\n        },\n        allowDragAndDrop: true,\n        enableRtl: this.parent.enableRtl,\n        locale: this.parent.locale,\n        nodeCollapsing: this.nodeCollapsing.bind(this),\n        nodeDragStart: this.dragStart.bind(this),\n        nodeClicked: this.fieldClickHandler.bind(this),\n        nodeDragStop: this.fieldDropped.bind(this),\n        drawNode: this.drawTreeNode.bind(this),\n        keyPress: function (args) {\n          if (args.event.keyCode === 39) {\n            args.cancel = true;\n          }\n        },\n        sortOrder: 'Ascending'\n      });\n    }\n\n    this.treeObj.isStringTemplate = true;\n    this.treeObj.appendTo('#' + this.parentID + 'tree');\n  };\n\n  CalculatedField.prototype.updateNodeIcon = function (args) {\n    if (args.node && args.node.querySelector('.e-list-icon') && args.node.querySelector('.e-icon-expandable.e-process') && args.node.querySelector('.e-list-icon').className.indexOf('e-folderCDB-icon') > -1) {\n      var node = args.node.querySelector('.e-list-icon');\n      removeClass([node], 'e-folderCDB-icon');\n      addClass([node], 'e-folderCDB-open-icon');\n    } else if (args.node && args.node.querySelector('.e-list-icon') && args.node.querySelector('.e-icon-expandable') && args.node.querySelector('.e-list-icon').className.indexOf('e-folderCDB-open-icon') > -1) {\n      var node = args.node.querySelector('.e-list-icon');\n      removeClass([node], 'e-folderCDB-open-icon');\n      addClass([node], 'e-folderCDB-icon');\n    } else {\n      var curTreeData = this.treeObj.fields.dataSource;\n      var fieldListData = curTreeData;\n      var childNodes = [];\n\n      for (var _i = 0, fieldListData_1 = fieldListData; _i < fieldListData_1.length; _i++) {\n        var item = fieldListData_1[_i];\n\n        if (item.pid === args.nodeData.id.toString()) {\n          childNodes.push(item);\n        }\n      }\n\n      if (childNodes.length === 0) {\n        this.parent.olapEngineModule.calcChildMembers = [];\n        this.parent.olapEngineModule.getCalcChildMembers(this.parent.dataSourceSettings, args.nodeData.id.toString());\n        childNodes = this.parent.olapEngineModule.calcChildMembers;\n        this.parent.olapEngineModule.calcChildMembers = [];\n\n        for (var _a = 0, childNodes_1 = childNodes; _a < childNodes_1.length; _a++) {\n          var node = childNodes_1[_a];\n          node.pid = args.nodeData.id.toString();\n          node.hasChildren = false;\n          node.spriteCssClass = 'e-level-members';\n          node.caption = node.caption === '' ? this.parent.localeObj.getConstant('blank') : node.caption;\n          curTreeData.push(node);\n        }\n\n        this.treeObj.addNodes(childNodes, args.node);\n      } else {\n        return;\n      }\n    }\n  };\n\n  CalculatedField.prototype.nodeCollapsing = function (args) {\n    args.cancel = true;\n  };\n\n  CalculatedField.prototype.dragStart = function (args) {\n    var isDrag = false;\n    var dragItem = args.clonedNode;\n\n    if (dragItem && (this.parent.dataType === 'olap' && (dragItem.querySelector('.e-calc-dimension-icon,.e-calc-measure-icon,.e-measure-icon') || dragItem.querySelector('.e-dimensionCDB-icon,.e-attributeCDB-icon,.e-hierarchyCDB-icon') || dragItem.querySelector('.e-level-members,.e-namedSetCDB-icon')) || this.parent.dataType === 'pivot' && args.event.target.classList.contains(cls.DRAG_CLASS))) {\n      isDrag = true;\n    }\n\n    if (isDrag) {\n      addClass([args.draggedNode.querySelector('.' + cls.LIST_TEXT_CLASS)], cls.SELECTED_NODE_CLASS);\n      addClass([dragItem], cls.PIVOTCALC);\n      dragItem.style.zIndex = (this.dialog.zIndex + 1).toString();\n      dragItem.style.display = 'inline';\n    } else {\n      args.cancel = true;\n    }\n  };\n  /**\n   * Trigger before treeview text append.\n   * @param  {DrawNodeEventArgs} args\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.drawTreeNode = function (args) {\n    if (this.parent.dataType === 'olap') {\n      if (args.node.querySelector('.e-measure-icon')) {\n        args.node.querySelector('.e-list-icon').style.display = 'none';\n      }\n\n      var field = args.nodeData;\n      args.node.setAttribute('data-field', field.id);\n      args.node.setAttribute('data-caption', field.caption);\n      var liTextElement = args.node.querySelector('.' + cls.TEXT_CONTENT_CLASS);\n\n      if (args.nodeData && args.nodeData.type === CALC && liTextElement && args.node.querySelector('.e-list-icon.e-calc-member')) {\n        args.node.setAttribute('data-type', field.type);\n        args.node.setAttribute('data-membertype', field.fieldType);\n        args.node.setAttribute('data-hierarchy', field.parentHierarchy ? field.parentHierarchy : '');\n        args.node.setAttribute('data-formula', field.formula);\n        var formatStringData = ['Standard', 'Currency', 'Percent'];\n        var formatString = void 0;\n        formatString = field.formatString ? formatStringData.indexOf(field.formatString) > -1 ? field.formatString : 'Custom' : '';\n        args.node.setAttribute('data-formatString', formatString);\n        args.node.setAttribute('data-customString', formatString === 'Custom' ? field.formatString : '');\n        var removeElement = createElement('span', {\n          className: cls.GRID_REMOVE + ' e-icons e-list-icon'\n        });\n        liTextElement.classList.add('e-calcfieldmember');\n\n        if (this.parent.isAdaptive) {\n          var editElement = createElement('span', {\n            className: 'e-list-edit-icon' + (this.isEdit && this.currentFieldName === field.id ? ' e-edited ' : ' e-edit ') + cls.ICON\n          });\n          var editWrapper = createElement('div', {\n            className: 'e-list-header-icon'\n          });\n          editWrapper.appendChild(editElement);\n          editWrapper.appendChild(removeElement);\n          liTextElement.appendChild(editWrapper);\n        } else {\n          liTextElement.appendChild(removeElement);\n        }\n      }\n\n      if (this.parent.isAdaptive) {\n        var liTextElement_1 = args.node.querySelector('.' + cls.TEXT_CONTENT_CLASS);\n\n        if (args.node && args.node.querySelector('.e-list-icon') && liTextElement_1) {\n          var liIconElement = args.node.querySelector('.e-list-icon');\n          liTextElement_1.insertBefore(liIconElement, args.node.querySelector('.e-list-text'));\n        }\n\n        if (args.node && args.node.querySelector('.e-calcMemberGroupCDB,.e-measureGroupCDB-icon,.e-folderCDB-icon')) {\n          args.node.querySelector('.e-checkbox-wrapper').style.display = 'none';\n        }\n\n        if (args.node && args.node.querySelector('.e-level-members')) {\n          args.node.querySelector('.e-list-icon').style.display = 'none';\n        }\n      }\n    } else {\n      var field = args.nodeData.field;\n      args.node.setAttribute('data-field', field);\n      args.node.setAttribute('data-caption', args.nodeData.caption);\n      args.node.setAttribute('data-type', args.nodeData.type);\n      var formatObj = PivotUtil.getFieldByName(field, this.parent.dataSourceSettings.formatSettings);\n      args.node.setAttribute('data-formatString', formatObj ? formatObj.format : '');\n      var dragElement = createElement('span', {\n        attrs: {\n          'tabindex': '-1',\n          'aria-disabled': 'false',\n          'title': this.parent.localeObj.getConstant('dragField')\n        },\n        className: cls.ICON + ' e-drag'\n      });\n      var spaceElement = createElement('div', {\n        className: ' e-iconspace'\n      });\n      prepend([dragElement], args.node.querySelector('.' + cls.TEXT_CONTENT_CLASS));\n      append([spaceElement, args.node.querySelector('.' + cls.FORMAT)], args.node.querySelector('.' + cls.TEXT_CONTENT_CLASS));\n\n      if (this.getMenuItems(this.parent.engineModule.fieldList[field].type).length <= 0) {\n        removeClass([args.node.querySelector('.' + cls.FORMAT)], cls.ICON);\n      } else {\n        args.node.querySelector('.' + cls.FORMAT).setAttribute('title', this.parent.localeObj.getConstant('format'));\n      }\n\n      if (this.parent.engineModule.fieldList[field].aggregateType === CALC) {\n        args.node.querySelector('.' + cls.FORMAT).setAttribute('title', this.parent.localeObj.getConstant('remove'));\n        addClass([args.node.querySelector('.' + cls.FORMAT)], cls.GRID_REMOVE);\n        addClass([args.node.querySelector('.' + 'e-iconspace')], [cls.CALC_EDIT, cls.ICON, 'e-list-icon']);\n        args.node.querySelector('.' + cls.CALC_EDIT).setAttribute('title', this.parent.localeObj.getConstant('edit'));\n        args.node.querySelector('.' + cls.CALC_EDIT).setAttribute('aria-disabled', 'false');\n        args.node.querySelector('.' + cls.CALC_EDIT).setAttribute('tabindex', '-1');\n        removeClass([args.node.querySelector('.' + cls.FORMAT)], cls.FORMAT);\n        removeClass([args.node.querySelector('.e-iconspace')], 'e-iconspace');\n      }\n    }\n  };\n  /**\n   * To create radio buttons.\n   * @param  {string} key\n   * @returns HTMLElement\n   */\n\n\n  CalculatedField.prototype.createTypeContainer = function (key) {\n    var wrapDiv = createElement('div', {\n      id: this.parentID + 'control_wrapper',\n      className: cls.TREEVIEWOUTER\n    });\n    var type = this.getMenuItems(this.parent.engineModule.fieldList[key].type);\n\n    for (var i = 0; i < type.length; i++) {\n      var input = createElement('input', {\n        id: this.parentID + 'radio' + key + type[i],\n        attrs: {\n          'type': 'radio',\n          'data-ftxt': key,\n          'data-value': type[i]\n        },\n        className: cls.CALCRADIO\n      });\n      wrapDiv.appendChild(input);\n    }\n\n    return wrapDiv;\n  };\n\n  CalculatedField.prototype.getMenuItems = function (fieldType, summaryType) {\n    var menuItems = !isNullOrUndefined(summaryType) ? summaryType : this.parent.aggregateTypes;\n    var type = [];\n    var menuTypes = this.getValidSummaryType();\n\n    for (var i = 0; i < menuItems.length; i++) {\n      if (menuTypes.indexOf(menuItems[i]) > -1 && type.indexOf(menuItems[i]) < 0) {\n        if ((menuItems[i] === COUNT || menuItems[i] === DISTINCTCOUNT) && fieldType !== 'number' || fieldType === 'number') {\n          type.push(menuItems[i]);\n        }\n      }\n    }\n\n    return type;\n  };\n\n  CalculatedField.prototype.getValidSummaryType = function () {\n    return [COUNT, DISTINCTCOUNT, SUM, AVG, MEDIAN, MIN, MAX, PRODUCT, STDEV, STDEVP, VAR, VARP];\n  };\n  /**\n   * To get Accordion Data.\n   * @param  {PivotView | PivotFieldList} parent\n   * @returns AccordionItemModel\n   */\n\n\n  CalculatedField.prototype.getAccordionData = function (parent) {\n    var data = [];\n    var keys = Object.keys(parent.engineModule.fieldList);\n\n    for (var index = 0, i = keys.length; index < i; index++) {\n      var key = keys[index];\n      data.push({\n        header: '<input id=' + this.parentID + '_' + index + ' class=' + cls.CALCCHECK + ' type=\"checkbox\" data-field=' + key + ' data-caption=' + this.parent.engineModule.fieldList[key].caption + ' data-type=' + this.parent.engineModule.fieldList[key].type + '/>',\n        content: this.parent.engineModule.fieldList[key].aggregateType === CALC || this.getMenuItems(this.parent.engineModule.fieldList[key].type).length < 1 ? '' : this.createTypeContainer(key).outerHTML,\n        iconCss: this.parent.engineModule.fieldList[key].aggregateType === CALC ? 'e-list-icon' + ' ' + (this.isEdit && this.currentFieldName === key ? 'e-edited' : 'e-edit') : ''\n      });\n    }\n\n    return data;\n  };\n  /**\n   * To render mobile layout.\n   * @param  {Tab} tabObj\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.renderMobileLayout = function (tabObj) {\n    var _this = this;\n\n    tabObj.items[4].content = this.renderDialogElements().outerHTML;\n    tabObj.dataBind();\n\n    if (this.parent.dataType === 'olap' && this.parent.isAdaptive && this.parent.dialogRenderer.parentElement.querySelector('.' + cls.FORMULA) !== null) {\n      this.createOlapDropElements();\n    }\n\n    var cancelBtn = new Button({\n      cssClass: cls.FLAT,\n      isPrimary: true,\n      locale: this.parent.locale,\n      enableRtl: this.parent.enableRtl\n    });\n    cancelBtn.isStringTemplate = true;\n    cancelBtn.appendTo('#' + this.parentID + 'cancelBtn');\n\n    if (cancelBtn.element) {\n      cancelBtn.element.onclick = this.cancelBtnClick.bind(this);\n    }\n\n    if (this.parent.dialogRenderer.parentElement.querySelector('.' + cls.FORMULA) !== null && this.parent.isAdaptive) {\n      var okBtn = new Button({\n        cssClass: cls.FLAT + ' ' + cls.OUTLINE_CLASS,\n        isPrimary: true,\n        locale: this.parent.locale,\n        enableRtl: this.parent.enableRtl\n      });\n      okBtn.isStringTemplate = true;\n      okBtn.appendTo('#' + this.parentID + 'okBtn');\n      this.inputObj = new MaskedTextBox({\n        placeholder: this.parent.localeObj.getConstant('fieldName'),\n        locale: this.parent.locale,\n        enableRtl: this.parent.enableRtl,\n        change: function (args) {\n          _this.fieldText = args.value;\n          _this.formulaText = select('#' + _this.parentID + 'droppable', document).value;\n        }\n      });\n      this.inputObj.isStringTemplate = true;\n      this.inputObj.appendTo('#' + this.parentID + 'ddlelement');\n\n      if (this.parent.dataType === 'pivot') {\n        var formatInputObj = new MaskedTextBox({\n          locale: this.parent.locale,\n          enableRtl: this.parent.enableRtl,\n          placeholder: this.parent.localeObj.getConstant('numberFormatString'),\n          change: function (args) {\n            _this.formatText = args.value;\n            _this.formulaText = select('#' + _this.parentID + 'droppable', document).value;\n          }\n        });\n        formatInputObj.isStringTemplate = true;\n        formatInputObj.appendTo('#' + this.parentID + 'Custom_Format_Element');\n\n        if (this.formatText !== null && this.parent.dialogRenderer.parentElement.querySelector('.' + cls.CALC_FORMAT_INPUT) !== null) {\n          this.parent.dialogRenderer.parentElement.querySelector('.' + cls.CALC_FORMAT_INPUT).value = this.formatText;\n          formatInputObj.value = this.formatText;\n        }\n      }\n\n      if (this.formulaText !== null && select('#' + this.parentID + 'droppable', this.parent.dialogRenderer.parentElement) !== null) {\n        var drop = select('#' + this.parentID + 'droppable', this.parent.dialogRenderer.parentElement);\n        drop.value = this.formulaText;\n      }\n\n      if (this.fieldText !== null && this.parent.dialogRenderer.parentElement.querySelector('.' + cls.CALCINPUT) !== null) {\n        this.parent.dialogRenderer.parentElement.querySelector('.' + cls.CALCINPUT).value = this.fieldText;\n        this.inputObj.value = this.fieldText;\n      }\n\n      if (okBtn.element) {\n        okBtn.element.onclick = this.applyFormula.bind(this);\n      }\n    } else if (this.parent.isAdaptive) {\n      var addBtn = new Button({\n        cssClass: cls.FLAT,\n        isPrimary: true,\n        locale: this.parent.locale,\n        enableRtl: this.parent.enableRtl\n      });\n      addBtn.isStringTemplate = true;\n      addBtn.appendTo('#' + this.parentID + 'addBtn');\n\n      if (this.parent.dataType === 'olap') {\n        this.treeObj = new TreeView({\n          fields: {\n            dataSource: this.getFieldListData(this.parent),\n            id: 'id',\n            text: 'caption',\n            parentID: 'pid',\n            iconCss: 'spriteCssClass'\n          },\n          showCheckBox: true,\n          autoCheck: false,\n          sortOrder: 'None',\n          enableRtl: this.parent.enableRtl,\n          locale: this.parent.locale,\n          nodeClicked: this.fieldClickHandler.bind(this),\n          drawNode: this.drawTreeNode.bind(this),\n          nodeExpanding: this.updateNodeIcon.bind(this),\n          nodeCollapsed: this.updateNodeIcon.bind(this),\n          nodeSelected: function (args) {\n            removeClass([args.node], 'e-active');\n            args.cancel = true;\n          }\n        });\n        this.treeObj.isStringTemplate = true;\n        this.treeObj.appendTo('#' + this.parentID + 'accordDiv');\n      } else {\n        this.accordion = new Accordion({\n          items: this.getAccordionData(this.parent),\n          enableRtl: this.parent.enableRtl,\n          locale: this.parent.locale,\n          expanding: this.accordionExpand.bind(this),\n          clicked: this.accordionClickHandler.bind(this),\n          created: this.accordionCreated.bind(this)\n        });\n        this.accordion.isStringTemplate = true;\n        this.accordion.appendTo('#' + this.parentID + 'accordDiv');\n        this.updateType();\n      }\n\n      if (addBtn.element) {\n        addBtn.element.onclick = this.addBtnClick.bind(this);\n      }\n    }\n  };\n\n  CalculatedField.prototype.accordionExpand = function (args) {\n    if (args.element.querySelectorAll('.e-radio-wrapper').length === 0) {\n      var keys = Object.keys(this.parent.engineModule.fieldList);\n\n      for (var index = 0, i = keys.length; index < i; index++) {\n        var key = keys[index];\n        var type = this.parent.engineModule.fieldList[key].type !== 'number' ? [COUNT, DISTINCTCOUNT] : [SUM, COUNT, AVG, MEDIAN, MIN, MAX, DISTINCTCOUNT, PRODUCT, STDEV, STDEVP, VAR, VARP];\n        var radiobutton = void 0;\n\n        if (key === args.element.querySelector('[data-field').getAttribute('data-field')) {\n          for (var i_1 = 0; i_1 < type.length; i_1++) {\n            radiobutton = new RadioButton({\n              label: this.parent.localeObj.getConstant(type[i_1]),\n              name: AGRTYPE + key,\n              checked: args.element.querySelector('[data-type').getAttribute('data-type') === type[i_1],\n              change: this.onChange.bind(this),\n              locale: this.parent.locale,\n              enableRtl: this.parent.enableRtl\n            });\n            radiobutton.isStringTemplate = true;\n            radiobutton.appendTo('#' + this.parentID + 'radio' + key + type[i_1]);\n          }\n        }\n      }\n    }\n  };\n\n  CalculatedField.prototype.onChange = function (args) {\n    var type = args.event.target.parentElement.querySelector('.e-label').innerText;\n    var field = args.event.target.closest('.e-acrdn-item').querySelector('[data-field').getAttribute('data-caption');\n    args.event.target.closest('.e-acrdn-item').querySelector('.e-label').innerText = field + ' (' + type + ')';\n    args.event.target.closest('.e-acrdn-item').querySelector('[data-type').setAttribute('data-type', args.event.target.getAttribute('data-value'));\n  };\n\n  CalculatedField.prototype.updateType = function () {\n    var keys = Object.keys(this.parent.engineModule.fieldList);\n\n    for (var index = 0, i = keys.length; index < i; index++) {\n      var key = keys[index];\n      var type = null;\n\n      if ((this.parent.engineModule.fieldList[key].type !== 'number' || this.parent.engineModule.fieldList[key].type === 'include' || this.parent.engineModule.fieldList[key].type === 'exclude') && this.parent.engineModule.fieldList[key].aggregateType !== 'DistinctCount') {\n        type = COUNT;\n      } else {\n        type = this.parent.engineModule.fieldList[key].aggregateType !== undefined ? this.parent.engineModule.fieldList[key].aggregateType : SUM;\n      }\n\n      var checkbox = new CheckBox({\n        label: this.parent.engineModule.fieldList[key].caption + ' (' + this.parent.localeObj.getConstant(type) + ')',\n        locale: this.parent.locale,\n        enableRtl: this.parent.enableRtl\n      });\n      checkbox.isStringTemplate = true;\n      checkbox.appendTo('#' + this.parentID + '_' + index);\n      select('#' + this.parentID + '_' + index, document).setAttribute('data-field', key);\n      select('#' + this.parentID + '_' + index, document).setAttribute('data-type', type);\n    }\n  };\n  /**\n   * Trigger while click cancel button.\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.cancelBtnClick = function () {\n    this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement);\n  };\n  /**\n   * Trigger while click add button.\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.addBtnClick = function () {\n    var fieldText = '';\n    var field = null;\n    var type = null;\n\n    if (this.parent.dataType === 'pivot') {\n      var node = document.querySelectorAll('.e-accordion .e-check');\n\n      for (var i = 0; i < node.length; i++) {\n        field = node[i].parentElement.querySelector('[data-field]').getAttribute('data-field');\n        type = node[i].parentElement.querySelector('[data-field]').getAttribute('data-type');\n\n        if (type.indexOf(CALC) === -1) {\n          fieldText = fieldText + ('\"' + type + '(' + field + ')' + '\"');\n        } else {\n          for (var j = 0; j < this.parent.dataSourceSettings.calculatedFieldSettings.length; j++) {\n            if (this.parent.dataSourceSettings.calculatedFieldSettings[j].name === field) {\n              fieldText = fieldText + this.parent.dataSourceSettings.calculatedFieldSettings[j].formula;\n              break;\n            }\n          }\n        }\n      }\n    } else {\n      var nodes = this.treeObj.getAllCheckedNodes();\n      var olapEngine = this.parent.olapEngineModule;\n\n      for (var _i = 0, nodes_1 = nodes; _i < nodes_1.length; _i++) {\n        var item = nodes_1[_i];\n        fieldText = fieldText + (olapEngine.fieldList[item] && olapEngine.fieldList[item].type === CALC ? olapEngine.fieldList[item].tag : item);\n      }\n    }\n\n    this.formulaText = this.formulaText !== null ? this.formulaText + fieldText : fieldText;\n    this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement);\n  };\n  /**\n   * To create calculated field dialog elements.\n   * @returns {void}\n   * @hidden\n   */\n\n\n  CalculatedField.prototype.createCalculatedFieldDialog = function (args) {\n    if (this.parent.isAdaptive && this.parent.getModuleName() === 'pivotfieldlist') {\n      this.renderAdaptiveLayout(args && args.edit !== undefined ? args.edit : true);\n      this.isEdit = args && args.edit !== undefined ? args.edit : this.isEdit;\n    } else if (!this.parent.isAdaptive) {\n      this.isEdit = args && args.edit !== undefined ? args.edit : false;\n      this.renderDialogLayout();\n\n      if (args && args.edit) {\n        var target = this.treeObj.element.querySelector('li[data-field=\"' + args.fieldName + '\"]');\n\n        if (target) {\n          addClass([target], ['e-active', 'e-node-focus']);\n          target.setAttribute('aria-selected', 'true');\n          target.id = this.treeObj.element.id + '_active';\n\n          if (this.parent.dataType === 'pivot') {\n            var e = {\n              event: {\n                target: target.querySelector('.e-list-icon.e-edit.e-icons')\n              }\n            };\n            this.fieldClickHandler(e);\n          } else {\n            this.displayMenu(target);\n          }\n        }\n      }\n\n      this.dialog.element.style.top = parseInt(this.dialog.element.style.top, 10) < 0 ? '0px' : this.dialog.element.style.top;\n    }\n  };\n  /**\n   * To create calculated field desktop layout.\n   * @returns {void}\n   */\n\n\n  CalculatedField.prototype.renderDialogLayout = function () {\n    this.newFields = extend([], this.parent.dataSourceSettings.calculatedFieldSettings, null, true);\n    this.createDialog();\n    this.dialog.content = this.renderDialogElements();\n    this.dialog.refresh();\n    this.inputObj = new MaskedTextBox({\n      placeholder: this.parent.localeObj.getConstant('fieldName'),\n      locale: this.parent.locale,\n      enableRtl: this.parent.enableRtl\n    });\n    this.inputObj.isStringTemplate = true;\n    this.inputObj.appendTo('#' + this.parentID + 'ddlelement');\n\n    if (this.parent.dataType === 'pivot') {\n      var customerFormatObj = new MaskedTextBox({\n        placeholder: this.parent.localeObj.getConstant('numberFormatString'),\n        locale: this.parent.locale,\n        enableRtl: this.parent.enableRtl\n      });\n      customerFormatObj.isStringTemplate = true;\n      customerFormatObj.appendTo('#' + this.parentID + 'Custom_Format_Element');\n    }\n\n    if (this.parent.dataType === 'olap' && !this.parent.isAdaptive) {\n      this.createOlapDropElements();\n    }\n\n    this.createTreeView();\n    this.droppable = new Droppable(select('#' + this.parentID + 'droppable'));\n    this.keyboardEvents = new KeyboardEvents(this.parent.calculatedFieldModule.dialog.element, {\n      keyAction: this.keyActionHandler.bind(this),\n      keyConfigs: {\n        moveRight: 'rightarrow',\n        enter: 'enter',\n        shiftE: 'shift+E',\n        delete: 'delete'\n      },\n      eventName: 'keydown'\n    });\n  };\n  /**\n   * Creates the error dialog for the unexpected action done.\n   * @function createConfirmDialog\n   * @returns {void}\n   * @hidden\n   */\n\n\n  CalculatedField.prototype.createConfirmDialog = function (title, description, calcInfo, isRemove, node) {\n    var errorDialog = createElement('div', {\n      id: this.parentID + '_ErrorDialog',\n      className: cls.ERROR_DIALOG_CLASS\n    });\n    this.parent.element.appendChild(errorDialog);\n    this.confirmPopUp = new Dialog({\n      animationSettings: {\n        effect: 'Fade'\n      },\n      allowDragging: false,\n      showCloseIcon: true,\n      enableRtl: this.parent.enableRtl,\n      locale: this.parent.locale,\n      width: 'auto',\n      height: 'auto',\n      position: {\n        X: 'center',\n        Y: 'center'\n      },\n      buttons: [{\n        click: isRemove ? this.removeCalcField.bind(this, node) : this.replaceFormula.bind(this, calcInfo),\n        buttonModel: {\n          cssClass: cls.OK_BUTTON_CLASS + ' ' + cls.FLAT_CLASS,\n          content: isRemove ? this.parent.localeObj.getConstant('yes') : this.parent.localeObj.getConstant('ok'),\n          isPrimary: true\n        }\n      }, {\n        click: this.removeErrorDialog.bind(this),\n        buttonModel: {\n          cssClass: cls.CANCEL_BUTTON_CLASS,\n          content: isRemove ? this.parent.localeObj.getConstant('no') : this.parent.localeObj.getConstant('cancel'),\n          isPrimary: true\n        }\n      }],\n      header: title,\n      content: description,\n      isModal: true,\n      visible: true,\n      closeOnEscape: true,\n      target: document.body,\n      close: this.removeErrorDialog.bind(this)\n    });\n    /* eslint-enable max-len */\n\n    this.confirmPopUp.isStringTemplate = true;\n    this.confirmPopUp.appendTo(errorDialog); // this.confirmPopUp.element.querySelector('.e-dlg-header').innerHTML = title;\n  };\n\n  CalculatedField.prototype.replaceFormula = function (calcInfo) {\n    var report = this.parent.dataSourceSettings;\n\n    if (this.parent.dataType === 'olap') {\n      for (var j = 0; j < report.calculatedFieldSettings.length; j++) {\n        if (report.calculatedFieldSettings[j].name === calcInfo.name) {\n          if (!isNullOrUndefined(calcInfo.hierarchyUniqueName)) {\n            report.calculatedFieldSettings[j].hierarchyUniqueName = calcInfo.hierarchyUniqueName;\n          }\n\n          report.calculatedFieldSettings[j].formatString = calcInfo.formatString;\n          report.calculatedFieldSettings[j].formula = calcInfo.formula;\n          this.parent.lastCalcFieldInfo = report.calculatedFieldSettings[j];\n          break;\n        }\n      }\n    } else {\n      for (var i = 0; i < report.values.length; i++) {\n        if (report.values[i].type === CALC && report.values[i].name === calcInfo.name) {\n          for (var j = 0; j < report.calculatedFieldSettings.length; j++) {\n            if (report.calculatedFieldSettings[j].name === calcInfo.name) {\n              report.calculatedFieldSettings[j].formula = calcInfo.formula;\n              this.parent.lastCalcFieldInfo = report.calculatedFieldSettings[j];\n              this.updateFormatSettings(report, calcInfo.name, calcInfo.formatString);\n            }\n          }\n        }\n      }\n    }\n\n    this.addFormula(report, calcInfo.name);\n    this.removeErrorDialog();\n  };\n\n  CalculatedField.prototype.removeErrorDialog = function () {\n    if (document.getElementById(this.parentID + '_ErrorDialog')) {\n      remove(document.getElementById(this.parentID + '_ErrorDialog').parentElement);\n    }\n  };\n  /**\n   * To add event listener.\n   * @returns {void}\n   * @hidden\n   */\n\n\n  CalculatedField.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.initCalculatedField, this.createCalculatedFieldDialog, this);\n  };\n  /**\n   * To remove event listener.\n   * @returns {void}\n   * @hidden\n   */\n\n\n  CalculatedField.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.initCalculatedField, this.createCalculatedFieldDialog);\n  };\n  /**\n   * To destroy the calculated field dialog\n   * @returns {void}\n   * @hidden\n   */\n\n\n  CalculatedField.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  return CalculatedField;\n}();\n\nexport { CalculatedField };","map":{"version":3,"sources":["/workspace/Commb-olap-poc/commb-olap-js/node_modules/@syncfusion/ej2-pivotview/src/common/calculatedfield/calculated-field.js"],"names":["Dialog","Tooltip","Droppable","createElement","extend","remove","addClass","closest","getInstance","isBlazor","select","prepend","append","KeyboardEvents","removeClass","isNullOrUndefined","Button","RadioButton","CheckBox","MaskedTextBox","cls","TreeView","ContextMenu","Menu","events","Accordion","DropDownList","PivotUtil","COUNT","AVG","MEDIAN","MIN","MAX","SUM","DISTINCTCOUNT","PRODUCT","STDEV","STDEVP","VAR","VARP","CALC","AGRTYPE","CalculatedField","parent","isFormula","isRequireUpdate","existingReport","calculatedFieldModule","removeEventListener","addEventListener","parentID","element","id","dialog","inputObj","treeObj","droppable","menuObj","newFields","isFieldExist","formulaText","fieldText","formatText","formatType","fieldType","parentHierarchy","isEdit","currentFieldName","confirmPopUp","prototype","getModuleName","keyActionHandler","e","node","currentTarget","querySelector","action","dataType","displayMenu","tagName","classList","contains","GRID_REMOVE","createConfirmDialog","localeObj","getConstant","field","getAttribute","type","dropField","value","olapEngineModule","fieldList","isCalculatedField","tag","fieldClickHandler","event","target","FORMAT","CALC_EDIT","CALC_EDITED","isAdaptive","renderMobileLayout","dialogRenderer","adaptiveElement","accordionClickHandler","item","iconCss","indexOf","originalEvent","CALCCHECK","fieldName","formatObj","getFieldByName","dataSourceSettings","formatSettings","optionElement","engineModule","formula","format","accordionCreated","allElement","accordion","querySelectorAll","i","length","className","clearFormula","treeNode","edit","edited","ICON","isDestroyed","destroy","curMenu","LIST_TEXT_CLASS","openContextMenu","caption","dataBind","formatString","dialogElement","customFormat","memberType","expression","customString","fieldTitle","memberTypeDrop","hierarchyDrop","formatDrop","innerHTML","document","readonly","setAttribute","index","name","removeCalcField","calcfields","calculatedFieldSettings","removeNodes","parseInt","split","removeItem","splice","fields_1","fieldListData","_i","_a","Object","keys","getNode","fields","savedFieldList","formatFields","values","rows","columns","filters","n","j","length_1","allowDeferLayoutUpdate","updateDataSource","removeErrorDialog","_this","validSummaryTypes","getValidSummaryType","slice","eventArgs","cancel","aggregateTypes","getMenuItems","control","isPopupView","pivotGridModule","trigger","aggregateMenuOpen","observedArgs","duplicateTypes","items","option","push","text","createMenu","pos","getBoundingClientRect","offset","window","scrollY","documentElement","scrollTop","enableRtl","open","top","left","selectContextMenu","menu","textContent","pop","parentElement","focus","menuItems","menuOptions","cssClass","locale","bind","onClose","contextMenu","appendChild","isStringTemplate","appendTo","applyFormula","currentObj","isExist","getElementById","EMPTY_FIELD","calculatedField","getCalculatedFieldInfo","cloneCalculatedFieldSettings","calculatedFieldCreate","calcInfo","key","aggregateType","pivotCommon","errorDialog","createErrorDialog","report","hierarchyUniqueName","axisFields","_b","axisFields_1","_c","fields_2","lastCalcFieldInfo","cField","currentFormula","updateFormatSettings","addFormula","endDialog","newFormat","useGrouping","isFormatExist","undefined","properties","mode","updateDataSourceSettings","getClonedDataSourceSettings","setProperties","isRequiredUpdate","pivot","enableVirtualization","renderMode","pivotChange","exception","showError","close","CALCINPUT","enabled","calcFields","getFieldListData","getClonedData","spriteCssClass","hasChildren","expanded","typeVal","icon","fieldDropped","args","draggedNode","SELECTED_NODE_CLASS","textCovered","currentValue","cursorPos","selectionStart","textAfterText","substring","textBeforeText","setSelectionRange","draggedNodeData","toString","createDialog","CALCDIALOG","OLAP_CALCDIALOG","calcButtons","click","buttonModel","content","isPrimary","cancelClick","clearButton","allowDragging","position","X","Y","buttons","closeDialog","beforeOpen","animationSettings","effect","width","isModal","closeOnEscape","showCloseIcon","header","body","axisFieldModule","render","TOGGLE_FIELD_LIST_CLASS","ICON_HIDDEN","fieldListDialog","show","timeOut","buttonCall","setTimeout","setFocus","pivotButtons","call","pivotButtons_1","renderDialogElements","outerDiv","OLAP_CALCOUTERDIV","CALCOUTERDIV","olapFieldTreeDiv","olapCalcDiv","FORMULA","accordDiv","CALCACCORD","buttonDiv","CALCBUTTONDIV","addBtn","CALCADDBTN","attrs","cancelBtn","CALCCANCELBTN","formulaTitle","PIVOT_FIELD_TITLE_CLASS","inputDiv","CALCINPUTDIV","wrapDiv","TREEVIEWOUTER","PIVOT_ALL_FIELD_TITLE_CLASS","headerWrapperDiv","spanElement","CALC_INFO","tooltip","offsetY","treeOuterDiv","TREEVIEW","PIVOT_FORMULA_TITLE_CLASS","dropDiv","okBtn","CALCOKBTN","memberTypeTitle","OLAP_MEMBER_TITLE_CLASS","CALC_MEMBER_TYPE_DIV","hierarchyTitle","OLAP_HIERARCHY_TITLE_CLASS","CALC_HIERARCHY_LIST_DIV","formatTitle","OLAP_FORMAT_TITLE_CLASS","CALC_FORMAT_TYPE_DIV","customFormatDiv","OLAP_CALC_CUSTOM_FORMAT_INPUTDIV","customFormatObj","CALC_FORMAT_INPUT","CALC_CUSTOM_FORMAT_INPUTDIV","insertBefore","renderAdaptiveLayout","updateAdaptiveCalculatedField","formatStringData","createOlapDropElements","mData","fData","fieldData","memberTypeData","memberTypeData_1","formatStringData_1","memberTypeObj","dataSource","MEMBER_OPTIONS_CLASS","change","hierarchyListObj","allowFiltering","filterBarPlaceholder","formatStringObj","customerFormatObj","placeholder","createTreeView","allowDragAndDrop","nodeDragStart","dragStart","nodeDragging","clonedNode","NO_DRAG_CLASS","dropIndicator","nodeClicked","nodeSelected","nodeDragStop","drawNode","drawTreeNode","nodeExpanding","updateNodeIcon","nodeCollapsed","sortOrder","nodeCollapsing","keyPress","keyCode","curTreeData","childNodes","fieldListData_1","pid","nodeData","calcChildMembers","getCalcChildMembers","childNodes_1","addNodes","isDrag","dragItem","DRAG_CLASS","PIVOTCALC","style","zIndex","display","liTextElement","TEXT_CONTENT_CLASS","removeElement","add","editElement","editWrapper","liTextElement_1","liIconElement","dragElement","spaceElement","createTypeContainer","input","CALCRADIO","summaryType","menuTypes","getAccordionData","data","outerHTML","tabObj","FLAT","onclick","cancelBtnClick","OUTLINE_CLASS","formatInputObj","drop","showCheckBox","autoCheck","expanding","accordionExpand","clicked","created","updateType","addBtnClick","radiobutton","i_1","label","checked","onChange","innerText","checkbox","nodes","getAllCheckedNodes","olapEngine","nodes_1","createCalculatedFieldDialog","renderDialogLayout","refresh","keyboardEvents","keyAction","keyConfigs","moveRight","enter","shiftE","delete","eventName","title","description","isRemove","ERROR_DIALOG_CLASS","height","replaceFormula","OK_BUTTON_CLASS","FLAT_CLASS","CANCEL_BUTTON_CLASS","visible","on","initCalculatedField","off"],"mappings":"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","sourcesContent":["import { Dialog, Tooltip } from '@syncfusion/ej2-popups';\nimport { Droppable, createElement, extend, remove, addClass, closest, getInstance, isBlazor, select } from '@syncfusion/ej2-base';\nimport { prepend, append, KeyboardEvents, removeClass, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { Button, RadioButton, CheckBox } from '@syncfusion/ej2-buttons';\nimport { MaskedTextBox } from '@syncfusion/ej2-inputs';\nimport * as cls from '../../common/base/css-constant';\nimport { TreeView } from '@syncfusion/ej2-navigations';\nimport { ContextMenu as Menu } from '@syncfusion/ej2-navigations';\nimport * as events from '../../common/base/constant';\nimport { Accordion } from '@syncfusion/ej2-navigations';\nimport { DropDownList } from '@syncfusion/ej2-dropdowns';\nimport { PivotUtil } from '../../base/util';\n/**\n * Module to render Calculated Field Dialog\n */\nvar COUNT = 'Count';\nvar AVG = 'Avg';\nvar MEDIAN = 'Median';\nvar MIN = 'Min';\nvar MAX = 'Max';\nvar SUM = 'Sum';\nvar DISTINCTCOUNT = 'DistinctCount';\nvar PRODUCT = 'Product';\nvar STDEV = 'SampleStDev';\nvar STDEVP = 'PopulationStDev';\nvar VAR = 'SampleVar';\nvar VARP = 'PopulationVar';\nvar CALC = 'CalculatedField';\nvar AGRTYPE = 'AggregateType';\n/** @hidden */\nvar CalculatedField = /** @class */ (function () {\n    /**\n     * Constructor for calculatedfield module.\n     * @param {PivotView | PivotFieldList} parent - Component instance.\n     */\n    function CalculatedField(parent) {\n        /** @hidden */\n        this.isFormula = false;\n        /** @hidden */\n        this.isRequireUpdate = false;\n        this.parent = parent;\n        this.existingReport = null;\n        this.parent.calculatedFieldModule = this;\n        this.removeEventListener();\n        this.addEventListener();\n        this.parentID = this.parent.element.id;\n        this.dialog = null;\n        this.inputObj = null;\n        this.treeObj = null;\n        this.droppable = null;\n        this.menuObj = null;\n        this.newFields = null;\n        this.isFieldExist = true;\n        this.formulaText = null;\n        this.fieldText = null;\n        this.formatText = null;\n        this.formatType = null;\n        this.fieldType = null;\n        this.parentHierarchy = null;\n        this.isEdit = false;\n        this.currentFieldName = null;\n        this.confirmPopUp = null;\n    }\n    /**\n     * To get module name.\n     * @returns {string} - Module name.\n     */\n    CalculatedField.prototype.getModuleName = function () {\n        return 'calculatedField';\n    };\n    CalculatedField.prototype.keyActionHandler = function (e) {\n        var node = e.currentTarget.querySelector('.e-hover.e-node-focus');\n        if (node) {\n            switch (e.action) {\n                case 'moveRight':\n                case 'shiftE':\n                    if (this.parent.dataType === 'pivot') {\n                        this.displayMenu(node);\n                    }\n                    break;\n                case 'delete':\n                    if (node.tagName === 'LI' && !node.querySelector('.e-list-icon.e-format') && !node.querySelector('.e-list-icon').classList.contains('.e-icons') && (node.querySelector('.' + cls.GRID_REMOVE) &&\n                        node.querySelector('.' + cls.GRID_REMOVE).classList.contains('e-list-icon'))) {\n                        this.createConfirmDialog(this.parent.localeObj.getConstant('alert'), this.parent.localeObj.getConstant('removeCalculatedField'), {}, true, node);\n                    }\n                    break;\n                case 'enter':\n                    var field = node.getAttribute('data-field');\n                    var type = node.getAttribute('data-type');\n                    var dropField = select('#' + this.parentID + 'droppable', this.dialog.element);\n                    if (this.parent.dataType === 'pivot') {\n                        if (dropField.value === '') {\n                            if (type === CALC) {\n                                dropField.value = node.getAttribute('data-uid');\n                            }\n                            else {\n                                dropField.value = '\"' + type + '(' + field + ')' + '\"';\n                            }\n                        }\n                        else if (dropField.value !== '') {\n                            if (type === CALC) {\n                                dropField.value = dropField.value + node.getAttribute('data-uid');\n                            }\n                            else {\n                                dropField.value = dropField.value + '\"' + type + '(' + field + ')' + '\"';\n                            }\n                        }\n                    }\n                    else {\n                        if (this.parent.olapEngineModule && this.parent.olapEngineModule.fieldList[field] &&\n                            this.parent.olapEngineModule.fieldList[field].isCalculatedField) {\n                            field = this.parent.olapEngineModule.fieldList[field].tag;\n                        }\n                        if (dropField.value === '') {\n                            dropField.value = field;\n                        }\n                        else if (dropField.value !== '') {\n                            dropField.value = dropField.value + field;\n                        }\n                    }\n                    break;\n            }\n        }\n    };\n    /**\n     * Trigger while click treeview icon.\n     * @param  {NodeClickEventArgs} e - Click event argument.\n     * @returns {void}\n     */\n    CalculatedField.prototype.fieldClickHandler = function (e) {\n        var node = closest(e.event.target, 'li');\n        if (e.event.target.classList.contains(cls.FORMAT) ||\n            e.event.target.classList.contains(cls.CALC_EDIT) ||\n            e.event.target.classList.contains(cls.CALC_EDITED) ||\n            e.event.target.classList.contains(cls.GRID_REMOVE)) {\n            if (!this.parent.isAdaptive) {\n                this.displayMenu(node, e.node, e.event.target);\n            }\n            else if (this.parent.dataType === 'olap' && this.parent.isAdaptive) {\n                if (node.tagName === 'LI' && node.querySelector('.e-list-edit-icon').classList.contains(cls.CALC_EDIT) && e.event.target.classList.contains(cls.CALC_EDIT)) {\n                    this.isEdit = true;\n                    this.currentFieldName = node.getAttribute('data-field');\n                    this.fieldText = node.getAttribute('data-caption');\n                    this.formulaText = node.getAttribute('data-formula');\n                    this.formatType = node.getAttribute('data-formatString');\n                    this.formatText = this.formatType === 'Custom' ? node.getAttribute('data-customString') : null;\n                    this.fieldType = node.getAttribute('data-membertype');\n                    this.parentHierarchy = this.fieldType === 'Dimension' ? node.getAttribute('data-hierarchy') : null;\n                    addClass([node.querySelector('.e-list-edit-icon')], cls.CALC_EDITED);\n                    removeClass([node.querySelector('.e-list-edit-icon')], cls.CALC_EDIT);\n                    this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement);\n                }\n                else if (node.tagName === 'LI' && node.querySelector('.e-list-edit-icon').classList.contains(cls.CALC_EDITED) && e.event.target.classList.contains(cls.CALC_EDITED)) {\n                    this.isEdit = false;\n                    this.fieldText = this.formatText = this.formulaText = this.currentFieldName = null;\n                    this.parentHierarchy = this.fieldType = this.formatType = null;\n                    addClass([node.querySelector('.e-list-edit-icon')], cls.CALC_EDIT);\n                    removeClass([node.querySelector('.e-list-edit-icon')], cls.CALC_EDITED);\n                }\n                else if (node.tagName === 'LI' && node.querySelector('.' + cls.GRID_REMOVE).classList.contains('e-icons') && e.event.target.classList.contains(cls.GRID_REMOVE)) {\n                    this.createConfirmDialog(this.parent.localeObj.getConstant('alert'), this.parent.localeObj.getConstant('removeCalculatedField'), {}, true, e.node);\n                }\n            }\n        }\n    };\n    /**\n     * Trigger while click treeview icon.\n     * @param  {AccordionClickArgs} e - Click event argument.\n     * @returns {void}\n     */\n    CalculatedField.prototype.accordionClickHandler = function (e) {\n        if (e.item && e.item.iconCss.indexOf('e-list-icon') !== -1 &&\n            closest(e.originalEvent.target, '.e-acrdn-header-icon')) {\n            var node = closest(e.originalEvent.target, '.e-acrdn-header').querySelector('.' + cls.CALCCHECK);\n            var fieldName = node.getAttribute('data-field');\n            var formatObj = PivotUtil.getFieldByName(fieldName, this.parent.dataSourceSettings.formatSettings);\n            var optionElement = closest(e.originalEvent.target, '.e-acrdn-header-icon');\n            if (optionElement.querySelector('.' + cls.CALC_EDIT) && e.originalEvent.target.classList.contains(cls.CALC_EDIT)) {\n                this.isEdit = true;\n                this.currentFieldName = this.fieldText = fieldName;\n                this.formulaText = this.parent.engineModule.fieldList[fieldName].formula;\n                this.formatText = formatObj ? formatObj.format : '';\n                addClass([optionElement.querySelector('.e-list-icon')], cls.CALC_EDITED);\n                removeClass([optionElement.querySelector('.e-list-icon')], cls.CALC_EDIT);\n                this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement);\n            }\n            else if (optionElement.querySelector('.' + cls.CALC_EDITED) &&\n                e.originalEvent.target.classList.contains(cls.CALC_EDITED)) {\n                this.isEdit = false;\n                this.fieldText = this.formatText = this.formulaText = this.currentFieldName = null;\n                addClass([optionElement.querySelector('.e-list-icon')], cls.CALC_EDIT);\n                removeClass([optionElement.querySelector('.e-list-icon')], cls.CALC_EDITED);\n            }\n            else if (optionElement.querySelector('.' + cls.GRID_REMOVE) &&\n                e.originalEvent.target.classList.contains(cls.GRID_REMOVE)) {\n                this.createConfirmDialog(this.parent.localeObj.getConstant('alert'), this.parent.localeObj.getConstant('removeCalculatedField'), {}, true, node);\n            }\n        }\n    };\n    CalculatedField.prototype.accordionCreated = function () {\n        var allElement = this.accordion.element.querySelectorAll('.e-acrdn-item');\n        for (var i = 0; i < allElement.length; i++) {\n            if (allElement[i].querySelector('.' + cls.CALC_EDIT) || allElement[i].querySelector('.' + cls.CALC_EDITED)) {\n                var element = createElement('span', {\n                    className: 'e-list-icon ' + cls.GRID_REMOVE + ' e-icons'\n                });\n                append([element], allElement[i].querySelector('.e-acrdn-header-icon'));\n            }\n        }\n    };\n    CalculatedField.prototype.clearFormula = function () {\n        if (this.treeObj && this.treeObj.element.querySelector('li')) {\n            removeClass(this.treeObj.element.querySelectorAll('li'), 'e-active');\n            this.displayMenu(this.treeObj.element.querySelector('li'));\n        }\n    };\n    /**\n     * To display context menu.\n     * @param  {HTMLElement} node\n     * @returns {void}\n     */\n    /* eslint-disable  */\n    CalculatedField.prototype.displayMenu = function (node, treeNode, target) {\n        var edit = target ? target.classList.contains(cls.CALC_EDIT) : true;\n        var edited = target ? target.classList.contains(cls.CALC_EDITED) : true;\n        if (this.parent.dataType === 'pivot' && node.querySelector('.e-list-icon.e-format') &&\n            node.querySelector('.e-list-icon.e-format').classList.contains(cls.ICON) &&\n            !node.querySelector('.e-list-icon').classList.contains(cls.CALC_EDITED) &&\n            !node.querySelector('.e-list-icon').classList.contains(cls.GRID_REMOVE) &&\n            !node.querySelector('.e-list-icon').classList.contains(cls.CALC_EDIT) && node.tagName === 'LI') {\n            if (this.menuObj && !this.menuObj.isDestroyed) {\n                this.menuObj.destroy();\n            }\n            this.curMenu = node.querySelector('.' + cls.LIST_TEXT_CLASS);\n            this.openContextMenu(node);\n        }\n        else if (node.tagName === 'LI' && (node.querySelector('.' + cls.CALC_EDIT) &&\n            node.querySelector('.' + cls.CALC_EDIT).classList.contains('e-list-icon') && edit ||\n            (this.parent.dataType === 'olap' && node.getAttribute('data-type') === CALC && node.classList.contains('e-active') && ((target && !target.classList.contains(cls.GRID_REMOVE)) || !target)))) {\n            this.isEdit = true;\n            var fieldName = node.getAttribute('data-field');\n            var caption = node.getAttribute('data-caption');\n            this.currentFieldName = fieldName;\n            this.inputObj.value = caption;\n            this.inputObj.dataBind();\n            var formatString = node.getAttribute('data-formatString');\n            var dialogElement = this.dialog.element;\n            var customFormat = getInstance(select('#' + this.parentID + 'Custom_Format_Element', dialogElement), MaskedTextBox);\n            if (this.parent.dataType === 'olap') {\n                var memberType = node.getAttribute('data-membertype');\n                var parentHierarchy = node.getAttribute('data-hierarchy');\n                var expression = node.getAttribute('data-formula');\n                var customString = node.getAttribute('data-customString');\n                var fieldTitle = select('#' + this.parentID + '_' + 'FieldNameTitle', dialogElement);\n                var memberTypeDrop = getInstance(select('#' + this.parentID + 'Member_Type_Div', dialogElement), DropDownList);\n                var hierarchyDrop = getInstance(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement), DropDownList);\n                var formatDrop = getInstance(select('#' + this.parentID + 'Format_Div', dialogElement), DropDownList);\n                /* eslint-enable max-len */\n                fieldTitle.innerHTML = this.parent.localeObj.getConstant('caption');\n                select('#' + this.parentID + 'droppable', document).value = expression;\n                memberTypeDrop.readonly = true;\n                memberTypeDrop.value = memberType;\n                memberTypeDrop.dataBind();\n                if (memberType === 'Dimension') {\n                    hierarchyDrop.value = parentHierarchy;\n                }\n                if (formatString !== '') {\n                    formatDrop.value = formatString;\n                    formatDrop.dataBind();\n                }\n                customFormat.value = customString;\n            }\n            else {\n                customFormat.value = formatString;\n                addClass(this.treeObj.element.querySelectorAll('.' + cls.CALC_EDITED), cls.CALC_EDIT);\n                removeClass(this.treeObj.element.querySelectorAll('.' + cls.CALC_EDITED), cls.CALC_EDITED);\n                addClass([node.querySelector('.e-list-icon')], cls.CALC_EDITED);\n                removeClass([node.querySelector('.e-list-icon')], cls.CALC_EDIT);\n                node.querySelector('.' + cls.CALC_EDITED).setAttribute('title', this.parent.localeObj.getConstant('clearCalculatedField'));\n                select('#' + this.parentID + 'droppable', document).value = node.getAttribute('data-uid');\n            }\n            customFormat.dataBind();\n        }\n        else if (node.tagName === 'LI' && (node.querySelector('.' + cls.CALC_EDITED) &&\n            node.querySelector('.' + cls.CALC_EDITED).classList.contains('e-list-icon') && edited ||\n            (this.parent.dataType === 'olap' && !node.classList.contains('e-active')))) {\n            this.isEdit = false;\n            this.inputObj.value = '';\n            this.inputObj.dataBind();\n            var dialogElement = this.dialog.element;\n            var customFormat = getInstance(select('#' + this.parentID + 'Custom_Format_Element', dialogElement), MaskedTextBox);\n            customFormat.value = '';\n            customFormat.dataBind();\n            if (this.parent.dataType === 'olap') {\n                var hierarchyDrop = getInstance(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement), DropDownList);\n                var formatDrop = getInstance(select('#' + this.parentID + 'Format_Div', dialogElement), DropDownList);\n                var memberTypeDrop = getInstance(select('#' + this.parentID + 'Member_Type_Div', dialogElement), DropDownList);\n                var fieldTitle = select('#' + this.parentID + '_' + 'FieldNameTitle', dialogElement);\n                /* eslint-enable max-len */\n                fieldTitle.innerHTML = this.parent.localeObj.getConstant('fieldTitle');\n                hierarchyDrop.index = 0;\n                hierarchyDrop.dataBind();\n                formatDrop.index = 0;\n                formatDrop.dataBind();\n                memberTypeDrop.index = 0;\n                memberTypeDrop.readonly = false;\n                memberTypeDrop.dataBind();\n            }\n            else {\n                addClass(this.treeObj.element.querySelectorAll('.' + cls.CALC_EDITED), cls.CALC_EDIT);\n                removeClass(this.treeObj.element.querySelectorAll('.' + cls.CALC_EDITED), cls.CALC_EDITED);\n                node.querySelector('.' + cls.CALC_EDIT).setAttribute('title', this.parent.localeObj.getConstant('edit'));\n            }\n            select('#' + this.parentID + 'droppable', document).value = '';\n        }\n        else if (node.tagName === 'LI' && (node.querySelector('.' + cls.GRID_REMOVE) &&\n            node.querySelector('.' + cls.GRID_REMOVE).classList.contains('e-list-icon')) && !edit && !edited) {\n            var dropField = select('#' + this.parentID + 'droppable', document);\n            var field = {\n                name: this.isEdit ? this.currentFieldName : this.inputObj.value,\n                caption: this.inputObj.value,\n                formula: dropField.value\n            };\n            this.createConfirmDialog(this.parent.localeObj.getConstant('alert'), this.parent.localeObj.getConstant('removeCalculatedField'), field, true, treeNode);\n        }\n    };\n    CalculatedField.prototype.removeCalcField = function (node) {\n        var dataSourceSettings = this.parent.dataSourceSettings;\n        var fieldName = node.getAttribute('data-field');\n        var calcfields = dataSourceSettings.calculatedFieldSettings;\n        var engineModule;\n        if (this.parent.dataType === 'pivot') {\n            if (!this.parent.isAdaptive) {\n                this.treeObj.removeNodes([node]);\n            }\n            else {\n                var index = parseInt(node.getAttribute('id').split(this.parentID + '_')[1], 10);\n                if (typeof index === 'number') {\n                    this.accordion.removeItem(index);\n                }\n            }\n        }\n        for (var i = 0; i < calcfields.length; i++) {\n            if (calcfields[i] && calcfields[i].name === fieldName) {\n                calcfields.splice(i, 1);\n                break;\n            }\n        }\n        if (this.parent.dataType === 'olap') {\n            engineModule = this.parent.olapEngineModule;\n            var fields_1 = engineModule.fieldListData ? engineModule.fieldListData : [];\n            /* eslint-disable @typescript-eslint/no-explicit-any */\n            for (var _i = 0, _a = Object.keys(fields_1); _i < _a.length; _i++) {\n                var item = _a[_i];\n                if (fields_1[item].name === fieldName) {\n                    var index = parseInt(item, 10);\n                    if (typeof (index) === 'number') {\n                        fields_1.splice(index, 1);\n                        break;\n                    }\n                }\n            }\n            /* eslint-enable @typescript-eslint/no-explicit-any */\n            var parentID = this.treeObj.getNode(node).parentID;\n            this.treeObj.removeNodes([node]);\n            if (calcfields.length <= 0) {\n                this.treeObj.removeNodes([parentID]);\n            }\n        }\n        else {\n            engineModule = this.parent.engineModule;\n        }\n        if (engineModule.fields) {\n            for (var i = 0; i < engineModule.fields.length; i++) {\n                if (engineModule.fields[i] === fieldName) {\n                    engineModule.fields.splice(i, 1);\n                    break;\n                }\n            }\n        }\n        if (engineModule.savedFieldList && engineModule.savedFieldList[fieldName]) {\n            delete engineModule.savedFieldList[fieldName];\n        }\n        if (engineModule.fieldList && engineModule.fieldList[fieldName]) {\n            delete engineModule.fieldList[fieldName];\n        }\n        var formatFields = dataSourceSettings.formatSettings;\n        for (var i = 0; i < formatFields.length; i++) {\n            if (formatFields[i] && formatFields[i].name === fieldName) {\n                formatFields.splice(i, 1);\n                break;\n            }\n        }\n        var fields = [dataSourceSettings.values, dataSourceSettings.rows, dataSourceSettings.columns, dataSourceSettings.filters];\n        for (var i = 0, n = fields.length; i < n; i++) {\n            for (var j = 0, length_1 = fields[i].length; j < length_1; j++) {\n                if (fields[i][j].name === fieldName) {\n                    fields[i].splice(j, 1);\n                    break;\n                }\n            }\n        }\n        /* eslint-enable max-len */\n        if (this.isEdit && this.currentFieldName === fieldName) {\n            this.isEdit = false;\n            this.inputObj.value = '';\n            this.currentFieldName = this.formatText = this.fieldText = this.formatType = null;\n            this.formulaText = this.fieldType = this.parentHierarchy = null;\n        }\n        if (!this.parent.allowDeferLayoutUpdate || this.parent.getModuleName() !== 'pivotfieldlist') {\n            this.parent.updateDataSource();\n        }\n        this.removeErrorDialog();\n    };\n    /**\n     * To set position for context menu.\n     * @returns {void}\n     */\n    CalculatedField.prototype.openContextMenu = function (node) {\n        var _this = this;\n        var fieldName = node.getAttribute('data-field');\n        var type = this.parent.engineModule.fieldList[fieldName].type !== 'number' ? 'string' : 'number';\n        var validSummaryTypes = (type === 'string' ? this.getValidSummaryType().slice(0, 2) : this.getValidSummaryType());\n        var eventArgs = {\n            cancel: false, fieldName: fieldName,\n            aggregateTypes: this.getMenuItems(type).slice()\n        };\n        var control = this.parent.getModuleName() === 'pivotfieldlist' && this.parent.isPopupView ?\n            this.parent.pivotGridModule : this.parent;\n        control.trigger(events.aggregateMenuOpen, eventArgs, function (observedArgs) {\n            if (!observedArgs.cancel) {\n                var duplicateTypes = [];\n                var items = [];\n                for (var _i = 0, _a = observedArgs.aggregateTypes; _i < _a.length; _i++) {\n                    var option = _a[_i];\n                    if (validSummaryTypes.indexOf(option) > -1 && duplicateTypes.indexOf(option) === -1) {\n                        duplicateTypes.push(option);\n                        items.push({\n                            id: _this.parent.element.id + 'Calc_' + option,\n                            text: _this.parent.localeObj.getConstant(option)\n                        });\n                    }\n                }\n                _this.createMenu(items, node);\n                var pos = node.getBoundingClientRect();\n                var offset = window.scrollY || document.documentElement.scrollTop;\n                if (_this.parent.enableRtl) {\n                    _this.menuObj.open(pos.top + offset, pos.left - 100);\n                }\n                else {\n                    _this.menuObj.open(pos.top + offset, pos.left + 150);\n                }\n            }\n        });\n    };\n    /**\n     * Triggers while select menu.\n     * @param  {MenuEventArgs} menu\n     * @returns {void}\n     */\n    CalculatedField.prototype.selectContextMenu = function (menu) {\n        if (menu.element.textContent !== null) {\n            var field = closest(this.curMenu, '.e-list-item').getAttribute('data-caption');\n            closest(this.curMenu, '.e-list-item').setAttribute('data-type', menu.element.id.split('_').pop());\n            this.curMenu.textContent = field + ' (' + menu.element.textContent + ')';\n            addClass([this.curMenu.parentElement.parentElement], ['e-node-focus', 'e-hover']);\n            this.curMenu.parentElement.parentElement.setAttribute('tabindex', '-1');\n            this.curMenu.parentElement.parentElement.focus();\n        }\n    };\n    /**\n     * To create context menu.\n     * @returns {void}\n     */\n    CalculatedField.prototype.createMenu = function (menuItems, node) {\n        var _this = this;\n        var menuOptions = {\n            cssClass: this.parentID + 'calculatedmenu',\n            items: menuItems,\n            enableRtl: this.parent.enableRtl,\n            locale: this.parent.locale,\n            // beforeOpen: this.beforeMenuOpen.bind(this),\n            select: this.selectContextMenu.bind(this),\n            onClose: function () {\n                _this.treeObj.element.focus();\n                addClass([node], ['e-hover', 'e-node-focus']);\n            }\n        };\n        var contextMenu;\n        if (select('#' + this.parentID + 'CalcContextmenu', document)) {\n            contextMenu = select('#' + this.parentID + 'CalcContextmenu', document);\n        }\n        else {\n            contextMenu = createElement('ul', {\n                id: this.parentID + 'CalcContextmenu'\n            });\n        }\n        this.dialog.element.appendChild(contextMenu);\n        this.menuObj = new Menu(menuOptions);\n        this.menuObj.isStringTemplate = true;\n        this.menuObj.appendTo(contextMenu);\n    };\n    /**\n     * Triggers while click OK button.\n     * @returns {void}\n     */\n    /* eslint-disable  */\n    CalculatedField.prototype.applyFormula = function () {\n        var _this = this;\n        var currentObj = this;\n        var isExist = false;\n        removeClass([document.getElementById(this.parentID + 'ddlelement')], cls.EMPTY_FIELD);\n        this.newFields =\n            extend([], this.parent.dataSourceSettings.calculatedFieldSettings, null, true);\n        var eventArgs = {\n            fieldName: this.isEdit ? this.currentFieldName : this.inputObj.value,\n            calculatedField: this.getCalculatedFieldInfo(),\n            calculatedFieldSettings: PivotUtil.cloneCalculatedFieldSettings(this.parent.dataSourceSettings.calculatedFieldSettings),\n            cancel: false\n        };\n        var control = this.parent.getModuleName() === 'pivotfieldlist' &&\n            this.parent.isPopupView ? this.parent.pivotGridModule : this.parent;\n        control.trigger(events.calculatedFieldCreate, eventArgs, function (observedArgs) {\n            if (!observedArgs.cancel) {\n                var calcInfo = observedArgs.calculatedField;\n                if (!_this.isEdit) {\n                    if (currentObj.parent.dataType === 'olap') {\n                        var field = calcInfo.name;\n                        if (currentObj.parent.olapEngineModule.fieldList[field] &&\n                            currentObj.parent.olapEngineModule.fieldList[field].type !== 'CalculatedField') {\n                            isExist = true;\n                        }\n                    }\n                    else {\n                        for (var _i = 0, _a = Object.keys(currentObj.parent.engineModule.fieldList); _i < _a.length; _i++) {\n                            var key = _a[_i];\n                            if (calcInfo.name && calcInfo.name === key &&\n                                currentObj.parent.engineModule.fieldList[key].aggregateType !== 'CalculatedField') {\n                                isExist = true;\n                            }\n                        }\n                    }\n                }\n                if (isExist) {\n                    currentObj.parent.pivotCommon.errorDialog.createErrorDialog(currentObj.parent.localeObj.getConstant('error'), currentObj.parent.localeObj.getConstant('fieldExist'));\n                    return;\n                }\n                _this.existingReport = extend({}, _this.parent.dataSourceSettings, null, true);\n                var report = _this.parent.dataSourceSettings;\n                if (!isNullOrUndefined(calcInfo.name) && calcInfo.name !== '' &&\n                    !isNullOrUndefined(calcInfo.caption) && calcInfo.caption !== '' && calcInfo.formula && calcInfo.formula !== '') {\n                    var field = void 0;\n                    if (_this.parent.dataType === 'olap') {\n                        field = {\n                            name: calcInfo.name,\n                            formula: calcInfo.formula,\n                            formatString: calcInfo.formatString\n                        };\n                        if (!isNullOrUndefined(calcInfo.hierarchyUniqueName)) {\n                            field.hierarchyUniqueName = calcInfo.hierarchyUniqueName;\n                        }\n                        _this.isFieldExist = false;\n                        if (!_this.isEdit) {\n                            for (var i = 0; i < report.calculatedFieldSettings.length; i++) {\n                                if (report.calculatedFieldSettings[i].name === field.name) {\n                                    _this.createConfirmDialog(currentObj.parent.localeObj.getConstant('alert'), currentObj.parent.localeObj.getConstant('confirmText'), calcInfo);\n                                    return;\n                                }\n                            }\n                        }\n                        else {\n                            for (var i = 0; i < report.calculatedFieldSettings.length; i++) {\n                                if (report.calculatedFieldSettings[i].name === field.name && _this.isEdit) {\n                                    report.calculatedFieldSettings[i].hierarchyUniqueName = calcInfo.hierarchyUniqueName;\n                                    _this.parent.olapEngineModule.fieldList[field.name].caption = calcInfo.caption;\n                                    report.calculatedFieldSettings[i].formatString = field.formatString;\n                                    report.calculatedFieldSettings[i].formula = field.formula;\n                                    field = report.calculatedFieldSettings[i];\n                                    _this.isFieldExist = true;\n                                    break;\n                                }\n                            }\n                            var axisFields = [report.rows, report.columns, report.values, report.filters];\n                            var isFieldExist = false;\n                            for (var _b = 0, axisFields_1 = axisFields; _b < axisFields_1.length; _b++) {\n                                var fields = axisFields_1[_b];\n                                for (var _c = 0, fields_2 = fields; _c < fields_2.length; _c++) {\n                                    var item = fields_2[_c];\n                                    if (item.isCalculatedField && field.name !== null &&\n                                        item.name === field.name && _this.isEdit) {\n                                        item.caption = calcInfo.caption;\n                                        _this.isFieldExist = true;\n                                        isFieldExist = true;\n                                        break;\n                                    }\n                                }\n                                if (isFieldExist) {\n                                    break;\n                                }\n                            }\n                        }\n                        if (!_this.isFieldExist) {\n                            report.calculatedFieldSettings.push(field);\n                        }\n                        _this.parent.lastCalcFieldInfo = field;\n                    }\n                    else {\n                        field = {\n                            name: calcInfo.name,\n                            caption: calcInfo.caption,\n                            type: 'CalculatedField'\n                        };\n                        var cField = {\n                            name: calcInfo.name,\n                            formula: calcInfo.formula\n                        };\n                        if (!isNullOrUndefined(calcInfo.formatString)) {\n                            cField.formatString = calcInfo.formatString;\n                        }\n                        _this.isFieldExist = true;\n                        if (!_this.isEdit) {\n                            for (var i = 0; i < report.values.length; i++) {\n                                if (report.values[i].type === CALC && report.values[i].name === field.name) {\n                                    for (var j = 0; j < report.calculatedFieldSettings.length; j++) {\n                                        if (report.calculatedFieldSettings[j].name === field.name) {\n                                            _this.createConfirmDialog(currentObj.parent.localeObj.getConstant('alert'), currentObj.parent.localeObj.getConstant('confirmText'), calcInfo);\n                                            return;\n                                        }\n                                    }\n                                    _this.isFieldExist = false;\n                                }\n                            }\n                        }\n                        else {\n                            for (var i = 0; i < report.values.length; i++) {\n                                if (report.values[i].type === CALC && field.name !== null &&\n                                    report.values[i].name === field.name && _this.isEdit) {\n                                    for (var j = 0; j < report.calculatedFieldSettings.length; j++) {\n                                        if (report.calculatedFieldSettings[j].name === field.name) {\n                                            report.values[i].caption = calcInfo.caption;\n                                            _this.currentFormula = report.calculatedFieldSettings[j].formula;\n                                            report.calculatedFieldSettings[j].formula = calcInfo.formula;\n                                            _this.parent.engineModule.fieldList[field.name].caption = calcInfo.caption;\n                                            _this.updateFormatSettings(report, field.name, calcInfo.formatString);\n                                            _this.isFieldExist = false;\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                        if (_this.isFieldExist) {\n                            report.values.push(field);\n                            report.calculatedFieldSettings.push(cField);\n                            _this.updateFormatSettings(report, field.name, calcInfo.formatString);\n                        }\n                        _this.parent.lastCalcFieldInfo = cField;\n                    }\n                    _this.addFormula(report, field.name);\n                }\n                else {\n                    if (isNullOrUndefined(calcInfo.name) || calcInfo.name === '' ||\n                        isNullOrUndefined(calcInfo.caption) || calcInfo.caption === '') {\n                        _this.inputObj.value = '';\n                        addClass([document.getElementById(_this.parentID + 'ddlelement')], cls.EMPTY_FIELD);\n                        document.getElementById(_this.parentID + 'ddlelement').focus();\n                    }\n                    else {\n                        _this.parent.pivotCommon.errorDialog.createErrorDialog(_this.parent.localeObj.getConstant('error'), _this.parent.localeObj.getConstant('invalidFormula'));\n                    }\n                }\n            }\n            else {\n                _this.endDialog();\n                _this.parent.lastCalcFieldInfo = {};\n                _this.isFormula = false;\n            }\n        });\n    };\n    CalculatedField.prototype.getCalculatedFieldInfo = function () {\n        var field;\n        var dropField = select('#' + this.parentID + 'droppable', document);\n        var dialogElement = this.parent.isAdaptive ? this.parent.dialogRenderer.adaptiveElement.element : this.dialog.element;\n        var customFormat = getInstance(select('#' + this.parentID + 'Custom_Format_Element', dialogElement), MaskedTextBox);\n        field = {\n            name: this.isEdit ? this.currentFieldName : this.inputObj.value,\n            caption: this.inputObj.value,\n            formula: dropField.value\n        };\n        if (this.parent.dataType === 'olap') {\n            var formatDrop = getInstance(select('#' + this.parentID + 'Format_Div', dialogElement), DropDownList);\n            var memberTypeDrop = getInstance(select('#' + this.parentID + 'Member_Type_Div', dialogElement), DropDownList);\n            var hierarchyDrop = getInstance(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement), DropDownList);\n            field.formatString = (formatDrop.value === 'Custom' ? customFormat.value : formatDrop.value);\n            if (memberTypeDrop.value === 'Dimension') {\n                field.hierarchyUniqueName = hierarchyDrop.value;\n            }\n        }\n        else {\n            field.formatString = customFormat.value;\n        }\n        return field;\n    };\n    /* eslint-enable max-len */\n    CalculatedField.prototype.updateFormatSettings = function (report, fieldName, formatString) {\n        var newFormat = { name: fieldName, format: formatString, useGrouping: true };\n        var isFormatExist = false;\n        for (var i = 0; i < report.formatSettings.length; i++) {\n            if (report.formatSettings[i].name === fieldName) {\n                if (formatString === 'undefined' || formatString === undefined || formatString === '') {\n                    report.formatSettings.splice(i, 1);\n                    isFormatExist = true;\n                    break;\n                }\n                else {\n                    var formatObj = report.formatSettings[i].properties ?\n                        report.formatSettings[i].properties : report.formatSettings[i];\n                    formatObj.format = formatString;\n                    report.formatSettings.splice(i, 1, formatObj);\n                    isFormatExist = true;\n                    break;\n                }\n            }\n        }\n        if (!isFormatExist && formatString !== '') {\n            report.formatSettings.push(newFormat);\n        }\n    };\n    CalculatedField.prototype.addFormula = function (report, field) {\n        this.isFormula = true;\n        this.field = field;\n        if (isBlazor() || this.parent.dataSourceSettings.mode === 'Server') {\n            PivotUtil.updateDataSourceSettings(this.parent, PivotUtil.getClonedDataSourceSettings(report));\n        }\n        else {\n            this.parent.setProperties({ dataSourceSettings: report }, true);\n        }\n        if (this.parent.getModuleName() === 'pivotfieldlist' && this.parent.allowDeferLayoutUpdate) {\n            this.parent.isRequiredUpdate = false;\n        }\n        try {\n            this.parent.updateDataSource(false);\n            var pivot = (this.parent.getModuleName() === 'pivotfieldlist' && this.parent.pivotGridModule) ?\n                this.parent.pivotGridModule : this.parent;\n            if (!(isBlazor() && pivot && pivot.enableVirtualization) && (pivot && pivot.dataSourceSettings.mode !== 'Server')) {\n                this.endDialog();\n            }\n            else {\n                this.isRequireUpdate = true;\n            }\n            if (this.parent.getModuleName() === 'pivotfieldlist' &&\n                this.parent.renderMode === 'Fixed' && this.parent.allowDeferLayoutUpdate) {\n                this.parent.pivotChange = true;\n            }\n        }\n        catch (exception) {\n            this.showError();\n        }\n    };\n    /** @hidden */\n    CalculatedField.prototype.endDialog = function () {\n        this.isEdit = false;\n        if (this.dialog) {\n            this.dialog.close();\n        }\n        else {\n            this.inputObj.value = '';\n            this.currentFieldName = this.formatText = this.fieldText = this.formatType = null;\n            this.formulaText = this.fieldType = this.parentHierarchy = null;\n            var dialogElement = this.parent.isAdaptive ?\n                this.parent.dialogRenderer.parentElement : this.dialog.element;\n            this.parent.dialogRenderer.parentElement.querySelector('.' + cls.CALCINPUT).value = '';\n            select('#' + this.parentID + 'droppable', this.parent.dialogRenderer.parentElement).value = '';\n            select('#' + this.parentID + 'Custom_Format_Element', this.parent.dialogRenderer.parentElement).value = '';\n            if (this.parent.dataType === 'olap') {\n                var customFormat = getInstance(select('#' + this.parentID + 'Custom_Format_Element', dialogElement), MaskedTextBox);\n                var formatDrop = getInstance(select('#' + this.parentID + 'Format_Div', dialogElement), DropDownList);\n                var memberTypeDrop = getInstance(select('#' + this.parentID + 'Member_Type_Div', dialogElement), DropDownList);\n                var hierarchyDrop = getInstance(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement), DropDownList);\n                formatDrop.index = 0;\n                formatDrop.dataBind();\n                memberTypeDrop.index = 0;\n                memberTypeDrop.readonly = false;\n                memberTypeDrop.dataBind();\n                hierarchyDrop.index = 0;\n                hierarchyDrop.enabled = false;\n                hierarchyDrop.dataBind();\n                customFormat.enabled = false;\n                customFormat.dataBind();\n            }\n            /* eslint-enable max-len */\n        }\n    };\n    /** @hidden */\n    CalculatedField.prototype.showError = function () {\n        if (this.parent.engineModule.fieldList[this.field]) {\n            delete this.parent.engineModule.fieldList[this.field];\n        }\n        this.parent.pivotCommon.errorDialog.createErrorDialog(this.parent.localeObj.getConstant('error'), this.parent.localeObj.getConstant('invalidFormula'));\n        if (isBlazor()) {\n            PivotUtil.updateDataSourceSettings(this.parent, PivotUtil.getClonedDataSourceSettings(this.existingReport));\n        }\n        else {\n            this.parent.setProperties({ dataSourceSettings: this.existingReport }, true);\n        }\n        if (this.isEdit) {\n            var calcFields = this.parent.dataSourceSettings.calculatedFieldSettings;\n            for (var i = 0; calcFields && i < calcFields.length; i++) {\n                if (calcFields[i].name === this.field) {\n                    calcFields[i].formula = this.currentFormula;\n                    break;\n                }\n            }\n        }\n        else if (this.parent.engineModule.fields) {\n            for (var i = 0; i < this.parent.engineModule.fields.length; i++) {\n                if (this.parent.engineModule.fields[i] === this.field) {\n                    this.parent.engineModule.fields.splice(i, 1);\n                    break;\n                }\n            }\n        }\n        this.parent.lastCalcFieldInfo = {};\n        this.parent.updateDataSource(false);\n        this.isFormula = false;\n    };\n    /**\n     * To get treeview data\n     * @param  {PivotGrid|PivotFieldList} parent\n     * @returns Object\n     */\n    CalculatedField.prototype.getFieldListData = function (parent) {\n        var fields = [];\n        if (this.parent.dataType === 'olap') {\n            fields =\n                PivotUtil.getClonedData(parent.olapEngineModule.fieldListData ?\n                    parent.olapEngineModule.fieldListData : []);\n            for (var _i = 0, _a = fields; _i < _a.length; _i++) {\n                var item = _a[_i];\n                if (item.spriteCssClass &&\n                    (item.spriteCssClass.indexOf('e-attributeCDB-icon') > -1 ||\n                        item.spriteCssClass.indexOf('e-level-members') > -1)) {\n                    item.hasChildren = true;\n                }\n                else if (item.spriteCssClass &&\n                    (item.spriteCssClass.indexOf('e-namedSetCDB-icon') > -1)) {\n                    item.hasChildren = false;\n                }\n                else if (item.spriteCssClass &&\n                    (item.spriteCssClass.indexOf('e-calcMemberGroupCDB') > -1)) {\n                    item.expanded = this.isEdit;\n                }\n            }\n        }\n        else {\n            for (var _b = 0, _c = (parent.engineModule.fieldList ? Object.keys(parent.engineModule.fieldList) : []); _b < _c.length; _b++) {\n                var key = _c[_b];\n                var type = null;\n                var typeVal = null;\n                if ((parent.engineModule.fieldList[key].type !== 'number' || parent.engineModule.fieldList[key].type === 'include' ||\n                    parent.engineModule.fieldList[key].type === 'exclude') &&\n                    (parent.engineModule.fieldList[key].aggregateType !== 'DistinctCount')) {\n                    typeVal = COUNT;\n                }\n                else {\n                    typeVal = parent.engineModule.fieldList[key].aggregateType !== undefined ?\n                        (parent.engineModule.fieldList[key].aggregateType) : SUM;\n                }\n                type = this.parent.localeObj.getConstant(typeVal);\n                fields.push({\n                    index: parent.engineModule.fieldList[key].index,\n                    name: parent.engineModule.fieldList[key].caption + ' (' + type + ')',\n                    type: typeVal,\n                    icon: cls.FORMAT + ' ' + cls.ICON,\n                    formula: parent.engineModule.fieldList[key].formula,\n                    field: key,\n                    caption: parent.engineModule.fieldList[key].caption ? parent.engineModule.fieldList[key].caption : key\n                });\n            }\n        }\n        return fields;\n    };\n    /**\n     * Triggers before menu opens.\n     * @param  {BeforeOpenCloseMenuEventArgs} args\n     * @returns {void}\n     */\n    /**\n     * Trigger while drop node in formula field.\n     * @param  {DragAndDropEventArgs} args\n     * @returns {void}\n     */\n    CalculatedField.prototype.fieldDropped = function (args) {\n        args.cancel = true;\n        var dropField = select('#' + this.parentID + 'droppable', this.dialog.element);\n        removeClass([dropField], 'e-copy-drop');\n        removeClass([args.draggedNode.querySelector('.' + cls.LIST_TEXT_CLASS)], cls.SELECTED_NODE_CLASS);\n        var field = args.draggedNode.getAttribute('data-field');\n        if (this.parent.dataType === 'olap') {\n            if (this.parent.olapEngineModule.fieldList[field] &&\n                this.parent.olapEngineModule.fieldList[field].isCalculatedField) {\n                field = this.parent.olapEngineModule.fieldList[field].tag;\n            }\n            if (args.target.id === this.parentID + 'droppable' && dropField.value === '') {\n                dropField.value = field;\n                dropField.focus();\n            }\n            else if (args.target.id === (this.parentID + 'droppable') && dropField.value !== '') {\n                var textCovered = void 0;\n                var currentValue = dropField.value;\n                var cursorPos = dropField.selectionStart;\n                var textAfterText = currentValue.substring(cursorPos, currentValue.length);\n                var textBeforeText = currentValue.substring(0, cursorPos);\n                textCovered = textBeforeText + field;\n                dropField.value = textBeforeText + field + textAfterText;\n                dropField.focus();\n                dropField.setSelectionRange(textCovered.length, textCovered.length);\n            }\n            else {\n                args.cancel = true;\n            }\n        }\n        else {\n            var type = args.draggedNode.getAttribute('data-type');\n            if (args.target.id === this.parentID + 'droppable' && dropField.value === '') {\n                if (type === CALC) {\n                    dropField.value = args.draggedNodeData.id.toString();\n                }\n                else {\n                    dropField.value = '\"' + type + '(' + field + ')' + '\"';\n                }\n                dropField.focus();\n            }\n            else if (args.target.id === (this.parentID + 'droppable') && dropField.value !== '') {\n                var textCovered = void 0;\n                var cursorPos = dropField.selectionStart;\n                var currentValue = dropField.value;\n                var textBeforeText = currentValue.substring(0, cursorPos);\n                var textAfterText = currentValue.substring(cursorPos, currentValue.length);\n                if (type === CALC) {\n                    textCovered = textBeforeText + args.draggedNodeData.id.toString();\n                    dropField.value = textBeforeText + args.draggedNodeData.id.toString() + textAfterText;\n                }\n                else {\n                    textCovered = textBeforeText + '\"' + type + '(' + field + ')' + '\"';\n                    dropField.value = textBeforeText + '\"' + type + '(' + field + ')' + '\"' + textAfterText;\n                }\n                dropField.focus();\n                dropField.setSelectionRange(textCovered.length, textCovered.length);\n            }\n            else {\n                args.cancel = true;\n            }\n        }\n    };\n    /**\n     * To create dialog.\n     * @returns {void}\n     */\n    CalculatedField.prototype.createDialog = function () {\n        var _this = this;\n        if (select('#' + this.parentID + 'calculateddialog', document) !== null) {\n            remove(select('#' + this.parentID + 'calculateddialog', document));\n            while (!isNullOrUndefined(document.querySelector('.' + this.parentID + 'calculatedmenu'))) {\n                remove(document.querySelector('.' + this.parentID + 'calculatedmenu'));\n            }\n        }\n        this.parent.element.appendChild(createElement('div', {\n            id: this.parentID + 'calculateddialog',\n            className: cls.CALCDIALOG + ' ' + (this.parent.dataType === 'olap' ? cls.OLAP_CALCDIALOG : '')\n        }));\n        var calcButtons = [\n            {\n                click: this.applyFormula.bind(this),\n                buttonModel: {\n                    content: this.parent.localeObj.getConstant('ok'),\n                    isPrimary: true\n                }\n            },\n            {\n                click: this.cancelClick.bind(this),\n                buttonModel: {\n                    content: this.parent.localeObj.getConstant('cancel')\n                }\n            }\n        ];\n        if (this.parent.dataType === 'olap') {\n            var clearButton = {\n                click: this.clearFormula.bind(this),\n                buttonModel: {\n                    cssClass: 'e-calc-clear-btn',\n                    content: this.parent.localeObj.getConstant('clear'),\n                }\n            };\n            calcButtons.splice(0, 0, clearButton);\n        }\n        this.dialog = new Dialog({\n            allowDragging: true,\n            position: { X: 'center', Y: 'center' },\n            buttons: calcButtons,\n            close: this.closeDialog.bind(this),\n            beforeOpen: this.beforeOpen.bind(this),\n            open: function () {\n                if (select('#' + _this.parentID + 'ddlelement', _this.dialog.element)) {\n                    select('#' + _this.parentID + 'ddlelement', _this.dialog.element).focus();\n                }\n            },\n            animationSettings: { effect: 'Zoom' },\n            width: '25%',\n            isModal: false,\n            closeOnEscape: true,\n            enableRtl: this.parent.enableRtl,\n            locale: this.parent.locale,\n            showCloseIcon: true,\n            header: this.parent.localeObj.getConstant('createCalculatedField'),\n            target: document.body\n        });\n        this.dialog.isStringTemplate = true;\n        this.dialog.appendTo('#' + this.parentID + 'calculateddialog');\n    };\n    CalculatedField.prototype.cancelClick = function () {\n        this.dialog.close();\n        this.isEdit = false;\n    };\n    CalculatedField.prototype.beforeOpen = function (args) {\n        // this.dialog.element.querySelector('.e-dlg-header').innerHTML = this.parent.localeObj.getConstant('createCalculatedField');\n        this.dialog.element.querySelector('.e-dlg-header').\n            setAttribute('title', this.parent.localeObj.getConstant('createCalculatedField'));\n    };\n    CalculatedField.prototype.closeDialog = function (args) {\n        if (this.parent.getModuleName() === 'pivotfieldlist') {\n            this.parent.axisFieldModule.render();\n            if (this.parent.renderMode !== 'Fixed') {\n                addClass([this.parent.element.querySelector('.' + cls.TOGGLE_FIELD_LIST_CLASS)], cls.ICON_HIDDEN);\n                this.parent.dialogRenderer.fieldListDialog.show();\n            }\n        }\n        this.treeObj.destroy();\n        this.dialog.destroy();\n        this.newFields = null;\n        if (this.menuObj && !this.menuObj.isDestroyed) {\n            this.menuObj.destroy();\n        }\n        remove(document.getElementById(this.parentID + 'calculateddialog'));\n        if (!isNullOrUndefined(document.querySelector('.' + this.parentID + 'calculatedmenu'))) {\n            remove(document.querySelector('.' + this.parentID + 'calculatedmenu'));\n        }\n        var timeOut = ((this.parent.getModuleName() === 'pivotview') ||\n            ((this.parent.getModuleName() === 'pivotfieldlist') &&\n                this.parent.renderMode === 'Fixed')) ? 0 : 500;\n        if (this.buttonCall) {\n            this.buttonCall = false;\n            setTimeout(this.setFocus.bind(this), timeOut);\n        }\n    };\n    CalculatedField.prototype.setFocus = function () {\n        var parentElement;\n        if (this.parent.getModuleName() === 'pivotview' && this.parent.element) {\n            parentElement = this.parent.element;\n        }\n        else if (document.getElementById(this.parent.element.id + '_Wrapper')) {\n            parentElement = document.getElementById(this.parent.element.id + '_Wrapper');\n        }\n        if (parentElement) {\n            var pivotButtons = [].slice.call(parentElement.querySelectorAll('.e-pivot-button'));\n            for (var _i = 0, pivotButtons_1 = pivotButtons; _i < pivotButtons_1.length; _i++) {\n                var item = pivotButtons_1[_i];\n                if (item.getAttribute('data-uid') === this.currentFieldName) {\n                    item.focus();\n                    break;\n                }\n            }\n        }\n    };\n    /**\n     * To render dialog elements.\n     * @returns {void}\n     */\n    CalculatedField.prototype.renderDialogElements = function () {\n        var outerDiv = createElement('div', {\n            id: this.parentID + 'outerDiv',\n            className: (this.parent.dataType === 'olap' ? cls.OLAP_CALCOUTERDIV + ' ' : '') + cls.CALCOUTERDIV\n        });\n        var olapFieldTreeDiv = createElement('div', { id: this.parentID + 'Olap_Tree_Div', className: 'e-olap-field-tree-div' });\n        var olapCalcDiv = createElement('div', { id: this.parentID + 'Olap_Calc_Div', className: 'e-olap-calculated-div' });\n        if (this.parent.getModuleName() === 'pivotfieldlist' && this.parent.\n            dialogRenderer.parentElement.querySelector('.' + cls.FORMULA) !== null && this.parent.isAdaptive) {\n            var accordDiv = createElement('div', { id: this.parentID + 'accordDiv', className: cls.CALCACCORD });\n            outerDiv.appendChild(accordDiv);\n            var buttonDiv = createElement('div', { id: this.parentID + 'buttonDiv', className: cls.CALCBUTTONDIV });\n            var addBtn = createElement('button', {\n                id: this.parentID + 'addBtn', innerHTML: this.parent.localeObj.getConstant('add'),\n                className: cls.CALCADDBTN, attrs: { 'type': 'button' }\n            });\n            var cancelBtn = createElement('button', {\n                id: this.parentID + 'cancelBtn', innerHTML: this.parent.localeObj.getConstant('cancel'),\n                className: cls.CALCCANCELBTN, attrs: { 'type': 'button' }\n            });\n            buttonDiv.appendChild(cancelBtn);\n            buttonDiv.appendChild(addBtn);\n            outerDiv.appendChild(buttonDiv);\n        }\n        else {\n            if (!this.parent.isAdaptive && this.parent.dataType === 'olap') {\n                var formulaTitle = createElement('div', {\n                    className: cls.PIVOT_FIELD_TITLE_CLASS, id: this.parentID + '_' + 'FieldNameTitle',\n                    innerHTML: this.parent.localeObj.getConstant('fieldTitle')\n                });\n                olapCalcDiv.appendChild(formulaTitle);\n            }\n            var inputDiv = createElement('div', { id: this.parentID + 'outerDiv', className: cls.CALCINPUTDIV });\n            var inputObj = createElement('input', {\n                id: this.parentID + 'ddlelement',\n                attrs: { 'type': 'text' },\n                className: cls.CALCINPUT\n            });\n            inputDiv.appendChild(inputObj);\n            (this.parent.dataType === 'olap' && !this.parent.isAdaptive ? olapCalcDiv.appendChild(inputDiv) : outerDiv.appendChild(inputDiv));\n            var wrapDiv = createElement('div', { id: this.parentID + 'control_wrapper', className: cls.TREEVIEWOUTER });\n            if (!this.parent.isAdaptive) {\n                var fieldTitle = createElement('div', {\n                    className: cls.PIVOT_ALL_FIELD_TITLE_CLASS,\n                    innerHTML: (this.parent.dataType === 'olap' ? this.parent.localeObj.getConstant('allFields') :\n                        this.parent.localeObj.getConstant('formulaField'))\n                });\n                if (this.parent.dataType === 'olap') {\n                    var headerWrapperDiv = createElement('div', { className: cls.PIVOT_ALL_FIELD_TITLE_CLASS + '-wrapper' });\n                    headerWrapperDiv.appendChild(fieldTitle);\n                    var spanElement = createElement('span', {\n                        attrs: {\n                            'tabindex': '0',\n                            'aria-disabled': 'false',\n                            'aria-label': this.parent.localeObj.getConstant('fieldTooltip'),\n                        },\n                        className: cls.ICON + ' ' + cls.CALC_INFO\n                    });\n                    headerWrapperDiv.appendChild(spanElement);\n                    var tooltip = new Tooltip({\n                        content: this.parent.localeObj.getConstant('fieldTooltip'),\n                        position: (this.parent.enableRtl ? 'RightCenter' : 'LeftCenter'),\n                        target: '.' + cls.CALC_INFO,\n                        offsetY: (this.parent.enableRtl ? -10 : -10),\n                        locale: this.parent.locale,\n                        enableRtl: this.parent.enableRtl,\n                        width: 220\n                    });\n                    tooltip.appendTo(headerWrapperDiv);\n                    wrapDiv.appendChild(headerWrapperDiv);\n                }\n                else {\n                    outerDiv.appendChild(fieldTitle);\n                }\n            }\n            var treeOuterDiv = createElement('div', { className: cls.TREEVIEW + '-outer-div' });\n            wrapDiv.appendChild(treeOuterDiv);\n            treeOuterDiv.appendChild(createElement('div', { id: this.parentID + 'tree', className: cls.TREEVIEW }));\n            (this.parent.dataType === 'olap' && !this.parent.isAdaptive ? olapFieldTreeDiv.appendChild(wrapDiv) : outerDiv.appendChild(wrapDiv));\n            if (!this.parent.isAdaptive) {\n                var formulaTitle = createElement('div', {\n                    className: cls.PIVOT_FORMULA_TITLE_CLASS,\n                    innerHTML: (this.parent.dataType === 'olap' ? this.parent.localeObj.getConstant('expressionField') :\n                        this.parent.localeObj.getConstant('formula'))\n                });\n                (this.parent.dataType === 'olap' ? olapCalcDiv.appendChild(formulaTitle) : outerDiv.appendChild(formulaTitle));\n            }\n            var dropDiv = createElement('textarea', {\n                id: this.parentID + 'droppable',\n                className: cls.FORMULA + ' e-control e-textbox e-input',\n                attrs: {\n                    'placeholder': this.parent.isAdaptive ? this.parent.localeObj.getConstant('dropTextMobile') :\n                        (this.parent.dataType === 'olap' ? this.parent.localeObj.getConstant('olapDropText') :\n                            this.parent.localeObj.getConstant('dropText'))\n                }\n            });\n            (this.parent.dataType === 'olap' && !this.parent.isAdaptive ? olapCalcDiv.appendChild(dropDiv) : outerDiv.appendChild(dropDiv));\n            if (this.parent.isAdaptive) {\n                var buttonDiv = createElement('div', { id: this.parentID + 'buttonDiv', className: cls.CALCBUTTONDIV });\n                var okBtn = createElement('button', {\n                    id: this.parentID + 'okBtn', innerHTML: this.parent.localeObj.getConstant('apply'),\n                    className: cls.CALCOKBTN, attrs: { 'type': 'button' }\n                });\n                buttonDiv.appendChild(okBtn);\n                outerDiv.appendChild(buttonDiv);\n            }\n            if (this.parent.dataType === 'olap') {\n                if (!this.parent.isAdaptive) {\n                    var memberTypeTitle = createElement('div', {\n                        className: cls.OLAP_MEMBER_TITLE_CLASS,\n                        innerHTML: this.parent.localeObj.getConstant('memberType')\n                    });\n                    olapCalcDiv.appendChild(memberTypeTitle);\n                }\n                var memberTypeDrop = createElement('div', { id: this.parentID + 'Member_Type_Div', className: cls.CALC_MEMBER_TYPE_DIV });\n                (this.parent.isAdaptive ? outerDiv.appendChild(memberTypeDrop) : olapCalcDiv.appendChild(memberTypeDrop));\n                if (!this.parent.isAdaptive) {\n                    var hierarchyTitle = createElement('div', {\n                        className: cls.OLAP_HIERARCHY_TITLE_CLASS,\n                        innerHTML: this.parent.localeObj.getConstant('selectedHierarchy')\n                    });\n                    olapCalcDiv.appendChild(hierarchyTitle);\n                }\n                var hierarchyDrop = createElement('div', { id: this.parentID + 'Hierarchy_List_Div', className: cls.CALC_HIERARCHY_LIST_DIV });\n                (this.parent.isAdaptive ? outerDiv.appendChild(hierarchyDrop) : olapCalcDiv.appendChild(hierarchyDrop));\n                if (!this.parent.isAdaptive) {\n                    var formatTitle = createElement('div', {\n                        className: cls.OLAP_FORMAT_TITLE_CLASS,\n                        innerHTML: this.parent.localeObj.getConstant('formatString')\n                    });\n                    olapCalcDiv.appendChild(formatTitle);\n                }\n                var formatDrop = createElement('div', { id: this.parentID + 'Format_Div', className: cls.CALC_FORMAT_TYPE_DIV });\n                (this.parent.isAdaptive ? outerDiv.appendChild(formatDrop) : olapCalcDiv.appendChild(formatDrop));\n                var customFormatDiv = createElement('div', { id: this.parentID + 'custom_Format_Div', className: cls.OLAP_CALC_CUSTOM_FORMAT_INPUTDIV });\n                var customFormatObj = createElement('input', {\n                    id: this.parentID + 'Custom_Format_Element',\n                    attrs: { 'type': 'text' },\n                    className: cls.CALC_FORMAT_INPUT\n                });\n                customFormatDiv.appendChild(customFormatObj);\n                olapCalcDiv.appendChild(customFormatDiv);\n                (this.parent.isAdaptive ? outerDiv.appendChild(customFormatDiv) : olapCalcDiv.appendChild(customFormatDiv));\n                if (this.parent.getModuleName() === 'pivotfieldlist' && this.parent.\n                    dialogRenderer.parentElement.querySelector('.' + cls.FORMULA) === null && this.parent.isAdaptive) {\n                    var okBtn = outerDiv.querySelector('.' + cls.CALCOKBTN);\n                    outerDiv.appendChild(okBtn);\n                }\n                else {\n                    outerDiv.appendChild(olapFieldTreeDiv);\n                    outerDiv.appendChild(olapCalcDiv);\n                }\n            }\n            else {\n                var customFormatDiv = createElement('div', { id: this.parentID + 'custom_Format_Div', className: cls.CALC_CUSTOM_FORMAT_INPUTDIV });\n                if (!this.parent.isAdaptive) {\n                    var formatTitle = createElement('div', {\n                        className: cls.OLAP_FORMAT_TITLE_CLASS,\n                        innerHTML: this.parent.localeObj.getConstant('formatString')\n                    });\n                    customFormatDiv.appendChild(formatTitle);\n                }\n                var customFormatObj = createElement('input', {\n                    id: this.parentID + 'Custom_Format_Element',\n                    attrs: { 'type': 'text' },\n                    className: cls.CALC_FORMAT_INPUT\n                });\n                customFormatDiv.appendChild(customFormatObj);\n                (this.parent.isAdaptive ? outerDiv.insertBefore(customFormatDiv, select('#' + this.parentID + 'buttonDiv', outerDiv)) : outerDiv.appendChild(customFormatDiv));\n            }\n        }\n        return outerDiv;\n    };\n    /**\n     * To create calculated field adaptive layout.\n     * @returns {void}\n     */\n    CalculatedField.prototype.renderAdaptiveLayout = function (isEdit) {\n        var dialogElement = this.parent.dialogRenderer.adaptiveElement;\n        if (isEdit) {\n            if (select('#' + this.parentID + 'droppable', dialogElement.element)) {\n                this.formulaText = select('#' + this.parentID + 'droppable', document).value;\n                this.fieldText = this.inputObj.value;\n            }\n            if (dialogElement.element.querySelector('.' + cls.CALC_MEMBER_TYPE_DIV)) {\n                var memberTypeDrop = getInstance(select('#' + this.parentID + 'Member_Type_Div', dialogElement.element), DropDownList);\n                this.fieldType = memberTypeDrop.value;\n            }\n            if (dialogElement.element.querySelector('.' + cls.CALC_HIERARCHY_LIST_DIV)) {\n                var hierarchyDrop = getInstance(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement.element), DropDownList);\n                this.parentHierarchy = this.fieldType === 'Dimension' ? hierarchyDrop.value : null;\n            }\n            if (dialogElement.element.querySelector('.' + cls.CALC_FORMAT_TYPE_DIV)) {\n                var formatDrop = getInstance(select('#' + this.parentID + 'Format_Div', dialogElement.element), DropDownList);\n                this.formatType = formatDrop.value;\n            }\n            if (dialogElement.element.querySelector('.' + cls.CALC_FORMAT_INPUT)) {\n                var customFormat = getInstance(select('#' + this.parentID + 'Custom_Format_Element', dialogElement.element), MaskedTextBox);\n                this.formatText = this.parent.dataType === 'olap' ? this.formatType === 'Custom' ? customFormat.value : null : customFormat.value;\n            }\n        }\n        else {\n            this.currentFieldName = this.formulaText = this.fieldText = this.formatText = null;\n            this.fieldType = this.formatType = this.parentHierarchy = null;\n        }\n        this.renderMobileLayout(dialogElement);\n    };\n    /**\n     * To update calculated field info in adaptive layout.\n     * @returns {void}\n     */\n    CalculatedField.prototype.updateAdaptiveCalculatedField = function (isEdit, fieldName) {\n        var dialogElement = this.parent.dialogRenderer.adaptiveElement.element;\n        this.isEdit = isEdit;\n        var calcInfo = (isEdit ? (this.parent.dataType === 'pivot' ?\n            this.parent.engineModule.fieldList[fieldName] : this.parent.olapEngineModule.fieldList[fieldName]) :\n            {\n                id: null, caption: null, formula: null, fieldType: 'Measure',\n                formatString: (this.parent.dataType === 'pivot' ? null : 'Standard'), parentHierarchy: null\n            });\n        this.currentFieldName = calcInfo.id;\n        if (select('#' + this.parentID + 'droppable', document)) {\n            this.formulaText = select('#' + this.parentID + 'droppable', document).value = calcInfo.formula;\n            this.fieldText = this.inputObj.value = calcInfo.caption;\n            this.inputObj.dataBind();\n        }\n        if (dialogElement.querySelector('.' + cls.CALC_MEMBER_TYPE_DIV)) {\n            var memberTypeDrop = getInstance(select('#' + this.parentID + 'Member_Type_Div', dialogElement), DropDownList);\n            this.fieldType = memberTypeDrop.value = calcInfo.fieldType;\n            memberTypeDrop.readonly = isEdit ? true : false;\n            memberTypeDrop.dataBind();\n        }\n        if (dialogElement.querySelector('.' + cls.CALC_HIERARCHY_LIST_DIV)) {\n            var hierarchyDrop = getInstance(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement), DropDownList);\n            if (this.fieldType === 'Dimension') {\n                this.parentHierarchy = hierarchyDrop.value = calcInfo.parentHierarchy;\n            }\n            else {\n                this.parentHierarchy = null;\n                hierarchyDrop.index = 0;\n            }\n            hierarchyDrop.dataBind();\n        }\n        if (dialogElement.querySelector('.' + cls.CALC_FORMAT_TYPE_DIV)) {\n            var formatStringData = ['Standard', 'Currency', 'Percent'];\n            var formatDrop = getInstance(select('#' + this.parentID + 'Format_Div', dialogElement), DropDownList);\n            this.formatType = formatDrop.value = (formatStringData.indexOf(calcInfo.formatString) > -1 ? calcInfo.formatString : 'Custom');\n        }\n        if (dialogElement.querySelector('.' + cls.CALC_FORMAT_INPUT)) {\n            var customFormat = getInstance(select('#' + this.parentID + 'Custom_Format_Element', dialogElement), MaskedTextBox);\n            var formatObj = PivotUtil.getFieldByName(fieldName, this.parent.dataSourceSettings.formatSettings);\n            if (this.parent.dataType === 'pivot') {\n                this.formatText = customFormat.value = formatObj ? formatObj.format : null;\n            }\n            else {\n                this.formatText = customFormat.value = (this.formatType === 'Custom' ? calcInfo.formatString : null);\n            }\n            customFormat.dataBind();\n        }\n    };\n    /* eslint-enable max-len */\n    /**\n     * To create treeview.\n     * @returns {void}\n     */\n    CalculatedField.prototype.createOlapDropElements = function () {\n        var _this = this;\n        var dialogElement = (this.parent.isAdaptive ?\n            this.parent.dialogRenderer.parentElement : this.dialog.element);\n        var mData = [];\n        var fData = [];\n        var fieldData = [];\n        var memberTypeData = ['Measure', 'Dimension'];\n        var formatStringData = ['Standard', 'Currency', 'Percent', 'Custom'];\n        for (var _i = 0, memberTypeData_1 = memberTypeData; _i < memberTypeData_1.length; _i++) {\n            var type = memberTypeData_1[_i];\n            mData.push({ value: type, text: this.parent.localeObj.getConstant(type) });\n        }\n        for (var _a = 0, formatStringData_1 = formatStringData; _a < formatStringData_1.length; _a++) {\n            var format = formatStringData_1[_a];\n            fData.push({ value: format, text: this.parent.localeObj.getConstant(format) });\n        }\n        var fields = PivotUtil.getClonedData(this.parent.olapEngineModule.fieldListData);\n        for (var _b = 0, _c = fields; _b < _c.length; _b++) {\n            var item = _c[_b];\n            if (item.spriteCssClass &&\n                (item.spriteCssClass.indexOf('e-attributeCDB-icon') > -1 ||\n                    item.spriteCssClass.indexOf('e-hierarchyCDB-icon') > -1)) {\n                fieldData.push({ value: item.id, text: item.caption });\n            }\n        }\n        var memberTypeObj = new DropDownList({\n            dataSource: mData, enableRtl: this.parent.enableRtl, locale: this.parent.locale,\n            fields: { value: 'value', text: 'text' },\n            value: this.fieldType !== null ? this.fieldType : mData[0].value,\n            readonly: this.isEdit,\n            cssClass: cls.MEMBER_OPTIONS_CLASS, width: '100%',\n            change: function (args) {\n                hierarchyListObj.enabled = args.value === 'Dimension' ? true : false;\n                _this.fieldType = args.value;\n                _this.formulaText = select('#' + _this.parentID + 'droppable', document).value;\n                hierarchyListObj.dataBind();\n            }\n        });\n        memberTypeObj.isStringTemplate = true;\n        memberTypeObj.appendTo(select('#' + this.parentID + 'Member_Type_Div', dialogElement));\n        var hierarchyListObj = new DropDownList({\n            dataSource: fieldData, enableRtl: this.parent.enableRtl, locale: this.parent.locale,\n            allowFiltering: true,\n            enabled: memberTypeObj.value === 'Dimension' ? true : false,\n            filterBarPlaceholder: this.parent.localeObj.getConstant('example') + ' ' + fieldData[0].text.toString(),\n            fields: { value: 'value', text: 'text' },\n            value: this.parentHierarchy !== null && memberTypeObj.value === 'Dimension' ?\n                this.parentHierarchy : fieldData[0].value,\n            cssClass: cls.MEMBER_OPTIONS_CLASS, width: '100%',\n            change: function (args) {\n                _this.parentHierarchy = args.value;\n                _this.formulaText = select('#' + _this.parentID + 'droppable', document).value;\n            }\n        });\n        hierarchyListObj.isStringTemplate = true;\n        hierarchyListObj.appendTo(select('#' + this.parentID + 'Hierarchy_List_Div', dialogElement));\n        var formatStringObj = new DropDownList({\n            dataSource: fData, enableRtl: this.parent.enableRtl, locale: this.parent.locale,\n            fields: { value: 'value', text: 'text' },\n            value: this.formatType !== null ? this.formatType : fData[0].value,\n            cssClass: cls.MEMBER_OPTIONS_CLASS, width: '100%',\n            change: function (args) {\n                customerFormatObj.enabled = args.value === 'Custom' ? true : false;\n                _this.formatType = args.value;\n                _this.formulaText = select('#' + _this.parentID + 'droppable', document).value;\n                customerFormatObj.dataBind();\n            }\n        });\n        formatStringObj.isStringTemplate = true;\n        formatStringObj.appendTo(select('#' + this.parentID + 'Format_Div', dialogElement));\n        var customerFormatObj = new MaskedTextBox({\n            placeholder: this.parent.localeObj.getConstant('customFormat'),\n            locale: this.parent.locale, enableRtl: this.parent.enableRtl,\n            value: this.formatText !== null && formatStringObj.value === 'Custom' ? this.formatText : null,\n            enabled: formatStringObj.value === 'Custom' ? true : false,\n            change: function (args) {\n                _this.formatText = args.value;\n                _this.formulaText = select('#' + _this.parentID + 'droppable', document).value;\n            }\n        });\n        customerFormatObj.isStringTemplate = true;\n        customerFormatObj.appendTo('#' + this.parentID + 'Custom_Format_Element');\n    };\n    /**\n     * To create treeview.\n     * @returns {void}\n     */\n    CalculatedField.prototype.createTreeView = function () {\n        var _this = this;\n        if (this.parent.dataType === 'olap') {\n            this.treeObj = new TreeView({\n                fields: { dataSource: this.getFieldListData(this.parent), id: 'id', text: 'caption', parentID: 'pid', iconCss: 'spriteCssClass' },\n                allowDragAndDrop: true,\n                enableRtl: this.parent.enableRtl,\n                locale: this.parent.locale,\n                nodeDragStart: this.dragStart.bind(this),\n                nodeDragging: function (e) {\n                    if (e.event.target && e.event.target.classList.contains(cls.FORMULA)) {\n                        removeClass([e.clonedNode], cls.NO_DRAG_CLASS);\n                        addClass([e.event.target], 'e-copy-drop');\n                    }\n                    else {\n                        addClass([e.clonedNode], cls.NO_DRAG_CLASS);\n                        removeClass([e.event.target], 'e-copy-drop');\n                        e.dropIndicator = 'e-no-drop';\n                        addClass([e.clonedNode.querySelector('.' + cls.ICON)], 'e-icon-expandable');\n                        removeClass([e.clonedNode.querySelector('.' + cls.ICON)], 'e-list-icon');\n                    }\n                },\n                nodeClicked: this.fieldClickHandler.bind(this),\n                nodeSelected: function (args) {\n                    if (args.node.getAttribute('data-type') === CALC) {\n                        _this.displayMenu(args.node);\n                    }\n                    else {\n                        removeClass([args.node], 'e-active');\n                        args.cancel = true;\n                    }\n                },\n                nodeDragStop: this.fieldDropped.bind(this),\n                drawNode: this.drawTreeNode.bind(this),\n                nodeExpanding: this.updateNodeIcon.bind(this),\n                nodeCollapsed: this.updateNodeIcon.bind(this),\n                sortOrder: 'None'\n            });\n        }\n        else {\n            this.treeObj = new TreeView({\n                fields: { dataSource: this.getFieldListData(this.parent), id: 'formula', text: 'name', iconCss: 'icon' },\n                allowDragAndDrop: true,\n                enableRtl: this.parent.enableRtl,\n                locale: this.parent.locale,\n                nodeCollapsing: this.nodeCollapsing.bind(this),\n                nodeDragStart: this.dragStart.bind(this),\n                nodeClicked: this.fieldClickHandler.bind(this),\n                nodeDragStop: this.fieldDropped.bind(this),\n                drawNode: this.drawTreeNode.bind(this),\n                keyPress: function (args) {\n                    if (args.event.keyCode === 39) {\n                        args.cancel = true;\n                    }\n                },\n                sortOrder: 'Ascending'\n            });\n        }\n        this.treeObj.isStringTemplate = true;\n        this.treeObj.appendTo('#' + this.parentID + 'tree');\n    };\n    CalculatedField.prototype.updateNodeIcon = function (args) {\n        if (args.node && args.node.querySelector('.e-list-icon') &&\n            args.node.querySelector('.e-icon-expandable.e-process') &&\n            (args.node.querySelector('.e-list-icon').className.indexOf('e-folderCDB-icon') > -1)) {\n            var node = args.node.querySelector('.e-list-icon');\n            removeClass([node], 'e-folderCDB-icon');\n            addClass([node], 'e-folderCDB-open-icon');\n        }\n        else if (args.node && args.node.querySelector('.e-list-icon') &&\n            args.node.querySelector('.e-icon-expandable') &&\n            (args.node.querySelector('.e-list-icon').className.indexOf('e-folderCDB-open-icon') > -1)) {\n            var node = args.node.querySelector('.e-list-icon');\n            removeClass([node], 'e-folderCDB-open-icon');\n            addClass([node], 'e-folderCDB-icon');\n        }\n        else {\n            var curTreeData = this.treeObj.fields.dataSource;\n            var fieldListData = curTreeData;\n            var childNodes = [];\n            for (var _i = 0, fieldListData_1 = fieldListData; _i < fieldListData_1.length; _i++) {\n                var item = fieldListData_1[_i];\n                if (item.pid === args.nodeData.id.toString()) {\n                    childNodes.push(item);\n                }\n            }\n            if (childNodes.length === 0) {\n                this.parent.olapEngineModule.calcChildMembers = [];\n                this.parent.olapEngineModule.getCalcChildMembers(this.parent.dataSourceSettings, args.nodeData.id.toString());\n                childNodes = this.parent.olapEngineModule.calcChildMembers;\n                this.parent.olapEngineModule.calcChildMembers = [];\n                for (var _a = 0, childNodes_1 = childNodes; _a < childNodes_1.length; _a++) {\n                    var node = childNodes_1[_a];\n                    node.pid = args.nodeData.id.toString();\n                    node.hasChildren = false;\n                    node.spriteCssClass = 'e-level-members';\n                    node.caption = (node.caption === '' ? this.parent.localeObj.getConstant('blank') : node.caption);\n                    curTreeData.push(node);\n                }\n                this.treeObj.addNodes(childNodes, args.node);\n            }\n            else {\n                return;\n            }\n        }\n    };\n    CalculatedField.prototype.nodeCollapsing = function (args) {\n        args.cancel = true;\n    };\n    CalculatedField.prototype.dragStart = function (args) {\n        var isDrag = false;\n        var dragItem = args.clonedNode;\n        if (dragItem && ((this.parent.dataType === 'olap' &&\n            (dragItem.querySelector('.e-calc-dimension-icon,.e-calc-measure-icon,.e-measure-icon') ||\n                dragItem.querySelector('.e-dimensionCDB-icon,.e-attributeCDB-icon,.e-hierarchyCDB-icon') ||\n                dragItem.querySelector('.e-level-members,.e-namedSetCDB-icon'))) || (this.parent.dataType === 'pivot' &&\n            args.event.target.classList.contains(cls.DRAG_CLASS)))) {\n            isDrag = true;\n        }\n        if (isDrag) {\n            addClass([args.draggedNode.querySelector('.' + cls.LIST_TEXT_CLASS)], cls.SELECTED_NODE_CLASS);\n            addClass([dragItem], cls.PIVOTCALC);\n            dragItem.style.zIndex = (this.dialog.zIndex + 1).toString();\n            dragItem.style.display = 'inline';\n        }\n        else {\n            args.cancel = true;\n        }\n    };\n    /**\n     * Trigger before treeview text append.\n     * @param  {DrawNodeEventArgs} args\n     * @returns {void}\n     */\n    CalculatedField.prototype.drawTreeNode = function (args) {\n        if (this.parent.dataType === 'olap') {\n            if (args.node.querySelector('.e-measure-icon')) {\n                args.node.querySelector('.e-list-icon').style.display = 'none';\n            }\n            var field = args.nodeData;\n            args.node.setAttribute('data-field', field.id);\n            args.node.setAttribute('data-caption', field.caption);\n            var liTextElement = args.node.querySelector('.' + cls.TEXT_CONTENT_CLASS);\n            if (args.nodeData && args.nodeData.type === CALC &&\n                liTextElement && args.node.querySelector('.e-list-icon.e-calc-member')) {\n                args.node.setAttribute('data-type', field.type);\n                args.node.setAttribute('data-membertype', field.fieldType);\n                args.node.setAttribute('data-hierarchy', field.parentHierarchy ? field.parentHierarchy : '');\n                args.node.setAttribute('data-formula', field.formula);\n                var formatStringData = ['Standard', 'Currency', 'Percent'];\n                var formatString = void 0;\n                formatString = (field.formatString ? formatStringData.indexOf(field.formatString) > -1 ?\n                    field.formatString : 'Custom' : '');\n                args.node.setAttribute('data-formatString', formatString);\n                args.node.setAttribute('data-customString', (formatString === 'Custom' ? field.formatString : ''));\n                var removeElement = createElement('span', {\n                    className: cls.GRID_REMOVE + ' e-icons e-list-icon'\n                });\n                liTextElement.classList.add('e-calcfieldmember');\n                if (this.parent.isAdaptive) {\n                    var editElement = createElement('span', {\n                        className: 'e-list-edit-icon' + (this.isEdit && this.currentFieldName === field.id ?\n                            ' e-edited ' : ' e-edit ') + cls.ICON\n                    });\n                    var editWrapper = createElement('div', { className: 'e-list-header-icon' });\n                    editWrapper.appendChild(editElement);\n                    editWrapper.appendChild(removeElement);\n                    liTextElement.appendChild(editWrapper);\n                }\n                else {\n                    liTextElement.appendChild(removeElement);\n                }\n            }\n            if (this.parent.isAdaptive) {\n                var liTextElement_1 = args.node.querySelector('.' + cls.TEXT_CONTENT_CLASS);\n                if (args.node && args.node.querySelector('.e-list-icon') && liTextElement_1) {\n                    var liIconElement = args.node.querySelector('.e-list-icon');\n                    liTextElement_1.insertBefore(liIconElement, args.node.querySelector('.e-list-text'));\n                }\n                if (args.node && args.node.querySelector('.e-calcMemberGroupCDB,.e-measureGroupCDB-icon,.e-folderCDB-icon')) {\n                    args.node.querySelector('.e-checkbox-wrapper').style.display = 'none';\n                }\n                if (args.node && args.node.querySelector('.e-level-members')) {\n                    args.node.querySelector('.e-list-icon').style.display = 'none';\n                }\n            }\n        }\n        else {\n            var field = args.nodeData.field;\n            args.node.setAttribute('data-field', field);\n            args.node.setAttribute('data-caption', args.nodeData.caption);\n            args.node.setAttribute('data-type', args.nodeData.type);\n            var formatObj = PivotUtil.getFieldByName(field, this.parent.dataSourceSettings.formatSettings);\n            args.node.setAttribute('data-formatString', formatObj ? formatObj.format : '');\n            var dragElement = createElement('span', {\n                attrs: { 'tabindex': '-1', 'aria-disabled': 'false', 'title': this.parent.localeObj.getConstant('dragField') },\n                className: cls.ICON + ' e-drag'\n            });\n            var spaceElement = createElement('div', {\n                className: ' e-iconspace'\n            });\n            prepend([dragElement], args.node.querySelector('.' + cls.TEXT_CONTENT_CLASS));\n            append([spaceElement, args.node.querySelector('.' + cls.FORMAT)], args.node.querySelector('.' + cls.TEXT_CONTENT_CLASS));\n            if (this.getMenuItems(this.parent.engineModule.fieldList[field].type).length <= 0) {\n                removeClass([args.node.querySelector('.' + cls.FORMAT)], cls.ICON);\n            }\n            else {\n                args.node.querySelector('.' + cls.FORMAT).setAttribute('title', this.parent.localeObj.getConstant('format'));\n            }\n            if (this.parent.engineModule.fieldList[field].aggregateType === CALC) {\n                args.node.querySelector('.' + cls.FORMAT).setAttribute('title', this.parent.localeObj.getConstant('remove'));\n                addClass([args.node.querySelector('.' + cls.FORMAT)], cls.GRID_REMOVE);\n                addClass([args.node.querySelector('.' + 'e-iconspace')], [cls.CALC_EDIT, cls.ICON, 'e-list-icon']);\n                args.node.querySelector('.' + cls.CALC_EDIT).setAttribute('title', this.parent.localeObj.getConstant('edit'));\n                args.node.querySelector('.' + cls.CALC_EDIT).setAttribute('aria-disabled', 'false');\n                args.node.querySelector('.' + cls.CALC_EDIT).setAttribute('tabindex', '-1');\n                removeClass([args.node.querySelector('.' + cls.FORMAT)], cls.FORMAT);\n                removeClass([args.node.querySelector('.e-iconspace')], 'e-iconspace');\n            }\n        }\n    };\n    /**\n     * To create radio buttons.\n     * @param  {string} key\n     * @returns HTMLElement\n     */\n    CalculatedField.prototype.createTypeContainer = function (key) {\n        var wrapDiv = createElement('div', { id: this.parentID + 'control_wrapper', className: cls.TREEVIEWOUTER });\n        var type = this.getMenuItems(this.parent.engineModule.fieldList[key].type);\n        for (var i = 0; i < type.length; i++) {\n            var input = createElement('input', {\n                id: this.parentID + 'radio' + key + type[i],\n                attrs: { 'type': 'radio', 'data-ftxt': key, 'data-value': type[i] },\n                className: cls.CALCRADIO\n            });\n            wrapDiv.appendChild(input);\n        }\n        return wrapDiv;\n    };\n    CalculatedField.prototype.getMenuItems = function (fieldType, summaryType) {\n        var menuItems = !isNullOrUndefined(summaryType) ? summaryType : this.parent.aggregateTypes;\n        var type = [];\n        var menuTypes = this.getValidSummaryType();\n        for (var i = 0; i < menuItems.length; i++) {\n            if ((menuTypes.indexOf(menuItems[i]) > -1) && (type.indexOf(menuItems[i]) < 0)) {\n                if (((menuItems[i] === COUNT || menuItems[i] === DISTINCTCOUNT) && fieldType !== 'number')\n                    || (fieldType === 'number')) {\n                    type.push(menuItems[i]);\n                }\n            }\n        }\n        return type;\n    };\n    CalculatedField.prototype.getValidSummaryType = function () {\n        return [COUNT, DISTINCTCOUNT,\n            SUM, AVG, MEDIAN,\n            MIN, MAX, PRODUCT,\n            STDEV, STDEVP,\n            VAR, VARP];\n    };\n    /**\n     * To get Accordion Data.\n     * @param  {PivotView | PivotFieldList} parent\n     * @returns AccordionItemModel\n     */\n    CalculatedField.prototype.getAccordionData = function (parent) {\n        var data = [];\n        var keys = Object.keys(parent.engineModule.fieldList);\n        for (var index = 0, i = keys.length; index < i; index++) {\n            var key = keys[index];\n            data.push({\n                header: '<input id=' + this.parentID + '_' + index + ' class=' + cls.CALCCHECK + ' type=\"checkbox\" data-field=' +\n                    key + ' data-caption=' + this.parent.engineModule.fieldList[key].caption + ' data-type=' +\n                    this.parent.engineModule.fieldList[key].type + '/>',\n                content: (this.parent.engineModule.fieldList[key].aggregateType === CALC ||\n                    (this.getMenuItems(this.parent.engineModule.fieldList[key].type).length < 1)) ? '' :\n                    this.createTypeContainer(key).outerHTML,\n                iconCss: this.parent.engineModule.fieldList[key].aggregateType === CALC ? 'e-list-icon' + ' ' +\n                    (this.isEdit && this.currentFieldName === key ? 'e-edited' : 'e-edit') : ''\n            });\n        }\n        return data;\n    };\n    /**\n     * To render mobile layout.\n     * @param  {Tab} tabObj\n     * @returns {void}\n     */\n    CalculatedField.prototype.renderMobileLayout = function (tabObj) {\n        var _this = this;\n        tabObj.items[4].content = this.renderDialogElements().outerHTML;\n        tabObj.dataBind();\n        if (this.parent.dataType === 'olap' && this.parent.isAdaptive && this.parent.\n            dialogRenderer.parentElement.querySelector('.' + cls.FORMULA) !== null) {\n            this.createOlapDropElements();\n        }\n        var cancelBtn = new Button({ cssClass: cls.FLAT, isPrimary: true, locale: this.parent.locale, enableRtl: this.parent.enableRtl });\n        cancelBtn.isStringTemplate = true;\n        cancelBtn.appendTo('#' + this.parentID + 'cancelBtn');\n        if (cancelBtn.element) {\n            cancelBtn.element.onclick = this.cancelBtnClick.bind(this);\n        }\n        if (this.parent.\n            dialogRenderer.parentElement.querySelector('.' + cls.FORMULA) !== null && this.parent.isAdaptive) {\n            var okBtn = new Button({ cssClass: cls.FLAT + ' ' + cls.OUTLINE_CLASS, isPrimary: true, locale: this.parent.locale, enableRtl: this.parent.enableRtl });\n            okBtn.isStringTemplate = true;\n            okBtn.appendTo('#' + this.parentID + 'okBtn');\n            this.inputObj = new MaskedTextBox({\n                placeholder: this.parent.localeObj.getConstant('fieldName'),\n                locale: this.parent.locale, enableRtl: this.parent.enableRtl,\n                change: function (args) {\n                    _this.fieldText = args.value;\n                    _this.formulaText = select('#' + _this.parentID + 'droppable', document).value;\n                }\n            });\n            this.inputObj.isStringTemplate = true;\n            this.inputObj.appendTo('#' + this.parentID + 'ddlelement');\n            if (this.parent.dataType === 'pivot') {\n                var formatInputObj = new MaskedTextBox({\n                    locale: this.parent.locale, enableRtl: this.parent.enableRtl,\n                    placeholder: this.parent.localeObj.getConstant('numberFormatString'),\n                    change: function (args) {\n                        _this.formatText = args.value;\n                        _this.formulaText = select('#' + _this.parentID + 'droppable', document).value;\n                    }\n                });\n                formatInputObj.isStringTemplate = true;\n                formatInputObj.appendTo('#' + this.parentID + 'Custom_Format_Element');\n                if (this.formatText !== null && this.parent.\n                    dialogRenderer.parentElement.querySelector('.' + cls.CALC_FORMAT_INPUT) !== null) {\n                    this.parent.\n                        dialogRenderer.parentElement.querySelector('.' + cls.CALC_FORMAT_INPUT).value = this.formatText;\n                    formatInputObj.value = this.formatText;\n                }\n            }\n            if (this.formulaText !== null && select('#' + this.parentID + 'droppable', this.parent.dialogRenderer.parentElement) !== null) {\n                var drop = select('#' + this.parentID + 'droppable', this.parent.dialogRenderer.parentElement);\n                drop.value = this.formulaText;\n            }\n            if (this.fieldText !== null && this.parent.\n                dialogRenderer.parentElement.querySelector('.' + cls.CALCINPUT) !== null) {\n                this.parent.\n                    dialogRenderer.parentElement.querySelector('.' + cls.CALCINPUT).value = this.fieldText;\n                this.inputObj.value = this.fieldText;\n            }\n            if (okBtn.element) {\n                okBtn.element.onclick = this.applyFormula.bind(this);\n            }\n        }\n        else if (this.parent.isAdaptive) {\n            var addBtn = new Button({ cssClass: cls.FLAT, isPrimary: true, locale: this.parent.locale, enableRtl: this.parent.enableRtl });\n            addBtn.isStringTemplate = true;\n            addBtn.appendTo('#' + this.parentID + 'addBtn');\n            if (this.parent.dataType === 'olap') {\n                this.treeObj = new TreeView({\n                    fields: { dataSource: this.getFieldListData(this.parent), id: 'id', text: 'caption', parentID: 'pid', iconCss: 'spriteCssClass' },\n                    showCheckBox: true,\n                    autoCheck: false,\n                    sortOrder: 'None',\n                    enableRtl: this.parent.enableRtl,\n                    locale: this.parent.locale,\n                    nodeClicked: this.fieldClickHandler.bind(this),\n                    drawNode: this.drawTreeNode.bind(this),\n                    nodeExpanding: this.updateNodeIcon.bind(this),\n                    nodeCollapsed: this.updateNodeIcon.bind(this),\n                    nodeSelected: function (args) {\n                        removeClass([args.node], 'e-active');\n                        args.cancel = true;\n                    }\n                });\n                this.treeObj.isStringTemplate = true;\n                this.treeObj.appendTo('#' + this.parentID + 'accordDiv');\n            }\n            else {\n                this.accordion = new Accordion({\n                    items: this.getAccordionData(this.parent),\n                    enableRtl: this.parent.enableRtl,\n                    locale: this.parent.locale,\n                    expanding: this.accordionExpand.bind(this),\n                    clicked: this.accordionClickHandler.bind(this),\n                    created: this.accordionCreated.bind(this)\n                });\n                this.accordion.isStringTemplate = true;\n                this.accordion.appendTo('#' + this.parentID + 'accordDiv');\n                this.updateType();\n            }\n            if (addBtn.element) {\n                addBtn.element.onclick = this.addBtnClick.bind(this);\n            }\n        }\n    };\n    CalculatedField.prototype.accordionExpand = function (args) {\n        if (args.element.querySelectorAll('.e-radio-wrapper').length === 0) {\n            var keys = Object.keys(this.parent.engineModule.fieldList);\n            for (var index = 0, i = keys.length; index < i; index++) {\n                var key = keys[index];\n                var type = this.parent.engineModule.fieldList[key].type !== 'number' ? [COUNT, DISTINCTCOUNT] :\n                    [SUM, COUNT, AVG, MEDIAN, MIN, MAX, DISTINCTCOUNT, PRODUCT, STDEV, STDEVP, VAR, VARP];\n                var radiobutton = void 0;\n                if (key === args.element.querySelector('[data-field').getAttribute('data-field')) {\n                    for (var i_1 = 0; i_1 < type.length; i_1++) {\n                        radiobutton = new RadioButton({\n                            label: this.parent.localeObj.getConstant(type[i_1]),\n                            name: AGRTYPE + key,\n                            checked: args.element.querySelector('[data-type').getAttribute('data-type') === type[i_1],\n                            change: this.onChange.bind(this),\n                            locale: this.parent.locale, enableRtl: this.parent.enableRtl\n                        });\n                        radiobutton.isStringTemplate = true;\n                        radiobutton.appendTo('#' + this.parentID + 'radio' + key + type[i_1]);\n                    }\n                }\n            }\n        }\n    };\n    CalculatedField.prototype.onChange = function (args) {\n        var type = args.event.target.parentElement.querySelector('.e-label')\n            .innerText;\n        var field = args.event.target.closest('.e-acrdn-item').\n            querySelector('[data-field').getAttribute('data-caption');\n        args.event.target.\n            closest('.e-acrdn-item').querySelector('.e-label').\n            innerText = field + ' (' + type + ')';\n        args.event.target.closest('.e-acrdn-item').\n            querySelector('[data-type').setAttribute('data-type', args.event.target.getAttribute('data-value'));\n    };\n    CalculatedField.prototype.updateType = function () {\n        var keys = Object.keys(this.parent.engineModule.fieldList);\n        for (var index = 0, i = keys.length; index < i; index++) {\n            var key = keys[index];\n            var type = null;\n            if ((this.parent.engineModule.fieldList[key].type !== 'number' ||\n                this.parent.engineModule.fieldList[key].type === 'include' ||\n                this.parent.engineModule.fieldList[key].type === 'exclude') &&\n                (this.parent.engineModule.fieldList[key].aggregateType !== 'DistinctCount')) {\n                type = COUNT;\n            }\n            else {\n                type = this.parent.engineModule.fieldList[key].aggregateType !== undefined ?\n                    this.parent.engineModule.fieldList[key].aggregateType : SUM;\n            }\n            var checkbox = new CheckBox({\n                label: this.parent.engineModule.fieldList[key].caption + ' (' + this.parent.localeObj.getConstant(type) + ')',\n                locale: this.parent.locale, enableRtl: this.parent.enableRtl\n            });\n            checkbox.isStringTemplate = true;\n            checkbox.appendTo('#' + this.parentID + '_' + index);\n            select('#' + this.parentID + '_' + index, document).setAttribute('data-field', key);\n            select('#' + this.parentID + '_' + index, document).setAttribute('data-type', type);\n        }\n    };\n    /**\n     * Trigger while click cancel button.\n     * @returns {void}\n     */\n    CalculatedField.prototype.cancelBtnClick = function () {\n        this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement);\n    };\n    /**\n     * Trigger while click add button.\n     * @returns {void}\n     */\n    CalculatedField.prototype.addBtnClick = function () {\n        var fieldText = '';\n        var field = null;\n        var type = null;\n        if (this.parent.dataType === 'pivot') {\n            var node = document.querySelectorAll('.e-accordion .e-check');\n            for (var i = 0; i < node.length; i++) {\n                field = node[i].parentElement.querySelector('[data-field]').getAttribute('data-field');\n                type = node[i].parentElement.querySelector('[data-field]').getAttribute('data-type');\n                if (type.indexOf(CALC) === -1) {\n                    fieldText = fieldText + ('\"' + type + '(' + field + ')' + '\"');\n                }\n                else {\n                    for (var j = 0; j < this.parent.dataSourceSettings.calculatedFieldSettings.length; j++) {\n                        if (this.parent.dataSourceSettings.calculatedFieldSettings[j].name === field) {\n                            fieldText = fieldText + this.parent.dataSourceSettings.calculatedFieldSettings[j].formula;\n                            break;\n                        }\n                    }\n                }\n            }\n        }\n        else {\n            var nodes = this.treeObj.getAllCheckedNodes();\n            var olapEngine = this.parent.olapEngineModule;\n            for (var _i = 0, nodes_1 = nodes; _i < nodes_1.length; _i++) {\n                var item = nodes_1[_i];\n                fieldText = fieldText + (olapEngine.fieldList[item] &&\n                    olapEngine.fieldList[item].type === CALC ? olapEngine.fieldList[item].tag : item);\n            }\n        }\n        this.formulaText = this.formulaText !== null ? (this.formulaText + fieldText) : fieldText;\n        this.renderMobileLayout(this.parent.dialogRenderer.adaptiveElement);\n    };\n    /**\n     * To create calculated field dialog elements.\n     * @returns {void}\n     * @hidden\n     */\n    CalculatedField.prototype.createCalculatedFieldDialog = function (args) {\n        if (this.parent.isAdaptive && this.parent.getModuleName() === 'pivotfieldlist') {\n            this.renderAdaptiveLayout(args && args.edit !== undefined ? args.edit : true);\n            this.isEdit = (args && args.edit !== undefined ? args.edit : this.isEdit);\n        }\n        else if (!this.parent.isAdaptive) {\n            this.isEdit = (args && args.edit !== undefined ? args.edit : false);\n            this.renderDialogLayout();\n            if (args && args.edit) {\n                var target = this.treeObj.element.querySelector('li[data-field=\"' + args.fieldName + '\"]');\n                if (target) {\n                    addClass([target], ['e-active', 'e-node-focus']);\n                    target.setAttribute('aria-selected', 'true');\n                    target.id = this.treeObj.element.id + '_active';\n                    if (this.parent.dataType === 'pivot') {\n                        var e = { event: { target: target.querySelector('.e-list-icon.e-edit.e-icons') } };\n                        this.fieldClickHandler(e);\n                    }\n                    else {\n                        this.displayMenu(target);\n                    }\n                }\n            }\n            this.dialog.element.style.top = parseInt(this.dialog.element.style.top, 10) < 0 ? '0px' : this.dialog.element.style.top;\n        }\n    };\n    /**\n     * To create calculated field desktop layout.\n     * @returns {void}\n     */\n    CalculatedField.prototype.renderDialogLayout = function () {\n        this.newFields =\n            extend([], this.parent.dataSourceSettings.calculatedFieldSettings, null, true);\n        this.createDialog();\n        this.dialog.content = this.renderDialogElements();\n        this.dialog.refresh();\n        this.inputObj = new MaskedTextBox({\n            placeholder: this.parent.localeObj.getConstant('fieldName'),\n            locale: this.parent.locale, enableRtl: this.parent.enableRtl\n        });\n        this.inputObj.isStringTemplate = true;\n        this.inputObj.appendTo('#' + this.parentID + 'ddlelement');\n        if (this.parent.dataType === 'pivot') {\n            var customerFormatObj = new MaskedTextBox({\n                placeholder: this.parent.localeObj.getConstant('numberFormatString'),\n                locale: this.parent.locale, enableRtl: this.parent.enableRtl\n            });\n            customerFormatObj.isStringTemplate = true;\n            customerFormatObj.appendTo('#' + this.parentID + 'Custom_Format_Element');\n        }\n        if (this.parent.dataType === 'olap' && !this.parent.isAdaptive) {\n            this.createOlapDropElements();\n        }\n        this.createTreeView();\n        this.droppable = new Droppable(select('#' + this.parentID + 'droppable'));\n        this.keyboardEvents = new KeyboardEvents(this.parent.calculatedFieldModule.dialog.element, {\n            keyAction: this.keyActionHandler.bind(this),\n            keyConfigs: { moveRight: 'rightarrow', enter: 'enter', shiftE: 'shift+E', delete: 'delete' },\n            eventName: 'keydown'\n        });\n    };\n    /**\n     * Creates the error dialog for the unexpected action done.\n     * @function createConfirmDialog\n     * @returns {void}\n     * @hidden\n     */\n    CalculatedField.prototype.createConfirmDialog = function (title, description, calcInfo, isRemove, node) {\n        var errorDialog = createElement('div', {\n            id: this.parentID + '_ErrorDialog',\n            className: cls.ERROR_DIALOG_CLASS\n        });\n        this.parent.element.appendChild(errorDialog);\n        this.confirmPopUp = new Dialog({\n            animationSettings: { effect: 'Fade' },\n            allowDragging: false,\n            showCloseIcon: true,\n            enableRtl: this.parent.enableRtl,\n            locale: this.parent.locale,\n            width: 'auto',\n            height: 'auto',\n            position: { X: 'center', Y: 'center' },\n            buttons: [\n                {\n                    click: isRemove ? this.removeCalcField.bind(this, node) : this.replaceFormula.bind(this, calcInfo),\n                    buttonModel: {\n                        cssClass: cls.OK_BUTTON_CLASS + ' ' + cls.FLAT_CLASS,\n                        content: isRemove ? this.parent.localeObj.getConstant('yes') : this.parent.localeObj.getConstant('ok'), isPrimary: true\n                    }\n                },\n                {\n                    click: this.removeErrorDialog.bind(this),\n                    buttonModel: {\n                        cssClass: cls.CANCEL_BUTTON_CLASS,\n                        content: isRemove ? this.parent.localeObj.getConstant('no') : this.parent.localeObj.getConstant('cancel'), isPrimary: true\n                    }\n                }\n            ],\n            header: title,\n            content: description,\n            isModal: true,\n            visible: true,\n            closeOnEscape: true,\n            target: document.body,\n            close: this.removeErrorDialog.bind(this),\n        });\n        /* eslint-enable max-len */\n        this.confirmPopUp.isStringTemplate = true;\n        this.confirmPopUp.appendTo(errorDialog);\n        // this.confirmPopUp.element.querySelector('.e-dlg-header').innerHTML = title;\n    };\n    CalculatedField.prototype.replaceFormula = function (calcInfo) {\n        var report = this.parent.dataSourceSettings;\n        if (this.parent.dataType === 'olap') {\n            for (var j = 0; j < report.calculatedFieldSettings.length; j++) {\n                if (report.calculatedFieldSettings[j].name === calcInfo.name) {\n                    if (!isNullOrUndefined(calcInfo.hierarchyUniqueName)) {\n                        report.calculatedFieldSettings[j].hierarchyUniqueName = calcInfo.hierarchyUniqueName;\n                    }\n                    report.calculatedFieldSettings[j].formatString = calcInfo.formatString;\n                    report.calculatedFieldSettings[j].formula = calcInfo.formula;\n                    this.parent.lastCalcFieldInfo = report.calculatedFieldSettings[j];\n                    break;\n                }\n            }\n        }\n        else {\n            for (var i = 0; i < report.values.length; i++) {\n                if (report.values[i].type === CALC && report.values[i].name === calcInfo.name) {\n                    for (var j = 0; j < report.calculatedFieldSettings.length; j++) {\n                        if (report.calculatedFieldSettings[j].name === calcInfo.name) {\n                            report.calculatedFieldSettings[j].formula = calcInfo.formula;\n                            this.parent.lastCalcFieldInfo = report.calculatedFieldSettings[j];\n                            this.updateFormatSettings(report, calcInfo.name, calcInfo.formatString);\n                        }\n                    }\n                }\n            }\n        }\n        this.addFormula(report, calcInfo.name);\n        this.removeErrorDialog();\n    };\n    CalculatedField.prototype.removeErrorDialog = function () {\n        if (document.getElementById(this.parentID + '_ErrorDialog')) {\n            remove(document.getElementById(this.parentID + '_ErrorDialog').parentElement);\n        }\n    };\n    /**\n     * To add event listener.\n     * @returns {void}\n     * @hidden\n     */\n    CalculatedField.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.initCalculatedField, this.createCalculatedFieldDialog, this);\n    };\n    /**\n     * To remove event listener.\n     * @returns {void}\n     * @hidden\n     */\n    CalculatedField.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.initCalculatedField, this.createCalculatedFieldDialog);\n    };\n    /**\n     * To destroy the calculated field dialog\n     * @returns {void}\n     * @hidden\n     */\n    CalculatedField.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    return CalculatedField;\n}());\nexport { CalculatedField };\n"]},"metadata":{},"sourceType":"module"}